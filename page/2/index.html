<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Joey</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Joey">
<meta property="og:url" content="http://fangchenyong.top/page/2/index.html">
<meta property="og:site_name" content="Joey">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Joey">
  
    <link rel="alternate" href="/atom.xml" title="Joey" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Joey</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">首页</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://fangchenyong.top"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-JS-JS常用方法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/29/JS-JS常用方法/" class="article-date">
  <time datetime="2019-10-29T14:12:23.000Z" itemprop="datePublished">2019-10-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/29/JS-JS常用方法/">JavaScript常用方法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="JavaScript常用方法"><a href="#JavaScript常用方法" class="headerlink" title="JavaScript常用方法"></a>JavaScript常用方法</h1><h2 id="1-将数值四舍五入-保留2位小数-后格式化成金额形式"><a href="#1-将数值四舍五入-保留2位小数-后格式化成金额形式" class="headerlink" title="1. 将数值四舍五入(保留2位小数)后格式化成金额形式"></a>1. 将数值四舍五入(保留2位小数)后格式化成金额形式</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将数值四舍五入(保留2位小数)后格式化成金额形式</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param num 数值(Number或者String)</span></span><br><span class="line"><span class="comment"> * @return 金额格式的字符串,如'1,234,567.45'</span></span><br><span class="line"><span class="comment"> * @type String</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatCurrency</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">    num = num.toString().replace(<span class="regexp">/\$|\,/g</span>,<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">isNaN</span>(num))</span><br><span class="line">        num = <span class="string">"0"</span>;</span><br><span class="line">    sign = (num == (num = <span class="built_in">Math</span>.abs(num)));</span><br><span class="line">    num = <span class="built_in">Math</span>.floor(num*<span class="number">100</span>+<span class="number">0.50000000001</span>);</span><br><span class="line">    cents = num%<span class="number">100</span>;</span><br><span class="line">    num = <span class="built_in">Math</span>.floor(num/<span class="number">100</span>).toString();</span><br><span class="line">    <span class="keyword">if</span>(cents&lt;<span class="number">10</span>)</span><br><span class="line">    cents = <span class="string">"0"</span> + cents;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">Math</span>.floor((num.length-(<span class="number">1</span>+i))/<span class="number">3</span>); i++)</span><br><span class="line">    num = num.substring(<span class="number">0</span>,num.length-(<span class="number">4</span>*i+<span class="number">3</span>))+<span class="string">','</span>+</span><br><span class="line">    num.substring(num.length-(<span class="number">4</span>*i+<span class="number">3</span>));</span><br><span class="line">    <span class="keyword">return</span> (((sign)?<span class="string">''</span>:<span class="string">'-'</span>) + num + <span class="string">'.'</span> + cents);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-金额转大写"><a href="#2-金额转大写" class="headerlink" title="2. 金额转大写"></a>2. 金额转大写</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//金额转大写</span></span><br><span class="line"><span class="keyword">var</span> digitUppercase = <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> fraction = [<span class="string">'角'</span>, <span class="string">'分'</span>];</span><br><span class="line">    <span class="keyword">var</span> digit = [</span><br><span class="line">        <span class="string">'零'</span>, <span class="string">'壹'</span>, <span class="string">'贰'</span>, <span class="string">'叁'</span>, <span class="string">'肆'</span>,</span><br><span class="line">        <span class="string">'伍'</span>, <span class="string">'陆'</span>, <span class="string">'柒'</span>, <span class="string">'捌'</span>, <span class="string">'玖'</span></span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">var</span> unit = [</span><br><span class="line">        [<span class="string">'元'</span>, <span class="string">'万'</span>, <span class="string">'亿'</span>],</span><br><span class="line">        [<span class="string">''</span>, <span class="string">'拾'</span>, <span class="string">'佰'</span>, <span class="string">'仟'</span>]</span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">var</span> head = n &lt; <span class="number">0</span> ? <span class="string">'欠'</span> : <span class="string">''</span>;</span><br><span class="line">    n = <span class="built_in">Math</span>.abs(n);</span><br><span class="line">    <span class="keyword">var</span> s = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; fraction.length; i++) &#123;</span><br><span class="line">        s += (digit[<span class="built_in">Math</span>.floor(n * <span class="number">10</span> * <span class="built_in">Math</span>.pow(<span class="number">10</span>, i)) % <span class="number">10</span>] + fraction[i]).replace(<span class="regexp">/零./</span>, <span class="string">''</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    s = s || <span class="string">'整'</span>;</span><br><span class="line">    n = <span class="built_in">Math</span>.floor(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; unit[<span class="number">0</span>].length &amp;&amp; n &gt; <span class="number">0</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> p = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; unit[<span class="number">1</span>].length &amp;&amp; n &gt; <span class="number">0</span>; j++) &#123;</span><br><span class="line">            p = digit[n % <span class="number">10</span>] + unit[<span class="number">1</span>][j] + p;</span><br><span class="line">            n = <span class="built_in">Math</span>.floor(n / <span class="number">10</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        s = p.replace(<span class="regexp">/(零.)*零$/</span>, <span class="string">''</span>).replace(<span class="regexp">/^$/</span>, <span class="string">'零'</span>) + unit[<span class="number">0</span>][i] + s;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> head + s.replace(<span class="regexp">/(零.)*零元/</span>, <span class="string">'元'</span>)</span><br><span class="line">        .replace(<span class="regexp">/(零.)+/g</span>, <span class="string">'零'</span>)</span><br><span class="line">        .replace(<span class="regexp">/^整$/</span>, <span class="string">'零元整'</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="3-计算文件大小"><a href="#3-计算文件大小" class="headerlink" title="3. 计算文件大小"></a>3. 计算文件大小</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 计算文件大小函数(保留两位小数),Size为字节大小</span></span><br><span class="line"><span class="comment">// size：初始文件大小</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getfilesize</span>(<span class="params">size</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!size)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">var</span> num = <span class="number">1024.00</span>; <span class="comment">//byte</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (size &lt; num)</span><br><span class="line">        <span class="keyword">return</span> size + <span class="string">"B"</span>;</span><br><span class="line">    <span class="keyword">if</span> (size &lt; <span class="built_in">Math</span>.pow(num, <span class="number">2</span>))</span><br><span class="line">        <span class="keyword">return</span> (size / num).toFixed(<span class="number">2</span>) + <span class="string">"K"</span>; <span class="comment">//kb</span></span><br><span class="line">    <span class="keyword">if</span> (size &lt; <span class="built_in">Math</span>.pow(num, <span class="number">3</span>))</span><br><span class="line">        <span class="keyword">return</span> (size / <span class="built_in">Math</span>.pow(num, <span class="number">2</span>)).toFixed(<span class="number">2</span>) + <span class="string">"M"</span>; <span class="comment">//M</span></span><br><span class="line">    <span class="keyword">if</span> (size &lt; <span class="built_in">Math</span>.pow(num, <span class="number">4</span>))</span><br><span class="line">        <span class="keyword">return</span> (size / <span class="built_in">Math</span>.pow(num, <span class="number">3</span>)).toFixed(<span class="number">2</span>) + <span class="string">"G"</span>; <span class="comment">//G</span></span><br><span class="line">    <span class="keyword">return</span> (size / <span class="built_in">Math</span>.pow(num, <span class="number">4</span>)).toFixed(<span class="number">2</span>) + <span class="string">"T"</span>; <span class="comment">//T</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-获取输入框选中值"><a href="#4-获取输入框选中值" class="headerlink" title="4. 获取输入框选中值"></a>4. 获取输入框选中值</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;input type=<span class="string">"text"</span> id=<span class="string">"dxs"</span> name=<span class="string">"name"</span> /&gt;</span><br><span class="line">&lt;input type=<span class="string">"button"</span> value=<span class="string">"获取"</span>  onclick=<span class="string">"getSelectedText()"</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">getSelectedText</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">	<span class="keyword">var</span> inputDom =  <span class="built_in">document</span>.getElementById(<span class="string">"dxs"</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">document</span>.selection) <span class="comment">//IE</span></span><br><span class="line">    &#123; </span><br><span class="line">        alert(<span class="built_in">document</span>.selection.createRange().text); </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">else</span> &#123;  </span><br><span class="line">        alert(inputDom.value.substring(inputDom.selectionStart,  </span><br><span class="line">                inputDom.selectionEnd));  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br></pre></td></tr></table></figure>

<h2 id="5-判断对象是不是数组"><a href="#5-判断对象是不是数组" class="headerlink" title="5. 判断对象是不是数组"></a>5. 判断对象是不是数组</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isArray</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'[object Array]'</span> == <span class="built_in">Object</span>.prototype.toString.call(source);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="6-获取url根路径"><a href="#6-获取url根路径" class="headerlink" title="6. 获取url根路径"></a>6. 获取url根路径</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//例如  http://12.3.4.5/joey/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRootPath</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> strFullPath = <span class="built_in">window</span>.document.location.href;</span><br><span class="line">    <span class="keyword">var</span> strPath = <span class="built_in">window</span>.document.location.pathname;</span><br><span class="line">    <span class="keyword">var</span> pos = strFullPath.indexOf(strPath);</span><br><span class="line">    <span class="keyword">var</span> prePath = strFullPath.substring(<span class="number">0</span>, pos);</span><br><span class="line">    <span class="keyword">var</span> postPath = strPath.substring(<span class="number">0</span>, strPath.substr(<span class="number">1</span>).indexOf(<span class="string">'/'</span>) + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> (prePath + postPath);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-获取url指定参数"><a href="#7-获取url指定参数" class="headerlink" title="7. 获取url指定参数"></a>7. 获取url指定参数</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//strParame为参数名称,url为地址</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">strParame, url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">    <span class="keyword">var</span> query = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">if</span> (!url)</span><br><span class="line">        query = <span class="built_in">unescape</span>(location.search.substring(<span class="number">1</span>)); <span class="comment">// Get query string</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> index = url.indexOf(<span class="string">"?"</span>);</span><br><span class="line">        query = url.substring(index + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> pairs = query.split(<span class="string">"&amp;"</span>); <span class="comment">// Break at ampersand</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; pairs.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> pos = pairs[i].indexOf(<span class="string">'='</span>); <span class="comment">// Look for "name=value"</span></span><br><span class="line">        <span class="keyword">if</span> (pos == <span class="number">-1</span>) <span class="keyword">continue</span>; <span class="comment">// If not found, skip</span></span><br><span class="line">        <span class="keyword">var</span> argname = pairs[i].substring(<span class="number">0</span>, pos); <span class="comment">// Extract the name</span></span><br><span class="line">        <span class="keyword">var</span> value = pairs[i].substring(pos + <span class="number">1</span>); <span class="comment">// Extract the value</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            value = <span class="built_in">decodeURIComponent</span>(value); <span class="comment">// Decode it, if needed</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">        args[argname] = value; <span class="comment">// Store as a property</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> args[strParame]; <span class="comment">// Return the object</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-创建GUID"><a href="#8-创建GUID" class="headerlink" title="8. 创建GUID"></a>8. 创建GUID</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//补了零的标准的guid格式（当然多了个“guid_”前缀,以及使用“_”代替“-”）。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CreateGUID</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">s4</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Math</span>.floor((<span class="number">1</span> + <span class="built_in">Math</span>.random()) * <span class="number">0x10000</span>)</span><br><span class="line">          .toString(<span class="number">16</span>)</span><br><span class="line">          .substring(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> s4() + s4() + <span class="string">'-'</span> + s4() + <span class="string">'-'</span> + s4() + <span class="string">'-'</span> +</span><br><span class="line">      s4() + <span class="string">'-'</span> + s4() + s4() + s4();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-判断一个值是否为空"><a href="#9-判断一个值是否为空" class="headerlink" title="9. 判断一个值是否为空"></a>9. 判断一个值是否为空</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">IsEmpty</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="literal">undefined</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="string">""</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="string">"00000000-0000-0000-0000-000000000000"</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-设置cookie"><a href="#10-设置cookie" class="headerlink" title="10. 设置cookie"></a>10. 设置cookie</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setCookie</span>(<span class="params">name, value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> Days = <span class="number">300</span>; <span class="comment">//此 cookie 将被保存 30 天</span></span><br><span class="line">    <span class="keyword">var</span> exp = <span class="keyword">new</span> <span class="built_in">Date</span>();    <span class="comment">//new Date("December 31, 9998");</span></span><br><span class="line">    exp.setTime(exp.getTime() + Days * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">    <span class="built_in">document</span>.cookie = name + <span class="string">"="</span> + <span class="built_in">escape</span>(value) + <span class="string">";expires="</span> + exp.toGMTString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="11-获取cookie"><a href="#11-获取cookie" class="headerlink" title="11. 获取cookie"></a>11. 获取cookie</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arr = <span class="built_in">document</span>.cookie.match(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"(^| )"</span> + name + <span class="string">"=([^;]*)(;|$)"</span>));</span><br><span class="line">    <span class="keyword">if</span> (arr != <span class="literal">null</span>) <span class="keyword">return</span> <span class="built_in">unescape</span>(arr[<span class="number">2</span>]); <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="12-删除cookie"><a href="#12-删除cookie" class="headerlink" title="12. 删除cookie"></a>12. 删除cookie</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delCookie</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> exp = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    exp.setTime(exp.getTime() - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">var</span> cval = getCookie(name);</span><br><span class="line">    <span class="keyword">if</span> (cval != <span class="literal">null</span>)</span><br><span class="line">        <span class="built_in">document</span>.cookie = name + <span class="string">"="</span> + cval + <span class="string">";expires="</span> + exp.toGMTString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="13-对象数组去重"><a href="#13-对象数组去重" class="headerlink" title="13. 对象数组去重"></a>13. 对象数组去重</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//对connects进行去重，el.pageSourceId == element.pageSourceId是去重条件</span></span><br><span class="line"><span class="keyword">var</span> connects = connects.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">prev, element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!prev.find(<span class="function"><span class="params">el</span>=&gt;</span>(el.pageSourceId == element.pageSourceId))) &#123;</span><br><span class="line">        prev.push(element)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> prev</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://fangchenyong.top/2019/10/29/JS-JS常用方法/" data-id="ckmh9z4480000roum8zn4wmc8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-地图-腾讯地图坐标拾取器" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/15/地图-腾讯地图坐标拾取器/" class="article-date">
  <time datetime="2019-10-15T14:12:23.000Z" itemprop="datePublished">2019-10-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/地图/">地图</a>►<a class="article-category-link" href="/categories/地图/腾讯地图/">腾讯地图</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/15/地图-腾讯地图坐标拾取器/">腾讯地图坐标选取器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="腾讯地图坐标选取器"><a href="#腾讯地图坐标选取器" class="headerlink" title="腾讯地图坐标选取器"></a>腾讯地图坐标选取器</h1><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>项目地图<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> <span class="attr">src</span>=<span class="string">"http://map.qq.com/api/js?v=2.exp&amp;key=你的key"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://open.map.qq.com/apifiles/2/4/79/main.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/Scripts/plugins/jQuery/jquery-2.2.4.min.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/Scripts/plugins/bootstrap/bootstrap.min.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"/App_Themes/Default/assets/plugins/bootstrap/css/bootstrap.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        .map-seach &#123;</span><br><span class="line">            background: #50a4ec;</span><br><span class="line">            padding: 5px 20px;</span><br><span class="line">            color: #fff;</span><br><span class="line">            display: inline-block;</span><br><span class="line">        &#125;</span><br><span class="line">            .map-seach:active &#123;</span><br><span class="line">                background: rgba(80, 164, 236, 0.4);</span><br><span class="line">            &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"toolbar"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box-group"</span> <span class="attr">style</span>=<span class="string">"float: left;"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"font-style"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-pencil"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                        &amp;nbsp;经度:</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">id</span>=<span class="string">"longitude"</span> <span class="attr">name</span>=<span class="string">"longitude"</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box-group"</span> <span class="attr">style</span>=<span class="string">"float: left"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"font-style"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-pencil"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                        &amp;nbsp;纬度:</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">id</span>=<span class="string">"latitude"</span> <span class="attr">name</span>=<span class="string">"latitude"</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box-group"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"font-style"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-map-o"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                        &amp;nbsp;详细地址:</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"address"</span> <span class="attr">class</span>=<span class="string">"form-control box-wight"</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"mapseacrh"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"confirm"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span> <span class="attr">style</span>=<span class="string">"width:100%;height:500px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> lat=<span class="string">""</span>, lng=<span class="string">""</span>;</span></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> geocoder, citylocation, map, marker, label = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> center = <span class="keyword">new</span> qq.maps.LatLng(<span class="number">19.940433</span>, <span class="number">110.362473</span>);</span></span><br><span class="line"><span class="javascript">            map = <span class="keyword">new</span> qq.maps.Map(<span class="built_in">document</span>.getElementById(<span class="string">'container'</span>), &#123;</span></span><br><span class="line">                center: center,</span><br><span class="line">                zoom: 13</span><br><span class="line">            &#125;);</span><br><span class="line"><span class="javascript">            label = <span class="keyword">new</span> qq.maps.Label(&#123;</span></span><br><span class="line">                map: map,</span><br><span class="line"><span class="javascript">                offset: <span class="keyword">new</span> qq.maps.Size(<span class="number">15</span>, <span class="number">-12</span>),</span></span><br><span class="line"><span class="javascript">                draggable: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                clickable: <span class="literal">false</span></span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="javascript">            geocoder = <span class="keyword">new</span> qq.maps.Geocoder(&#123;</span></span><br><span class="line"><span class="javascript">                complete: <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span></span><br><span class="line">                    map.setCenter(result.detail.location);</span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> marker = <span class="keyword">new</span> qq.maps.Marker(&#123;</span></span><br><span class="line">                        map: map,</span><br><span class="line">                        position: result.detail.location</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"><span class="javascript">            marker = <span class="keyword">new</span> qq.maps.Marker(&#123;</span></span><br><span class="line"><span class="javascript">                position: <span class="keyword">new</span> qq.maps.LatLng(lat, lng),</span></span><br><span class="line">                map: map</span><br><span class="line">            &#125;);</span><br><span class="line"><span class="javascript">            <span class="comment">//获取城市列表接口设置中心点</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (lat == <span class="string">''</span> || lng == <span class="string">''</span>) &#123;</span></span><br><span class="line"><span class="javascript">                citylocation = <span class="keyword">new</span> qq.maps.CityService(&#123;</span></span><br><span class="line"><span class="javascript">                    complete: <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span></span><br><span class="line">                        map.setCenter(result.detail.latLng);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"><span class="javascript">                <span class="comment">//调用searchLocalCity();方法    根据用户IP查询城市信息。</span></span></span><br><span class="line">                citylocation.searchLocalCity();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">            <span class="comment">//绑定单击事件添加参数</span></span></span><br><span class="line"><span class="javascript">            qq.maps.event.addListener(map, <span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                marker.setMap(<span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">document</span>.getElementById(<span class="string">"longitude"</span>).value = event.latLng.getLng().toFixed(<span class="number">6</span>);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">document</span>.getElementById(<span class="string">"latitude"</span>).value = event.latLng.getLat().toFixed(<span class="number">6</span>);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> url = <span class="built_in">encodeURI</span>(<span class="string">"https://apis.map.qq.com/ws/geocoder/v1/?location="</span> + event.latLng.getLat() + <span class="string">","</span> + event.latLng.getLng() + <span class="string">"&amp;key=你的key&amp;output=jsonp&amp;&amp;callback=?"</span>);</span></span><br><span class="line"><span class="javascript">                $.getJSON(url, <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (result.result != <span class="literal">undefined</span>) &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">document</span>.getElementById(<span class="string">"address"</span>).value = result.result.address;</span></span><br><span class="line"><span class="javascript">                    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">document</span>.getElementById(<span class="string">"address"</span>).value = <span class="string">""</span>;</span></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;)</span><br><span class="line"><span class="javascript">                marker = <span class="keyword">new</span> qq.maps.Marker(&#123;</span></span><br><span class="line"><span class="javascript">                    position: <span class="keyword">new</span> qq.maps.LatLng(event.latLng.getLat(), event.latLng.getLng()),</span></span><br><span class="line">                    map: map</span><br><span class="line"></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">            qq.maps.event.addListener(map, <span class="string">"mousemove"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> latlng = e.latLng;</span></span><br><span class="line">                label.setPosition(latlng);</span><br><span class="line"><span class="javascript">                label.setContent(latlng.getLat().toFixed(<span class="number">6</span>) + <span class="string">","</span> + latlng.getLng().toFixed(<span class="number">6</span>));</span></span><br><span class="line"></span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">            geocoder = <span class="keyword">new</span> qq.maps.Geocoder(&#123;</span></span><br><span class="line"><span class="javascript">                complete: <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    marker.setMap(<span class="literal">null</span>);</span></span><br><span class="line">                    map.setCenter(result.detail.location);</span><br><span class="line"><span class="javascript">                    marker = <span class="keyword">new</span> qq.maps.Marker(&#123;</span></span><br><span class="line">                        map: map,</span><br><span class="line">                        position: result.detail.location</span><br><span class="line">                    &#125;);</span><br><span class="line"><span class="javascript">                    <span class="built_in">document</span>.getElementById(<span class="string">"latitude"</span>).value = marker.position.lat;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">document</span>.getElementById(<span class="string">"longitude"</span>).value = marker.position.lng;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">            <span class="comment">//查询按钮绑定事件</span></span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#mapseacrh"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                geocoder.getLocation($(<span class="string">"#address"</span>).val());</span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="javascript">            <span class="comment">//输入框值变化绑定事件</span></span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#address"</span>).bind(<span class="string">"input propertychange change"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                geocoder.getLocation($(<span class="string">"#address"</span>).val());</span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="javascript">            <span class="comment">//回车事件绑定事件</span></span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#address"</span>).keypress(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (e.which == <span class="number">13</span>) geocoder.getLocation($(<span class="string">"#address"</span>).val());</span></span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">            <span class="comment">//确定</span></span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#confirm"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//关闭事件给上一个页面传参赋值自动关闭当前窗口</span></span></span><br><span class="line"><span class="javascript">                lng = <span class="built_in">document</span>.getElementById(<span class="string">"longitude"</span>).value;</span></span><br><span class="line"><span class="javascript">                lat = <span class="built_in">document</span>.getElementById(<span class="string">"latitude"</span>).value;</span></span><br><span class="line"><span class="javascript">                ComToolsCloseWindow(<span class="string">"ok"</span>, <span class="literal">null</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    .font-style &#123;</span><br><span class="line">        /*background: #50a4ec;*/</span><br><span class="line">        display: inline-block;</span><br><span class="line">        font-size: 20px;</span><br><span class="line">        padding: 1px 10px;</span><br><span class="line">        font-weight: 600;</span><br><span class="line">        color: #4f5155;</span><br><span class="line">    &#125;</span><br><span class="line">        .font-style span &#123;</span><br><span class="line">            float: right;</span><br><span class="line">        &#125;</span><br><span class="line">    .form-control &#123;</span><br><span class="line">        width: 120px;</span><br><span class="line">        float: right;</span><br><span class="line">    &#125;</span><br><span class="line">    .box-group &#123;</span><br><span class="line">        /*background: rgba(125, 180, 200, 0.53);*/</span><br><span class="line">        padding: 5px;</span><br><span class="line">        float: left;</span><br><span class="line">    &#125;</span><br><span class="line">    #toolbar &#123;</span><br><span class="line">        padding: 10px 30px;</span><br><span class="line">        background: rgba(136, 195, 214, 0.89);</span><br><span class="line">    &#125;</span><br><span class="line">    .box-wight &#123;</span><br><span class="line">        width: 300px;</span><br><span class="line">    &#125;</span><br><span class="line">    .btn-primary &#123;</span><br><span class="line">        width: 80px;</span><br><span class="line">        margin-left: 30px;</span><br><span class="line">        margin-top: 3px;</span><br><span class="line">        padding: 4px 10px;</span><br><span class="line">        background: #f2f1ed;</span><br><span class="line">        color: #4f5155;</span><br><span class="line">        border: 0px solid #87c0d1;</span><br><span class="line">        font-size: 20px;</span><br><span class="line">        font-weight: 600;</span><br><span class="line">        letter-spacing: 2px;</span><br><span class="line">    &#125;</span><br><span class="line">        .btn-primary:hover &#123;</span><br><span class="line">            background: #ff9b08;</span><br><span class="line">            opacity: 0.8;</span><br><span class="line">        &#125;</span><br><span class="line">        .btn-primary:active &#123;</span><br><span class="line">            background: #ff9b08;</span><br><span class="line">            color: white;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://fangchenyong.top/2019/10/15/地图-腾讯地图坐标拾取器/" data-id="ckmh9z4770069roumr1dyc1o9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/地图/">地图</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/腾讯地图/">腾讯地图</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Java-源码-JDK8-String" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/06/Java-源码-JDK8-String/" class="article-date">
  <time datetime="2019-09-05T16:00:00.000Z" itemprop="datePublished">2019-09-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>►<a class="article-category-link" href="/categories/Java/源码/">源码</a>►<a class="article-category-link" href="/categories/Java/源码/String/">String</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/06/Java-源码-JDK8-String/">JDK8 String源码</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h1 id="JDK8-String"><a href="#JDK8-String" class="headerlink" title="JDK8 String"></a>JDK8 String</h1><h2 id="1-定义"><a href="#1-定义" class="headerlink" title="1.定义"></a>1.定义</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">Comparable</span>&lt;<span class="title">String</span>&gt;, <span class="title">CharSequence</span></span></span><br></pre></td></tr></table></figure>

<p>从上可以看出：</p>
<ul>
<li>String 是final类，不能被继承。</li>
<li>实现了java.io.Serializable接口，这个序列化接口没有任何方法和域，仅用于标识序列化的语意。</li>
<li>实现了Comparable<string>接口，这个接口只有一个compareTo(T 0)接口，用于对两个实例化对象比较大小。</string></li>
<li>实现了CharSequence接口，这个接口是一个只读的字符序列。包括length(), charAt(int index), subSequence(int start, int end)这几个API接口，值得一提的是，StringBuffer和StringBuild也是实现了该接口。</li>
</ul>
<h2 id="2-主要字段属性"><a href="#2-主要字段属性" class="headerlink" title="2.主要字段属性"></a>2.主要字段属性</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//用来存字符串，是一个final的char型数组，不可修改</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span>[] value;</span><br><span class="line"><span class="comment">//缓存字符串的哈希。而hash是String实例化的hashcode的一个缓存。因为String经常被用于比较，比如在HashMap中。如果每次进行比较都重新计算hashcode的值的话，那无疑是比较麻烦的，而保存一个hashcode的缓存无疑能优化这样的操作。</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> hash;</span><br><span class="line"><span class="comment">//实现序列化的标识</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">6849794470754667710L</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ObjectStreamField[] serialPersistentFields </span><br><span class="line">											= <span class="keyword">new</span> ObjectStreamField[<span class="number">0</span>];</span><br><span class="line"><span class="comment">//静态内部类，用于忽略大小写得比较两个字符串。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Comparator&lt;String&gt; CASE_INSENSITIVE_ORDER</span><br><span class="line">											= <span class="keyword">new</span> CaseInsensitiveComparator(<span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>

<h2 id="3-构造方法"><a href="#3-构造方法" class="headerlink" title="3.构造方法"></a>3.构造方法</h2><table>
<thead>
<tr>
<th>Constructor</th>
<th>Method</th>
</tr>
</thead>
<tbody><tr>
<td>String()</td>
<td>初始化新创建的 <code>String</code>对象，使其表示空字符序列。</td>
</tr>
<tr>
<td>String(byte[] bytes)</td>
<td>通过使用平台的默认字符集解码指定的字节数组来构造新的 <code>String</code> 。</td>
</tr>
<tr>
<td>String(byte[] bytes, Charset charset)</td>
<td>构造一个新的<code>String</code>由指定用指定的字节的数组解码charset 。</td>
</tr>
<tr>
<td>String(byte[] bytes, int offset, int length)</td>
<td>通过使用平台的默认字符集解码指定的字节子阵列来构造新的 <code>String</code> 。</td>
</tr>
<tr>
<td>String(byte[] bytes,  int offset, int length,Charset charset)</td>
<td>构造一个新的<code>String</code>通过使用指定的指定字节子阵列解码charset  。</td>
</tr>
<tr>
<td>String(byte[] bytes,  int offset, int length, String charsetName)</td>
<td>构造一个新的 <code>String</code>通过使用指定的字符集解码指定的字节子阵列。</td>
</tr>
<tr>
<td>String(byte[] bytes,  String charsetName)</td>
<td>构造一个新的<code>String</code>由指定用指定的字节的数组解码charset 。</td>
</tr>
<tr>
<td>String(char[] value)</td>
<td>分配一个新的 <code>String</code> ，以便它表示当前包含在字符数组参数中的字符序列。</td>
</tr>
<tr>
<td>String(char[] value,  int offset, int count)</td>
<td>分配一个新的 <code>String</code> ，其中包含字符数组参数的子阵列中的字符。</td>
</tr>
<tr>
<td>String(int[] codePoints,  int offset, int count)</td>
<td>分配一个新的 <code>String</code> ，其中包含 Unicode code  point数组参数的子阵列中的字符 。</td>
</tr>
<tr>
<td>String(String original)</td>
<td>初始化新创建的<code>String</code>对象，使其表示与参数相同的字符序列;  换句话说，新创建的字符串是参数字符串的副本。</td>
</tr>
<tr>
<td>String(StringBuffer buffer)</td>
<td>分配一个新的字符串，其中包含当前包含在字符串缓冲区参数中的字符序列。</td>
</tr>
<tr>
<td>String(StringBuilder builder)</td>
<td>分配一个新的字符串，其中包含当前包含在字符串构建器参数中的字符序列。</td>
</tr>
</tbody></table>
<h2 id="4-常用方法"><a href="#4-常用方法" class="headerlink" title="4.常用方法"></a>4.常用方法</h2><ul>
<li><p><strong>长度和判空</strong></p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//返回的就是char数组的长度，中文是两个字节的，char也是两个字节的。String a="中文"，a的长度为2。</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">length</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value.length;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当char数组的长度为0，则代表String为""，是空字符串</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value.length == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>charAt、codePointAt类函数</strong></p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//返回String对象的char数组index位置的元素</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">char</span> <span class="title">charAt</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ((index &lt; <span class="number">0</span>) || (index &gt;= value.length)) &#123;   <span class="comment">//index不允许小于0，不允许大于等于String的长度</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value[index];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回String对象的char数组index位置的元素的ASSIC码(int类型)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">codePointAt</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ((index &lt; <span class="number">0</span>) || (index &gt;= value.length)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Character.codePointAtImpl(value, index, value.length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回index位置元素的前一个元素的ASSIC码(int型)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">codePointBefore</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = index - <span class="number">1</span>;  <span class="comment">//获得index前一个元素的索引位置</span></span><br><span class="line">    <span class="keyword">if</span> ((i &lt; <span class="number">0</span>) || (i &gt;= value.length)) &#123; <span class="comment">//所以，index不能等于0，因为i = 0 - 1 = -1</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Character.codePointBeforeImpl(value, index, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 方法返回的是代码点个数，是实际上的字符个数,功能类似于length()</span></span><br><span class="line"><span class="comment">* 对于正常的String来说，length方法和codePointCount没有区别，都是返回字符个数。</span></span><br><span class="line"><span class="comment">* 但当String是Unicode类型时则有区别了。</span></span><br><span class="line"><span class="comment">* 例如：String str = “/uD835/uDD6B” (即使 'Z' ), length() = 2 ,codePointCount() = 1 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">codePointCount</span><span class="params">(<span class="keyword">int</span> beginIndex, <span class="keyword">int</span> endIndex)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (beginIndex &lt; <span class="number">0</span> || endIndex &gt; value.length || beginIndex &gt; endIndex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Character.codePointCountImpl(value, beginIndex, endIndex - beginIndex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 也是相对Unicode字符集而言的，从index索引位置算起，偏移codePointOffset个位置，返回偏移后的位置是多少</span></span><br><span class="line"><span class="comment">* 例如，index = 2 ，codePointOffset = 3 ，maybe返回 5 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">offsetByCodePoints</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">int</span> codePointOffset)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; value.length) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Character.offsetByCodePointsImpl(value, <span class="number">0</span>, value.length,</span><br><span class="line">                                            index, codePointOffset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>getChars、getBytes类函数</strong></p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 这是一个不对外的方法，是给String内部调用的，因为它是没有访问修饰符的，只允许同一包下的类访问</span></span><br><span class="line"><span class="comment">* 参数：dst[]是目标数组，dstBegin是目标数组的偏移量，既要复制过去的起始位置(从目标数组的什么位置覆盖)</span></span><br><span class="line"><span class="comment">* 作用就是将String的字符数组value整个复制到dst字符数组中，在dst数组的dstBegin位置开始拷贝</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getChars</span><span class="params">(<span class="keyword">char</span> dst[], <span class="keyword">int</span> dstBegin)</span> </span>&#123;</span><br><span class="line">    System.arraycopy(value, <span class="number">0</span>, dst, dstBegin, value.length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 得到char字符数组，原理是getChars() 方法将一个字符串的字符复制到目标字符数组中。 </span></span><br><span class="line"><span class="comment">* 参数：srcBegin是原始字符串的起始位置，srcEnd是原始字符串要复制的字符末尾的后一个位置(既复制区域不包括srcEnd)</span></span><br><span class="line"><span class="comment">* dst[]是目标字符数组，dstBegin是目标字符的复制偏移量，复制的字符从目标字符数组的dstBegin位置开始覆盖。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getChars</span><span class="params">(<span class="keyword">int</span> srcBegin, <span class="keyword">int</span> srcEnd, <span class="keyword">char</span> dst[], <span class="keyword">int</span> dstBegin)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (srcBegin &lt; <span class="number">0</span>) &#123;           <span class="comment">//如果srcBegin小于，抛异常</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(srcBegin);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (srcEnd &gt; value.length) &#123;  <span class="comment">//如果srcEnd大于字符串的长度，抛异常</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(srcEnd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (srcBegin &gt; srcEnd) &#123;      <span class="comment">//如果原始字符串其实位置大于末尾位置，抛异常</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(srcEnd - srcBegin);</span><br><span class="line">    &#125;</span><br><span class="line">    System.arraycopy(value, srcBegin, dst, dstBegin, srcEnd - srcBegin);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获得charsetName编码格式的bytes数组</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] getBytes(String charsetName)</span><br><span class="line">    <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">    <span class="keyword">if</span> (charsetName == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">return</span> StringCoding.encode(charsetName, value, <span class="number">0</span>, value.length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//与上个方法类似，java内部存储字符串使用的unicode编码，注意编码转换！！！</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] getBytes(Charset charset) &#123;</span><br><span class="line">    <span class="keyword">if</span> (charset == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">return</span> StringCoding.encode(charset, value, <span class="number">0</span>, value.length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用平台默认的编码格式获得bytes数组</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] getBytes() &#123;</span><br><span class="line">    <span class="keyword">return</span> StringCoding.encode(value, <span class="number">0</span>, value.length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  <strong>注意：</strong></p>
<ul>
<li>getChars是没有返回值的 ，使用System.arraycopy()方法直接拷贝至目标数组中，并且目标数组有个@NotNull非空注解，否则会抛出java.lang.ArrayIndexOutOfBoundsException异常。</li>
<li>getBytes是由返回值的。</li>
</ul>
</li>
<li><p><strong>equals类函数</strong></p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* String的equals方法，重写了Object的equals方法（区分大小写）</span></span><br><span class="line"><span class="comment">* 比较的是两个字符串的值是否相等</span></span><br><span class="line"><span class="comment">* 参数是一个Object对象，而不是一个String对象。这是因为重写的是Object的equals方法，所以是Object</span></span><br><span class="line"><span class="comment">* 如果是String自己独有的方法，则可以传入String对象，不用多此一举</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* 实例：str1.equals(str2)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object anObject)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> == anObject) &#123;   <span class="comment">//首先判断形参str2是否跟当前对象str1是同一个对象，既比较地址是否相等</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;          <span class="comment">//如果地址相等，那么自然值也相等，毕竟是同一个字符串对象</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (anObject <span class="keyword">instanceof</span> String) &#123;  <span class="comment">//判断str2对象是否是一个String类型，过滤掉非String类型的比较</span></span><br><span class="line">        String anotherString = (String)anObject; <span class="comment">//如果是String类型，转换为String类型</span></span><br><span class="line">        <span class="keyword">int</span> n = value.length;                    <span class="comment">//获得当前对象str1的长度</span></span><br><span class="line">        <span class="keyword">if</span> (n == anotherString.value.length) &#123;   <span class="comment">//比较str1的长度和str2的长度是否相等</span></span><br><span class="line">            <span class="keyword">char</span> v1[] = value;  <span class="comment">//v1为当前对象str1的值，v2为参数对象str2的值</span></span><br><span class="line">            <span class="keyword">char</span> v2[] = anotherString.value;</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">0</span>;                <span class="comment">//就类似于for的int i =0的作用，因为这里使用while</span></span><br><span class="line">            <span class="keyword">while</span> (n-- != <span class="number">0</span>) &#123;                <span class="comment">//每次循环长度-1,直到长度消耗完，循环结束 </span></span><br><span class="line">                <span class="keyword">if</span> (v1[i] != v2[i])              <span class="comment">//同索引位置的字符元素逐一比较</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;                <span class="comment">//只要有一个不相等，则返回false</span></span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;                     <span class="comment">//如比较期间没有问题，则说明相等，返回true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 这也是一个String的equals方法，与上一个方法不同，该方法(不区分大小写)，从名字也能看出来</span></span><br><span class="line"><span class="comment">* 是对String的equals方法的补充。</span></span><br><span class="line"><span class="comment">* 这里参数这是一个String对象，而不是Object了，因为这是String本身的方法，不是重写谁的方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equalsIgnoreCase</span><span class="params">(String anotherString)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">this</span> == anotherString) ? <span class="keyword">true</span>        <span class="comment">//一样，先判断是否为同一个对象</span></span><br><span class="line">        : (anotherString != <span class="keyword">null</span>) </span><br><span class="line">    		&amp;&amp; (anotherString.value.length == value.length) <span class="comment">//再判断长度是否相等</span></span><br><span class="line">    		&amp;&amp; regionMatches(<span class="keyword">true</span>, <span class="number">0</span>, anotherString, <span class="number">0</span>, value.length);  <span class="comment">//再执行regionMatchs方法 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 这是一个公有的比较方法，参数是StringBuffer类型</span></span><br><span class="line"><span class="comment">* 实际调用的是contentEquals(CharSequence cs)方法，可以说是StringBuffer的特供版</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contentEquals</span><span class="params">(StringBuffer sb)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> contentEquals((CharSequence)sb);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 这是一个私有方法，特供给比较StringBuffer和StringBuilder使用的。</span></span><br><span class="line"><span class="comment">* 比如在contentEquals方法中使用，参数是AbstractStringBuilder抽象类的子类</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">nonSyncContentEquals</span><span class="params">(AbstractStringBuilder sb)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> v1[] = value;               <span class="comment">//当前String对象的值</span></span><br><span class="line">    <span class="keyword">char</span> v2[] = sb.getValue();       <span class="comment">//AbstractStringBuilder子类对象的值</span></span><br><span class="line">    <span class="keyword">int</span> n = v1.length;         <span class="comment">//后面就不说了，其实跟equals方法是一样的，只是少了一些判断</span></span><br><span class="line">    <span class="keyword">if</span> (n != sb.length()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v1[i] != v2[i]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 这是一个常用于String对象跟StringBuffer和StringBuilder比较的方法</span></span><br><span class="line"><span class="comment">* 参数是StringBuffer或StringBuilder或String或CharSequence</span></span><br><span class="line"><span class="comment">* StringBuffer和StringBuilder和String都实现了CharSequence接口</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contentEquals</span><span class="params">(CharSequence cs)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Argument is a StringBuffer, StringBuilder</span></span><br><span class="line">    <span class="keyword">if</span> (cs <span class="keyword">instanceof</span> AbstractStringBuilder) &#123;   <span class="comment">//如果是AbstractStringBuilder抽象类或其子类</span></span><br><span class="line">        <span class="keyword">if</span> (cs <span class="keyword">instanceof</span> StringBuffer) &#123;        <span class="comment">//如果是StringBuffer类型，进入同步块</span></span><br><span class="line">            <span class="keyword">synchronized</span>(cs) &#123;</span><br><span class="line">                <span class="keyword">return</span> nonSyncContentEquals((AbstractStringBuilder)cs);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;                            <span class="comment">//如果是StringBuilder类型，则进入非同步块</span></span><br><span class="line">            <span class="keyword">return</span> nonSyncContentEquals((AbstractStringBuilder)cs);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/***下面就是String和CharSequence类型的比较算法*****/</span></span><br><span class="line">    <span class="comment">// Argument is a String</span></span><br><span class="line">    <span class="keyword">if</span> (cs <span class="keyword">instanceof</span> String) &#123;                    </span><br><span class="line">        <span class="keyword">return</span> equals(cs);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Argument is a generic CharSequence</span></span><br><span class="line">    <span class="keyword">char</span> v1[] = value;</span><br><span class="line">    <span class="keyword">int</span> n = v1.length;</span><br><span class="line">    <span class="keyword">if</span> (n != cs.length()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v1[i] != cs.charAt(i)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  <strong>注意：</strong></p>
<ul>
<li>equals()方法怎么重写Object中的equals()实现对String内容的判断</li>
<li>equalsIgnoreCase()方法是对equals()方法补充，不区分大小写的判断，是String类自己的方法</li>
<li>contentEquals()则是用于String对象与4种类型的判断，通常用于跟StringBuilder和StringBuffer的判断,也是对equals方法的一个补充，如果是参数是String类型，就调用equals()方法</li>
</ul>
</li>
<li><p><strong>regionMatchs()方法</strong></p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 这是一个类似于equals的方法，比较的是字符串的片段，也即是部分区域的比较</span></span><br><span class="line"><span class="comment">* toffset是当前字符串的比较起始位置(偏移量),other是要比较的String对象参数，ooffset是要参数String的比较片段起始位置，len是两个字符串要比较的片段的长度大小</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* 例子：String str1 = "0123456",Str2 = "0123456789"; </span></span><br><span class="line"><span class="comment">* str1.regionMatchs(0,str2,0,6);意思是str1从0位置开始于str2的0位置开始比较6个长度的字符串片段</span></span><br><span class="line"><span class="comment">* 相等则返回 true,不等返回false </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">regionMatches</span><span class="params">(<span class="keyword">int</span> toffset, String other, <span class="keyword">int</span> ooffset, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> ta[] = value;  <span class="comment">//当前对象的值</span></span><br><span class="line">    <span class="keyword">int</span> to = toffset;   <span class="comment">//当前对象的比较片段的起始位置，既偏移量</span></span><br><span class="line">    <span class="keyword">char</span> pa[] = other.value;  <span class="comment">//参数，既比较字符串的值</span></span><br><span class="line">    <span class="keyword">int</span> po = ooffset;         <span class="comment">//比较字符串的起始位置</span></span><br><span class="line">    <span class="comment">// Note: toffset, ooffset, or len might be near -1&gt;&gt;&gt;1.</span></span><br><span class="line">    <span class="keyword">if</span> ((ooffset &lt; <span class="number">0</span>) || (toffset &lt; <span class="number">0</span>)  <span class="comment">//起始位置不小于0或起始位置不大于字符串长度 - 片段长度，大于就截取不到这么长的片段了</span></span><br><span class="line">        || (toffset &gt; (<span class="keyword">long</span>)value.length - len)</span><br><span class="line">        || (ooffset &gt; (<span class="keyword">long</span>)other.value.length - len)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;      <span class="comment">//惊讶脸，居然不是抛异常，而是返回false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (len-- &gt; <span class="number">0</span>) &#123;               <span class="comment">//使用while循环，当然也可以使for循环</span></span><br><span class="line">        <span class="keyword">if</span> (ta[to++] != pa[po++]) &#123;   <span class="comment">//片段区域的字符元素逐个比较</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 这个跟上面的方法一样，只不过多了一个参数，既ignoreCase,既是否为区分大小写。</span></span><br><span class="line"><span class="comment">* 是equalsIgnoreCase()方法的片段比较版本，实际上equalsIgnoreCase()也是调用regionMatches函数</span></span><br><span class="line"><span class="comment">*/</span>	</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">regionMatches</span><span class="params">(<span class="keyword">boolean</span> ignoreCase, <span class="keyword">int</span> toffset,</span></span></span><br><span class="line"><span class="function"><span class="params">                             String other, <span class="keyword">int</span> ooffset, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> ta[] = value;</span><br><span class="line">    <span class="keyword">int</span> to = toffset;</span><br><span class="line">    <span class="keyword">char</span> pa[] = other.value;</span><br><span class="line">    <span class="keyword">int</span> po = ooffset;</span><br><span class="line">    <span class="comment">// Note: toffset, ooffset, or len might be near -1&gt;&gt;&gt;1.</span></span><br><span class="line">    <span class="keyword">if</span> ((ooffset &lt; <span class="number">0</span>) || (toffset &lt; <span class="number">0</span>)</span><br><span class="line">        || (toffset &gt; (<span class="keyword">long</span>)value.length - len)</span><br><span class="line">        || (ooffset &gt; (<span class="keyword">long</span>)other.value.length - len)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//上面的解释同上</span></span><br><span class="line">    <span class="keyword">while</span> (len-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">char</span> c1 = ta[to++];</span><br><span class="line">        <span class="keyword">char</span> c2 = pa[po++];</span><br><span class="line">        <span class="keyword">if</span> (c1 == c2) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ignoreCase) &#123;   <span class="comment">//当ignoreCase为true时，既忽视大小写时</span></span><br><span class="line">            <span class="comment">// If characters don't match but case may be ignored,</span></span><br><span class="line">            <span class="comment">// try converting both characters to uppercase.</span></span><br><span class="line">            <span class="comment">// If the results match, then the comparison scan should</span></span><br><span class="line">            <span class="comment">// continue.</span></span><br><span class="line">            <span class="keyword">char</span> u1 = Character.toUpperCase(c1);   <span class="comment">//片段中每个字符转换为大写</span></span><br><span class="line">            <span class="keyword">char</span> u2 = Character.toUpperCase(c2);</span><br><span class="line">            <span class="keyword">if</span> (u1 == u2) &#123; <span class="comment">//大写比较一次，如果相等则不执行下面的语句，进入下一个循环</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Unfortunately, conversion to uppercase does not work properly</span></span><br><span class="line">            <span class="comment">// for the Georgian alphabet, which has strange rules about case</span></span><br><span class="line">            <span class="comment">// conversion.  So we need to make one last check before</span></span><br><span class="line">            <span class="comment">// exiting.</span></span><br><span class="line">            <span class="keyword">if</span> (Character.toLowerCase(u1) == Character.toLowerCase(u2)) &#123;</span><br><span class="line">                <span class="comment">//每个字符换行成小写比较一次</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  <strong>从上可以看出：</strong></p>
<ul>
<li>片段比较时针对的是String对象。所以如果要跟StringBuffer和StringBuilder比较，那么要toString。</li>
<li>两个字符串之间的片段比较，使用regionMatches，完整的比较，使用equals。</li>
</ul>
</li>
<li><p><strong>compareTo类函数和CaseInsensitiveComparator静态内部类</strong></p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 这是一个比较字符串中字符大小的函数，因为String实现了Comparable&lt;String&gt;接口，所以重写了compareTo方法</span></span><br><span class="line"><span class="comment">* Comparable是排序接口。若一个类实现了Comparable接口，就意味着该类支持排序。</span></span><br><span class="line"><span class="comment">* 实现了Comparable接口的类的对象的列表或数组可以通过Collections.sort或Arrays.sort进行自动排序。</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* 参数是需要比较的另一个String对象</span></span><br><span class="line"><span class="comment">* 返回的int类型，正数为大，负数为小，是基于字符的ASSIC码比较的</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(String anotherString)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len1 = value.length;                  <span class="comment">//当前对象的长度</span></span><br><span class="line">    <span class="keyword">int</span> len2 = anotherString.value.length;    <span class="comment">//比较对象的长度</span></span><br><span class="line">    <span class="keyword">int</span> lim = Math.min(len1, len2);           <span class="comment">//获得最小长度</span></span><br><span class="line">    <span class="keyword">char</span> v1[] = value;                        <span class="comment">//获得当前对象的值</span></span><br><span class="line">    <span class="keyword">char</span> v2[] = anotherString.value;          <span class="comment">//获得比较对象的值</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">0</span>;                    <span class="comment">//相当于for的int k = 0,就是为while循环的数组服务的</span></span><br><span class="line">    <span class="keyword">while</span> (k &lt; lim) &#123;             <span class="comment">//当当前索引小于两个字符串中较短字符串的长度时，循环继续</span></span><br><span class="line">        <span class="keyword">char</span> c1 = v1[k];          <span class="comment">//获得当前对象的字符</span></span><br><span class="line">        <span class="keyword">char</span> c2 = v2[k];          <span class="comment">//获得比较对象的字符</span></span><br><span class="line">        <span class="keyword">if</span> (c1 != c2) &#123;    <span class="comment">//从前向后遍历，只要其实一个不相等，返回字符ASSIC的差值,int类型</span></span><br><span class="line">            <span class="keyword">return</span> c1 - c2;</span><br><span class="line">        &#125;</span><br><span class="line">        k++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> len1 - len2;   <span class="comment">//如果两个字符串同样位置的索引都相等，返回长度差值，完全相等则为0</span></span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*  这时一个类似compareTo功能的方法，但是不是comparable接口的方法，是String本身的方法</span></span><br><span class="line"><span class="comment">*  使用途径，我目前只知道可以用来不区分大小写的比较大小，但是不知道如何让它被工具类Collections和Arrays运用</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareToIgnoreCase</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> CASE_INSENSITIVE_ORDER.compare(<span class="keyword">this</span>, str);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 这是一个饿汉单例模式，是String类型的一个不区分大小写的比较器</span></span><br><span class="line"><span class="comment">* 提供给Collections和Arrays的sort方法使用</span></span><br><span class="line"><span class="comment">* 例如：Arrays.sort(strs,String.CASE_INSENSITIVE_ORDER);</span></span><br><span class="line"><span class="comment">* 效果就是会将strs字符串数组中的字符串对象进行忽视大小写的排序</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Comparator&lt;String&gt; CASE_INSENSITIVE_ORDER</span><br><span class="line">                                         = <span class="keyword">new</span> CaseInsensitiveComparator();</span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 这一个私有的静态内部类，只允许String类本身调用</span></span><br><span class="line"><span class="comment">* 实现了序列化接口和比较器接口，comparable接口和comparator是有区别的</span></span><br><span class="line"><span class="comment">* 重写了compare方法，该静态内部类实际就是一个String类的比较器</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CaseInsensitiveComparator</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">String</span>&gt;, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// use serialVersionUID from JDK 1.2.2 for interoperability</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">8575799808933029326L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(String s1, String s2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n1 = s1.length();                 <span class="comment">//s1字符串的长度</span></span><br><span class="line">        <span class="keyword">int</span> n2 = s2.length();                 <span class="comment">//s2字符串的长度</span></span><br><span class="line">        <span class="keyword">int</span> min = Math.min(n1, n2);           <span class="comment">//获得最小长度 </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; min; i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> c1 = s1.charAt(i);           <span class="comment">//逐一获得字符串i位置的字符</span></span><br><span class="line">            <span class="keyword">char</span> c2 = s2.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (c1 != c2) &#123;                   <span class="comment">//部分大小写比较一次</span></span><br><span class="line">                c1 = Character.toUpperCase(c1);    <span class="comment">//转换大写比较一次</span></span><br><span class="line">                c2 = Character.toUpperCase(c2);</span><br><span class="line">                <span class="keyword">if</span> (c1 != c2) &#123;</span><br><span class="line">                    c1 = Character.toLowerCase(c1);  <span class="comment">//转换小写比较一次</span></span><br><span class="line">                    c2 = Character.toLowerCase(c2);</span><br><span class="line">                    <span class="keyword">if</span> (c1 != c2) &#123;                  <span class="comment">//返回字符差值</span></span><br><span class="line">                        <span class="comment">// No overflow because of numeric promotion</span></span><br><span class="line">                        <span class="keyword">return</span> c1 - c2;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n1 - n2;<span class="comment">//如果字符相等，但长度不等，则返回长度差值，短的教小，所以小-大为负数</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Replaces the de-serialized object. */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Object <span class="title">readResolve</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> CASE_INSENSITIVE_ORDER; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  以上的代码可以看出：</p>
<p>  以上的最大问题可以能就是为什么要有个静态内部类，为什么实现了compareTo又有compare，移步到下面，有解答</p>
<p>  String实现了comparable接口，重写了compareTo方法，可以用于自己写类进行判断排序，也可以使用collections，Arrays工具类的sort进行排序。只有集合或数组中的元素实现了comparable接口，并重写了compareTo才能使用工具类排序。</p>
<p>  CASE_INSENSITIVE_ORDER是一个单例，是String提供为外部的比较器，该比较器的作用是忽视大小写进行比较，我们可以通过Collections或Arrays的sort方法将CASE_INSENSITIVE_ORDER比较器作为参数传入，进行排序。</p>
</li>
<li><p><strong>startWith、endWith类函数</strong></p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 作用就是当前对象[toffset,toffset + prefix.value.lenght]区间的字符串片段等于prefix</span></span><br><span class="line"><span class="comment">* 也可以说当前对象的toffset位置开始是否以prefix作为前缀</span></span><br><span class="line"><span class="comment">* prefix是需要判断的前缀字符串，toffset是当前对象的判断起始位置</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">startsWith</span><span class="params">(String prefix, <span class="keyword">int</span> toffset)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> ta[] = value;     <span class="comment">//获得当前对象的值</span></span><br><span class="line">    <span class="keyword">int</span> to = toffset;      <span class="comment">//获得需要判断的起始位置，偏移量</span></span><br><span class="line">    <span class="keyword">char</span> pa[] = prefix.value; <span class="comment">//获得前缀字符串的值</span></span><br><span class="line">    <span class="keyword">int</span> po = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> pc = prefix.value.length;</span><br><span class="line">    <span class="comment">// Note: toffset might be near -1&gt;&gt;&gt;1.</span></span><br><span class="line">    <span class="keyword">if</span> ((toffset &lt; <span class="number">0</span>) || (toffset &gt; value.length - pc)) &#123;  <span class="comment">//偏移量不能小于0且能截取pc个长度</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;  <span class="comment">//不能则返回false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (--pc &gt;= <span class="number">0</span>) &#123;                  <span class="comment">//循环pc次，既prefix的长度</span></span><br><span class="line">        <span class="keyword">if</span> (ta[to++] != pa[po++]) &#123;      <span class="comment">//每次比较当前对象的字符串的字符是否跟prefix一样</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;                <span class="comment">//一样则pc--,to++,po++,有一个不同则返回false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;  <span class="comment">//没有不一样则返回true，当前对象是以prefix在toffset位置做为开头</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 判断当前字符串对象是否以字符串prefix起头</span></span><br><span class="line"><span class="comment">* 是返回true,否返回fasle</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">startsWith</span><span class="params">(String prefix)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> startsWith(prefix, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 判断当前字符串对象是否以字符串prefix结尾</span></span><br><span class="line"><span class="comment">* 是返回true,否返回fasle</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">endsWith</span><span class="params">(String suffix)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//suffix是需要判断是否为尾部的字符串。</span></span><br><span class="line">    <span class="comment">//value.length - suffix.value.length是suffix在当前对象的起始位置</span></span><br><span class="line">    <span class="keyword">return</span> startsWith(suffix, value.length - suffix.value.length); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  <strong>所以我们知道：</strong></p>
<ul>
<li>endsWith的实现也是startWith()，作用就是判断前后缀</li>
</ul>
</li>
<li><p><strong>hashCode()函数</strong></p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 这是String字符串重写了Object类的hashCode方法。</span></span><br><span class="line"><span class="comment">   * 给由哈希表来实现的数据结构来使用，比如String对象要放入HashMap中。</span></span><br><span class="line"><span class="comment">   * 如果没有重写HashCode，或HaseCode质量很差则会导致严重的后果，既不靠谱的后果</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h = hash;  <span class="comment">//hash是属性字段，是成员变量，所以默认为0</span></span><br><span class="line">    <span class="keyword">if</span> (h == <span class="number">0</span> &amp;&amp; value.length &gt; <span class="number">0</span>) &#123; <span class="comment">//如果hash为0，且字符串对象长度大于0，不为""</span></span><br><span class="line">        <span class="keyword">char</span> val[] = value;   <span class="comment">//获得当前对象的值</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//重点，String的哈希函数</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; value.length; i++) &#123;  <span class="comment">//遍历len次</span></span><br><span class="line">            h = <span class="number">31</span> * h + val[i]; <span class="comment">//每次都是31 * 每次循环获得的h +第i个字符的ASSIC码</span></span><br><span class="line">        &#125;</span><br><span class="line">        hash = h;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> h;  <span class="comment">//由此可见""空字符对象的哈希值为0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  <strong>所以我们可以知道：</strong></p>
<ul>
<li>hashCode的重点就是哈希函数</li>
<li>String的哈希函数就是循环len次，每次循环体为 <code>31 * 每次循环获得的hash + 第i次循环的字符</code></li>
</ul>
</li>
<li><p>indexOf、lastIndexOf类函数</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 返回cn对应的字符在字符串中第一次出现的位置，从字符串的索引0位置开始遍历</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(<span class="keyword">int</span> ch)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> indexOf(ch, <span class="number">0</span>);</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * index方法就是返回ch字符第一次在字符串中出现的位置</span></span><br><span class="line"><span class="comment"> * 既从fromIndex位置开始查找，从头向尾遍历，ch整数对应的字符在字符串中第一次出现的位置</span></span><br><span class="line"><span class="comment"> * -1代表字符串没有这个字符，整数代表字符第一次出现在字符串的位置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(<span class="keyword">int</span> ch, <span class="keyword">int</span> fromIndex)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">final</span> <span class="keyword">int</span> max = value.length; <span class="comment">//获得字符串对象的长度</span></span><br><span class="line">       <span class="keyword">if</span> (fromIndex &lt; <span class="number">0</span>) &#123;             <span class="comment">//如果偏移量小于0，则代表偏移量为0，校正偏移量</span></span><br><span class="line">           fromIndex = <span class="number">0</span>;</span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fromIndex &gt;= max) &#123;   <span class="comment">//如果偏移量大于最大长度，则返回-1，代表没有字符串没有ch对应的字符</span></span><br><span class="line">           <span class="comment">// Note: fromIndex might be near -1&gt;&gt;&gt;1.</span></span><br><span class="line">           <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line">    </span><br><span class="line">       <span class="keyword">if</span> (ch &lt; Character.MIN_SUPPLEMENTARY_CODE_POINT) &#123; <span class="comment">//emmm,这个判断，不懂</span></span><br><span class="line">           <span class="comment">// handle most cases here (ch is a BMP code point or a</span></span><br><span class="line">           <span class="comment">// negative value (invalid code point))</span></span><br><span class="line">           <span class="keyword">final</span> <span class="keyword">char</span>[] value = <span class="keyword">this</span>.value;             <span class="comment">//获得字符串值</span></span><br><span class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> i = fromIndex; i &lt; max; i++) &#123;      <span class="comment">//从fromIndex位置开始向后遍历</span></span><br><span class="line">               <span class="keyword">if</span> (value[i] == ch) &#123;                    <span class="comment">//只有字符串中的某个位置的元素等于ch</span></span><br><span class="line">                   <span class="keyword">return</span> i;                            <span class="comment">//返回对应的位置，函数结束，既第一次出现的位置</span></span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span> -<span class="number">1</span>;  <span class="comment">//如果没有出现，则返回-1</span></span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> indexOfSupplementary(ch, fromIndex);  <span class="comment">//emmm,紧紧接着没看懂的地方</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">indexOfSupplementary</span><span class="params">(<span class="keyword">int</span> ch, <span class="keyword">int</span> fromIndex)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (Character.isValidCodePoint(ch)) &#123;</span><br><span class="line">           <span class="keyword">final</span> <span class="keyword">char</span>[] value = <span class="keyword">this</span>.value;</span><br><span class="line">           <span class="keyword">final</span> <span class="keyword">char</span> hi = Character.highSurrogate(ch);</span><br><span class="line">           <span class="keyword">final</span> <span class="keyword">char</span> lo = Character.lowSurrogate(ch);</span><br><span class="line">           <span class="keyword">final</span> <span class="keyword">int</span> max = value.length - <span class="number">1</span>;</span><br><span class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> i = fromIndex; i &lt; max; i++) &#123;</span><br><span class="line">               <span class="keyword">if</span> (value[i] == hi &amp;&amp; value[i + <span class="number">1</span>] == lo) &#123;</span><br><span class="line">                   <span class="keyword">return</span> i;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 从尾部向头部遍历，返回cn第一次出现的位置，value.length - 1就是起点 </span></span><br><span class="line"><span class="comment">* 为了理解，我们可以认为是返回cn对应的字符在字符串中最后出现的位置</span></span><br><span class="line"><span class="comment">*  </span></span><br><span class="line"><span class="comment">* ch是字符对应的整数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lastIndexOf</span><span class="params">(<span class="keyword">int</span> ch)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> lastIndexOf(ch, value.length - <span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 从尾部向头部遍历，从fromIndex开始作为起点，返回ch对应字符第一次在字符串出现的位置</span></span><br><span class="line"><span class="comment">* 既从头向尾遍历，返回cn对应字符在字符串中最后出现的一次位置，fromIndex为结束点</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lastIndexOf</span><span class="params">(<span class="keyword">int</span> ch, <span class="keyword">int</span> fromIndex)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (ch &lt; Character.MIN_SUPPLEMENTARY_CODE_POINT) &#123;  <span class="comment">//之后不解释了,emmmmmmm</span></span><br><span class="line">           <span class="comment">// handle most cases here (ch is a BMP code point or a</span></span><br><span class="line">           <span class="comment">// negative value (invalid code point))</span></span><br><span class="line">           <span class="keyword">final</span> <span class="keyword">char</span>[] value = <span class="keyword">this</span>.value;</span><br><span class="line">           <span class="comment">//取最小值，作用就是校正，如果fromIndex传大了，就当时len - 1</span></span><br><span class="line">           <span class="keyword">int</span> i = Math.min(fromIndex, value.length - <span class="number">1</span>);   </span><br><span class="line">           <span class="keyword">for</span> (; i &gt;= <span class="number">0</span>; i--) &#123;      <span class="comment">//算法中是从后向前遍历，直到i&lt;0,退出循环</span></span><br><span class="line">               <span class="keyword">if</span> (value[i] == ch) &#123;  <span class="comment">//只有有相等，返回对应的索引位置</span></span><br><span class="line">                   <span class="keyword">return</span> i;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span> -<span class="number">1</span>;   <span class="comment">//没有找到则返回-1</span></span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> lastIndexOfSupplementary(ch, fromIndex);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">lastIndexOfSupplementary</span><span class="params">(<span class="keyword">int</span> ch, <span class="keyword">int</span> fromIndex)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (Character.isValidCodePoint(ch)) &#123;</span><br><span class="line">           <span class="keyword">final</span> <span class="keyword">char</span>[] value = <span class="keyword">this</span>.value;</span><br><span class="line">           <span class="keyword">char</span> hi = Character.highSurrogate(ch);</span><br><span class="line">           <span class="keyword">char</span> lo = Character.lowSurrogate(ch);</span><br><span class="line">           <span class="keyword">int</span> i = Math.min(fromIndex, value.length - <span class="number">2</span>);</span><br><span class="line">           <span class="keyword">for</span> (; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">               <span class="keyword">if</span> (value[i] == hi &amp;&amp; value[i + <span class="number">1</span>] == lo) &#123;</span><br><span class="line">                   <span class="keyword">return</span> i;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 返回第一次出现的字符串的位置</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> indexOf(str, <span class="number">0</span>);</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* 从fromIndex开始遍历，返回第一次出现str字符串的位置</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(String str, <span class="keyword">int</span> fromIndex)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> indexOf(value, <span class="number">0</span>, value.length,</span><br><span class="line">               str.value, <span class="number">0</span>, str.value.length, fromIndex);</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 这是一个不对外公开的静态函数</span></span><br><span class="line"><span class="comment">* source就是原始字符串，sourceOffset就是原始字符串的偏移量，起始位置。</span></span><br><span class="line"><span class="comment">* sourceCount就是原始字符串的长度，target就是要查找的字符串。</span></span><br><span class="line"><span class="comment">* fromIndex就是从原始字符串的第fromIndex开始遍历</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">   <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(<span class="keyword">char</span>[] source, <span class="keyword">int</span> sourceOffset, <span class="keyword">int</span> sourceCount,</span></span></span><br><span class="line"><span class="function"><span class="params">           String target, <span class="keyword">int</span> fromIndex)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> indexOf(source, sourceOffset, sourceCount,</span><br><span class="line">                      target.value, <span class="number">0</span>, target.value.length,</span><br><span class="line">                      fromIndex);</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 同是一个不对外公开的静态函数</span></span><br><span class="line"><span class="comment">* 比上更为强大。</span></span><br><span class="line"><span class="comment">* 多了一个targetOffset和targetCount，既代表别查找的字符串也可以被切割</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">   <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(<span class="keyword">char</span>[] source, <span class="keyword">int</span> sourceOffset, <span class="keyword">int</span> sourceCount,</span></span></span><br><span class="line"><span class="function"><span class="params">           <span class="keyword">char</span>[] target, <span class="keyword">int</span> targetOffset, <span class="keyword">int</span> targetCount,</span></span></span><br><span class="line"><span class="function"><span class="params">           <span class="keyword">int</span> fromIndex)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (fromIndex &gt;= sourceCount) &#123;   <span class="comment">//如果查找的起点大于当前对象的大小</span></span><br><span class="line">        <span class="comment">//如果目标字符串的长度为0，则代表目标字符串为""，""在任何字符串都会出现</span></span><br><span class="line">        <span class="comment">//配合fromIndex &gt;= sourceCount,所以校正第一次出现在最尾部，仅仅是校正作用</span></span><br><span class="line">           <span class="keyword">return</span> (targetCount == <span class="number">0</span> ? sourceCount : -<span class="number">1</span>); </span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (fromIndex &lt; <span class="number">0</span>) &#123;  <span class="comment">//也是校正，如果起始点小于0，则返回0</span></span><br><span class="line">           fromIndex = <span class="number">0</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//如果目标字符串长度为0，代表为""，则第一次出现在遍历起始点fromIndex</span></span><br><span class="line">       <span class="keyword">if</span> (targetCount == <span class="number">0</span>) &#123; </span><br><span class="line">           <span class="keyword">return</span> fromIndex;</span><br><span class="line">       &#125;</span><br><span class="line">    </span><br><span class="line">       <span class="keyword">char</span> first = target[targetOffset];   <span class="comment">//目标字符串的第一个字符</span></span><br><span class="line">       <span class="keyword">int</span> max = sourceOffset + (sourceCount - targetCount); <span class="comment">//最大遍历次数</span></span><br><span class="line">    </span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = sourceOffset + fromIndex; i &lt;= max; i++) &#123;</span><br><span class="line">           <span class="comment">/* Look for first character. */</span></span><br><span class="line">           <span class="keyword">if</span> (source[i] != first) &#123;</span><br><span class="line">               <span class="keyword">while</span> (++i &lt;= max &amp;&amp; source[i] != first);</span><br><span class="line">           &#125;</span><br><span class="line">    </span><br><span class="line">           <span class="comment">/* Found first character, now look at the rest of v2 */</span></span><br><span class="line">           <span class="keyword">if</span> (i &lt;= max) &#123;</span><br><span class="line">               <span class="keyword">int</span> j = i + <span class="number">1</span>;</span><br><span class="line">               <span class="keyword">int</span> end = j + targetCount - <span class="number">1</span>;</span><br><span class="line">               <span class="keyword">for</span> (<span class="keyword">int</span> k = targetOffset + <span class="number">1</span>; j &lt; end &amp;&amp; source[j]</span><br><span class="line">                       == target[k]; j++, k++);</span><br><span class="line">    </span><br><span class="line">               <span class="keyword">if</span> (j == end) &#123;</span><br><span class="line">                   <span class="comment">/* Found whole string. */</span></span><br><span class="line">                   <span class="keyword">return</span> i - sourceOffset;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 查找字符串Str最后一次出现的位置</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lastIndexOf</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> lastIndexOf(str, value.length);</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lastIndexOf</span><span class="params">(String str, <span class="keyword">int</span> fromIndex)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> lastIndexOf(value, <span class="number">0</span>, value.length,</span><br><span class="line">               str.value, <span class="number">0</span>, str.value.length, fromIndex);</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">   <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lastIndexOf</span><span class="params">(<span class="keyword">char</span>[] source, <span class="keyword">int</span> sourceOffset, <span class="keyword">int</span> sourceCount,</span></span></span><br><span class="line"><span class="function"><span class="params">           String target, <span class="keyword">int</span> fromIndex)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> lastIndexOf(source, sourceOffset, sourceCount,</span><br><span class="line">                      target.value, <span class="number">0</span>, target.value.length,</span><br><span class="line">                      fromIndex);</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">   <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lastIndexOf</span><span class="params">(<span class="keyword">char</span>[] source, <span class="keyword">int</span> sourceOffset, <span class="keyword">int</span> sourceCount,</span></span></span><br><span class="line"><span class="function"><span class="params">           <span class="keyword">char</span>[] target, <span class="keyword">int</span> targetOffset, <span class="keyword">int</span> targetCount,</span></span></span><br><span class="line"><span class="function"><span class="params">           <span class="keyword">int</span> fromIndex)</span> </span>&#123;</span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * Check arguments; return immediately where possible. For</span></span><br><span class="line"><span class="comment">        * consistency, don't check for null str.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="keyword">int</span> rightIndex = sourceCount - targetCount;</span><br><span class="line">       <span class="keyword">if</span> (fromIndex &lt; <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (fromIndex &gt; rightIndex) &#123;</span><br><span class="line">           fromIndex = rightIndex;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">/* Empty string always matches. */</span></span><br><span class="line">       <span class="keyword">if</span> (targetCount == <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> fromIndex;</span><br><span class="line">       &#125;</span><br><span class="line">    </span><br><span class="line">       <span class="keyword">int</span> strLastIndex = targetOffset + targetCount - <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">char</span> strLastChar = target[strLastIndex];</span><br><span class="line">       <span class="keyword">int</span> min = sourceOffset + targetCount - <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">int</span> i = min + fromIndex;</span><br><span class="line">    </span><br><span class="line">   startSearchForLastChar:</span><br><span class="line">       <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">           <span class="keyword">while</span> (i &gt;= min &amp;&amp; source[i] != strLastChar) &#123;</span><br><span class="line">               i--;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (i &lt; min) &#123;</span><br><span class="line">               <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">int</span> j = i - <span class="number">1</span>;</span><br><span class="line">           <span class="keyword">int</span> start = j - (targetCount - <span class="number">1</span>);</span><br><span class="line">           <span class="keyword">int</span> k = strLastIndex - <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">           <span class="keyword">while</span> (j &gt; start) &#123;</span><br><span class="line">               <span class="keyword">if</span> (source[j--] != target[k--]) &#123;</span><br><span class="line">                   i--;</span><br><span class="line">                   <span class="keyword">continue</span> startSearchForLastChar;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span> start - sourceOffset + <span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>  <strong>从上可以看出：</strong></p>
<ul>
<li>只对外提供了int整形，String字符串两种参数的重载方法(虽然是Int型，其实我们就当做是传char也无所谓，因为虚拟机会帮我们解决这个事情的)</li>
</ul>
</li>
<li><p>substring()函数</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*  截取当前字符串对象的片段，组成一个新的字符串对象</span></span><br><span class="line"><span class="comment">*  beginIndex为截取的初始位置，默认截到len - 1位置</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">substring</span><span class="params">(<span class="keyword">int</span> beginIndex)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (beginIndex &lt; <span class="number">0</span>) &#123;   <span class="comment">//小于0抛异常</span></span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(beginIndex);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">int</span> subLen = value.length - beginIndex;  <span class="comment">//新字符串的长度</span></span><br><span class="line">       <span class="keyword">if</span> (subLen &lt; <span class="number">0</span>) &#123;       <span class="comment">//小于0抛异常</span></span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(subLen);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//如果beginIndex是0，则不用截取，返回自己(非新对象)，否则截取0到subLen位置，不包括(subLen)</span></span><br><span class="line">       <span class="keyword">return</span> (beginIndex == <span class="number">0</span>) ? <span class="keyword">this</span> : <span class="keyword">new</span> String(value, beginIndex, subLen);</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 截取一个区间范围</span></span><br><span class="line"><span class="comment">* [beginIndex,endIndex)，不包括endIndex</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">substring</span><span class="params">(<span class="keyword">int</span> beginIndex, <span class="keyword">int</span> endIndex)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (beginIndex &lt; <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(beginIndex);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (endIndex &gt; value.length) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(endIndex);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">int</span> subLen = endIndex - beginIndex;</span><br><span class="line">       <span class="keyword">if</span> (subLen &lt; <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(subLen);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> ((beginIndex == <span class="number">0</span>) &amp;&amp; (endIndex == value.length)) ? <span class="keyword">this</span></span><br><span class="line">               : <span class="keyword">new</span> String(value, beginIndex, subLen);</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">   <span class="function"><span class="keyword">public</span> CharSequence <span class="title">subSequence</span><span class="params">(<span class="keyword">int</span> beginIndex, <span class="keyword">int</span> endIndex)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">this</span>.substring(beginIndex, endIndex);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>  <strong>从上面可以看到：</strong></p>
<ul>
<li>substring函数是一个不完全闭包的区间，是[beginIndex,end)，不包括end位置</li>
<li><strong>subString的原理是通过String的构造函数实现的</strong></li>
</ul>
</li>
<li><p>concat()函数</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* String的拼接函数</span></span><br><span class="line"><span class="comment">* 例如:String  str = "abc"; str.concat("def")    output: "abcdef"</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">concat</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> otherLen = str.length();<span class="comment">//获得参数字符串的长度</span></span><br><span class="line">    <span class="keyword">if</span> (otherLen == <span class="number">0</span>) &#123; <span class="comment">//如果长度为0，则代表不需要拼接，因为str为""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/****重点****/</span></span><br><span class="line">    <span class="keyword">int</span> len = value.length;  <span class="comment">//获得当前对象的长度 </span></span><br><span class="line">    <span class="comment">//将数组扩容，将value数组拷贝到buf数组中，长度为len + str.lenght</span></span><br><span class="line">    <span class="keyword">char</span> buf[] = Arrays.copyOf(value, len + otherLen); </span><br><span class="line">    str.getChars(buf, len); <span class="comment">//然后将str字符串从buf字符数组的len位置开始覆盖，得到一个完整的buf字符数组</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(buf, <span class="keyword">true</span>);<span class="comment">//构建新的String对象，调用私有的String构造方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>replace、replaceAll类函数</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//替换，将字符串中的oldChar字符全部替换成newChar</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">replace</span><span class="params">(<span class="keyword">char</span> oldChar, <span class="keyword">char</span> newChar)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (oldChar != newChar) &#123;    <span class="comment">//如果旧字符不等于新字符的情况下</span></span><br><span class="line">        <span class="keyword">int</span> len = value.length;  <span class="comment">//获得字符串长度</span></span><br><span class="line">        <span class="keyword">int</span> i = -<span class="number">1</span>;              <span class="comment">//flag</span></span><br><span class="line">        <span class="keyword">char</span>[] val = value; <span class="comment">/* avoid getfield opcode */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (++i &lt; len) &#123;      <span class="comment">//循环len次</span></span><br><span class="line">            <span class="keyword">if</span> (val[i] == oldChar) &#123; <span class="comment">//找到第一个旧字符，打断循环</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; len) &#123;   <span class="comment">//如果第一个旧字符的位置小于len</span></span><br><span class="line">            <span class="keyword">char</span> buf[] = <span class="keyword">new</span> <span class="keyword">char</span>[len]; 新<span class="keyword">new</span>一个字符数组，len个长度</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">                    buf[j] = val[j];        把旧字符的前面的字符都复制到新字符数组上</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">while</span> (i &lt; len) &#123;           <span class="comment">//从i位置开始遍历</span></span><br><span class="line">                <span class="keyword">char</span> c = val[i];</span><br><span class="line">                buf[i] = (c == oldChar) ? newChar : c; <span class="comment">//发生旧字符就替换，不想关的则直接复制</span></span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(buf, <span class="keyword">true</span>);  <span class="comment">//通过新字符数组buf重构一个新String对象</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;  <span class="comment">//如果old = new ，直接返回自己</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//替换第一个旧字符</span></span><br><span class="line"><span class="function">String <span class="title">replaceFirst</span><span class="params">(String regex, String replacement)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Pattern.compile(regex).matcher(<span class="keyword">this</span>).replaceFirst(replacement);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当不是正规表达式时，与replace效果一样，都是全体换。如果字符串的正则表达式，则规矩表达式全体替换</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">replaceAll</span><span class="params">(String regex, String replacement)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Pattern.compile(regex).matcher(<span class="keyword">this</span>).replaceAll(replacement);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//可以用旧字符串去替换新字符串</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">replace</span><span class="params">(CharSequence target, CharSequence replacement)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Pattern.compile(target.toString(), Pattern.LITERAL).matcher(</span><br><span class="line">        <span class="keyword">this</span>).replaceAll(Matcher.quoteReplacement(replacement.toString()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<pre><code>从replace的算法中，我们可以发现，它不是从头开始遍历替换的，而是首先找到第一个要替换的字符，从要替换的字符开始遍历，发现一个替换一个。

四种用法，字符全替换字符，表达式全体换字符，表达式只替换第一个字符，字符串替换字符串</code></pre><ul>
<li><p>matches()和contains()函数</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* matches() 方法用于检测字符串是否匹配给定的正则表达式。</span></span><br><span class="line"><span class="comment">* regex -- 匹配字符串的正则表达式。</span></span><br><span class="line"><span class="comment">* 如：String Str = new String("www.snailmann.com");</span></span><br><span class="line"><span class="comment">* System.out.println(Str.matches("(.*)snailmann(.*)"));   output:true</span></span><br><span class="line"><span class="comment">* System.out.println(Str.matches("www(.*)"));             output:true</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(String regex)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> Pattern.matches(regex, <span class="keyword">this</span>);   <span class="comment">//实际使用的是Pattern.matches()方法</span></span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//是否含有CharSequence这个子类元素，通常用于StrngBuffer,StringBuilder</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(CharSequence s)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> indexOf(s.toString()) &gt; -<span class="number">1</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>split()函数</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String[] split(String regex, <span class="keyword">int</span> limit) &#123;</span><br><span class="line">       <span class="comment">/* fastpath if the regex is a</span></span><br><span class="line"><span class="comment">        (1)one-char String and this character is not one of the</span></span><br><span class="line"><span class="comment">           RegEx's meta characters ".$|()[&#123;^?*+\\", or</span></span><br><span class="line"><span class="comment">        (2)two-char String and the first char is the backslash and</span></span><br><span class="line"><span class="comment">           the second is not the ascii digit or ascii letter.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="keyword">char</span> ch = <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">if</span> (((regex.value.length == <span class="number">1</span> &amp;&amp;</span><br><span class="line">            <span class="string">".$|()[&#123;^?*+\\"</span>.indexOf(ch = regex.charAt(<span class="number">0</span>)) == -<span class="number">1</span>) ||</span><br><span class="line">            (regex.length() == <span class="number">2</span> &amp;&amp;</span><br><span class="line">             regex.charAt(<span class="number">0</span>) == <span class="string">'\\'</span> &amp;&amp;</span><br><span class="line">             (((ch = regex.charAt(<span class="number">1</span>))-<span class="string">'0'</span>)|(<span class="string">'9'</span>-ch)) &lt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">             ((ch-<span class="string">'a'</span>)|(<span class="string">'z'</span>-ch)) &lt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">             ((ch-<span class="string">'A'</span>)|(<span class="string">'Z'</span>-ch)) &lt; <span class="number">0</span>)) &amp;&amp;</span><br><span class="line">           (ch &lt; Character.MIN_HIGH_SURROGATE ||</span><br><span class="line">            ch &gt; Character.MAX_LOW_SURROGATE))</span><br><span class="line">       &#123;</span><br><span class="line">           <span class="keyword">int</span> off = <span class="number">0</span>;</span><br><span class="line">           <span class="keyword">int</span> next = <span class="number">0</span>;</span><br><span class="line">           <span class="keyword">boolean</span> limited = limit &gt; <span class="number">0</span>;</span><br><span class="line">           ArrayList&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">           <span class="keyword">while</span> ((next = indexOf(ch, off)) != -<span class="number">1</span>) &#123;</span><br><span class="line">               <span class="keyword">if</span> (!limited || list.size() &lt; limit - <span class="number">1</span>) &#123;</span><br><span class="line">                   list.add(substring(off, next));</span><br><span class="line">                   off = next + <span class="number">1</span>;</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;    <span class="comment">// last one</span></span><br><span class="line">                   <span class="comment">//assert (list.size() == limit - 1);</span></span><br><span class="line">                   list.add(substring(off, value.length));</span><br><span class="line">                   off = value.length;</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">// If no match was found, return this</span></span><br><span class="line">           <span class="keyword">if</span> (off == <span class="number">0</span>)</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">new</span> String[]&#123;<span class="keyword">this</span>&#125;;</span><br><span class="line">    </span><br><span class="line">           <span class="comment">// Add remaining segment</span></span><br><span class="line">           <span class="keyword">if</span> (!limited || list.size() &lt; limit)</span><br><span class="line">               list.add(substring(off, value.length));</span><br><span class="line">    </span><br><span class="line">           <span class="comment">// Construct result</span></span><br><span class="line">           <span class="keyword">int</span> resultSize = list.size();</span><br><span class="line">           <span class="keyword">if</span> (limit == <span class="number">0</span>) &#123;</span><br><span class="line">               <span class="keyword">while</span> (resultSize &gt; <span class="number">0</span> &amp;&amp; list.get(resultSize - <span class="number">1</span>).length() == <span class="number">0</span>) &#123;</span><br><span class="line">                   resultSize--;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           String[] result = <span class="keyword">new</span> String[resultSize];</span><br><span class="line">           <span class="keyword">return</span> list.subList(<span class="number">0</span>, resultSize).toArray(result);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> Pattern.compile(regex).split(<span class="keyword">this</span>, limit);</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">   <span class="keyword">public</span> String[] split(String regex) &#123;</span><br><span class="line">       <span class="keyword">return</span> split(regex, <span class="number">0</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>join()函数</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* join方法是JDK1.8加入的新函数，静态方法</span></span><br><span class="line"><span class="comment">* 这个方法就是跟split有些对立的函数,不过join是静态方法</span></span><br><span class="line"><span class="comment">* delimiter就是分割符，后面就是要追加的可变参数，比如str1,str2,str3</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* 例子：String.join(",",new String("a"),new String("b"),new String("c"))</span></span><br><span class="line"><span class="comment">* output: "a,b,c"</span></span><br><span class="line"><span class="comment">*/</span>	</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">join</span><span class="params">(CharSequence delimiter, CharSequence... elements)</span> </span>&#123;</span><br><span class="line">      Objects.requireNonNull(delimiter);  <span class="comment">//就是检测是否为Null,是null,抛异常</span></span><br><span class="line">      Objects.requireNonNull(elements);   <span class="comment">//不是就返回自己，即nothing happen</span></span><br><span class="line">      <span class="comment">// Number of elements not likely worth Arrays.stream overhead.</span></span><br><span class="line">      StringJoiner joiner = <span class="keyword">new</span> StringJoiner(delimiter);  <span class="comment">//嗯，有兴趣自己看StringJoiner类源码啦</span></span><br><span class="line">      <span class="keyword">for</span> (CharSequence cs: elements) &#123;</span><br><span class="line">          joiner.add(cs);   <span class="comment">//既用分割符delimiter将所有可变参数的字符串分割，合并成一个字符串</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> joiner.toString();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 功能是一样的，不过传入的参数不同</span></span><br><span class="line"><span class="comment"> * 这里第二个参数一般就是装着CharSequence子类的集合</span></span><br><span class="line"><span class="comment"> * 比如String.join(",",lists)   </span></span><br><span class="line"><span class="comment"> * list可以是一个Collection接口实现类，所含元素的基类必须是CharSequence类型</span></span><br><span class="line"><span class="comment"> * 比如String,StringBuilder,StringBuffer等</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">join</span><span class="params">(CharSequence delimiter,</span></span></span><br><span class="line"><span class="function"><span class="params">          Iterable&lt;? extends CharSequence&gt; elements)</span> </span>&#123;</span><br><span class="line">      Objects.requireNonNull(delimiter);</span><br><span class="line">      Objects.requireNonNull(elements);</span><br><span class="line">      StringJoiner joiner = <span class="keyword">new</span> StringJoiner(delimiter);</span><br><span class="line">      <span class="keyword">for</span> (CharSequence cs: elements) &#123;</span><br><span class="line">          joiner.add(cs);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> joiner.toString();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Java 1.8加入的新功能，有点跟split对立的意思，是个静态方法</li>
<li>有两个重载方法，一个是直接传字符串数组，另个是传集合。传集合的方式是一个好功能，很方遍将集合的字符串元素拼接成一个字符串。(分割符为 <code>&quot;&quot;</code> ,well, It’s great!!)</li>
</ul>
</li>
<li><p>trim()函数</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 去除字符串首尾部分的空值，如,' ' or " ",非""</span></span><br><span class="line"><span class="comment">* 原理是通过substring去实现的，首尾各一个指针</span></span><br><span class="line"><span class="comment">* 头指针发现空值就++，尾指针发现空值就--</span></span><br><span class="line"><span class="comment">* ' '的Int值为32，其实不仅仅是去空的作用，应该是整数值小于等于32的去除掉</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">trim</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">int</span> len = value.length; <span class="comment">//代表尾指针，实际是尾指针+1的大小</span></span><br><span class="line">	<span class="keyword">int</span> st = <span class="number">0</span>;             <span class="comment">//代表头指针</span></span><br><span class="line">       <span class="keyword">char</span>[] val = value;    <span class="comment">/* avoid getfield opcode */</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//st&lt;len,且字符的整数值小于32则代表有空值，st++</span></span><br><span class="line">       <span class="keyword">while</span> ((st &lt; len) &amp;&amp; (val[st] &lt;= <span class="string">' '</span>)) &#123;   </span><br><span class="line">           st++;</span><br><span class="line">       &#125;</span><br><span class="line">    <span class="comment">//len - 1才是真正的尾指针，如果尾部元素的整数值&lt;=32,则代表有空值，len--</span></span><br><span class="line">       <span class="keyword">while</span> ((st &lt; len) &amp;&amp; (val[len - <span class="number">1</span>] &lt;= <span class="string">' '</span>)) &#123;</span><br><span class="line">           len--;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//截取st到len的字符串(不包括len位置)</span></span><br><span class="line">       <span class="keyword">return</span> ((st &gt; <span class="number">0</span>) || (len &lt; value.length)) ? substring(st, len) : <span class="keyword">this</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>  常见去首尾的空值，实际是去除首尾凡是小于32的字符</p>
</li>
<li><p>toString()函数</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>toCharArray()函数</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 就是将String转换为字符数组并返回</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">char</span>[] toCharArray() &#123;</span><br><span class="line">    <span class="comment">// Cannot use Arrays.copyOf because of class initialization order issues</span></span><br><span class="line">    <span class="keyword">char</span> result[] = <span class="keyword">new</span> <span class="keyword">char</span>[value.length];    <span class="comment">//定义一个要返回的空数组，长度为字符串长度</span></span><br><span class="line">    System.arraycopy(value, <span class="number">0</span>, result, <span class="number">0</span>, value.length); <span class="comment">//拷贝</span></span><br><span class="line">    <span class="keyword">return</span> result; <span class="comment">//返回</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>toLowerCase()、toUpperCase()函数</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toLowerCase</span><span class="params">(Locale locale)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (locale == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> firstUpper;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> len = value.length;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Now check if there are any characters that need to be changed. */</span></span><br><span class="line">    scan: &#123;</span><br><span class="line">        <span class="keyword">for</span> (firstUpper = <span class="number">0</span> ; firstUpper &lt; len; ) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = value[firstUpper];</span><br><span class="line">            <span class="keyword">if</span> ((c &gt;= Character.MIN_HIGH_SURROGATE)</span><br><span class="line">                &amp;&amp; (c &lt;= Character.MAX_HIGH_SURROGATE)) &#123;</span><br><span class="line">                <span class="keyword">int</span> supplChar = codePointAt(firstUpper);</span><br><span class="line">                <span class="keyword">if</span> (supplChar != Character.toLowerCase(supplChar)) &#123;</span><br><span class="line">                    <span class="keyword">break</span> scan;</span><br><span class="line">                &#125;</span><br><span class="line">                firstUpper += Character.charCount(supplChar);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (c != Character.toLowerCase(c)) &#123;</span><br><span class="line">                    <span class="keyword">break</span> scan;</span><br><span class="line">                &#125;</span><br><span class="line">                firstUpper++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span>[] result = <span class="keyword">new</span> <span class="keyword">char</span>[len];</span><br><span class="line">    <span class="keyword">int</span> resultOffset = <span class="number">0</span>;  <span class="comment">/* result may grow, so i+resultOffset</span></span><br><span class="line"><span class="comment">                                * is the write location in result */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Just copy the first few lowerCase characters. */</span></span><br><span class="line">    System.arraycopy(value, <span class="number">0</span>, result, <span class="number">0</span>, firstUpper);</span><br><span class="line"></span><br><span class="line">    String lang = locale.getLanguage();</span><br><span class="line">    <span class="keyword">boolean</span> localeDependent =</span><br><span class="line">        (lang == <span class="string">"tr"</span> || lang == <span class="string">"az"</span> || lang == <span class="string">"lt"</span>);</span><br><span class="line">    <span class="keyword">char</span>[] lowerCharArray;</span><br><span class="line">    <span class="keyword">int</span> lowerChar;</span><br><span class="line">    <span class="keyword">int</span> srcChar;</span><br><span class="line">    <span class="keyword">int</span> srcCount;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = firstUpper; i &lt; len; i += srcCount) &#123;</span><br><span class="line">        srcChar = (<span class="keyword">int</span>)value[i];</span><br><span class="line">        <span class="keyword">if</span> ((<span class="keyword">char</span>)srcChar &gt;= Character.MIN_HIGH_SURROGATE</span><br><span class="line">            &amp;&amp; (<span class="keyword">char</span>)srcChar &lt;= Character.MAX_HIGH_SURROGATE) &#123;</span><br><span class="line">            srcChar = codePointAt(i);</span><br><span class="line">            srcCount = Character.charCount(srcChar);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            srcCount = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (localeDependent ||</span><br><span class="line">            srcChar == <span class="string">'\u03A3'</span> || <span class="comment">// GREEK CAPITAL LETTER SIGMA</span></span><br><span class="line">            srcChar == <span class="string">'\u0130'</span>) &#123; <span class="comment">// LATIN CAPITAL LETTER I WITH DOT ABOVE</span></span><br><span class="line">            lowerChar = ConditionalSpecialCasing.toLowerCaseEx(<span class="keyword">this</span>, i, locale);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            lowerChar = Character.toLowerCase(srcChar);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((lowerChar == Character.ERROR)</span><br><span class="line">            || (lowerChar &gt;= Character.MIN_SUPPLEMENTARY_CODE_POINT)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (lowerChar == Character.ERROR) &#123;</span><br><span class="line">                lowerCharArray =</span><br><span class="line">                    ConditionalSpecialCasing.toLowerCaseCharArray(<span class="keyword">this</span>, i, locale);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (srcCount == <span class="number">2</span>) &#123;</span><br><span class="line">                resultOffset += Character.toChars(lowerChar, result, i + resultOffset) - srcCount;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                lowerCharArray = Character.toChars(lowerChar);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* Grow result if needed */</span></span><br><span class="line">            <span class="keyword">int</span> mapLen = lowerCharArray.length;</span><br><span class="line">            <span class="keyword">if</span> (mapLen &gt; srcCount) &#123;</span><br><span class="line">                <span class="keyword">char</span>[] result2 = <span class="keyword">new</span> <span class="keyword">char</span>[result.length + mapLen - srcCount];</span><br><span class="line">                System.arraycopy(result, <span class="number">0</span>, result2, <span class="number">0</span>, i + resultOffset);</span><br><span class="line">                result = result2;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; mapLen; ++x) &#123;</span><br><span class="line">                result[i + resultOffset + x] = lowerCharArray[x];</span><br><span class="line">            &#125;</span><br><span class="line">            resultOffset += (mapLen - srcCount);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result[i + resultOffset] = (<span class="keyword">char</span>)lowerChar;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(result, <span class="number">0</span>, len + resultOffset);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toLowerCase</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> toLowerCase(Locale.getDefault());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toUpperCase</span><span class="params">(Locale locale)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (locale == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> firstLower;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> len = value.length;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Now check if there are any characters that need to be changed. */</span></span><br><span class="line">    scan: &#123;</span><br><span class="line">        <span class="keyword">for</span> (firstLower = <span class="number">0</span> ; firstLower &lt; len; ) &#123;</span><br><span class="line">            <span class="keyword">int</span> c = (<span class="keyword">int</span>)value[firstLower];</span><br><span class="line">            <span class="keyword">int</span> srcCount;</span><br><span class="line">            <span class="keyword">if</span> ((c &gt;= Character.MIN_HIGH_SURROGATE)</span><br><span class="line">                &amp;&amp; (c &lt;= Character.MAX_HIGH_SURROGATE)) &#123;</span><br><span class="line">                c = codePointAt(firstLower);</span><br><span class="line">                srcCount = Character.charCount(c);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                srcCount = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> upperCaseChar = Character.toUpperCaseEx(c);</span><br><span class="line">            <span class="keyword">if</span> ((upperCaseChar == Character.ERROR)</span><br><span class="line">                || (c != upperCaseChar)) &#123;</span><br><span class="line">                <span class="keyword">break</span> scan;</span><br><span class="line">            &#125;</span><br><span class="line">            firstLower += srcCount;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* result may grow, so i+resultOffset is the write location in result */</span></span><br><span class="line">    <span class="keyword">int</span> resultOffset = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span>[] result = <span class="keyword">new</span> <span class="keyword">char</span>[len]; <span class="comment">/* may grow */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Just copy the first few upperCase characters. */</span></span><br><span class="line">    System.arraycopy(value, <span class="number">0</span>, result, <span class="number">0</span>, firstLower);</span><br><span class="line"></span><br><span class="line">    String lang = locale.getLanguage();</span><br><span class="line">    <span class="keyword">boolean</span> localeDependent =</span><br><span class="line">        (lang == <span class="string">"tr"</span> || lang == <span class="string">"az"</span> || lang == <span class="string">"lt"</span>);</span><br><span class="line">    <span class="keyword">char</span>[] upperCharArray;</span><br><span class="line">    <span class="keyword">int</span> upperChar;</span><br><span class="line">    <span class="keyword">int</span> srcChar;</span><br><span class="line">    <span class="keyword">int</span> srcCount;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = firstLower; i &lt; len; i += srcCount) &#123;</span><br><span class="line">        srcChar = (<span class="keyword">int</span>)value[i];</span><br><span class="line">        <span class="keyword">if</span> ((<span class="keyword">char</span>)srcChar &gt;= Character.MIN_HIGH_SURROGATE &amp;&amp;</span><br><span class="line">            (<span class="keyword">char</span>)srcChar &lt;= Character.MAX_HIGH_SURROGATE) &#123;</span><br><span class="line">            srcChar = codePointAt(i);</span><br><span class="line">            srcCount = Character.charCount(srcChar);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            srcCount = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (localeDependent) &#123;</span><br><span class="line">            upperChar = ConditionalSpecialCasing.toUpperCaseEx(<span class="keyword">this</span>, i, locale);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            upperChar = Character.toUpperCaseEx(srcChar);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((upperChar == Character.ERROR)</span><br><span class="line">            || (upperChar &gt;= Character.MIN_SUPPLEMENTARY_CODE_POINT)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (upperChar == Character.ERROR) &#123;</span><br><span class="line">                <span class="keyword">if</span> (localeDependent) &#123;</span><br><span class="line">                    upperCharArray =</span><br><span class="line">                        ConditionalSpecialCasing.toUpperCaseCharArray(<span class="keyword">this</span>, i, locale);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    upperCharArray = Character.toUpperCaseCharArray(srcChar);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (srcCount == <span class="number">2</span>) &#123;</span><br><span class="line">                resultOffset += Character.toChars(upperChar, result, i + resultOffset) - srcCount;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                upperCharArray = Character.toChars(upperChar);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* Grow result if needed */</span></span><br><span class="line">            <span class="keyword">int</span> mapLen = upperCharArray.length;</span><br><span class="line">            <span class="keyword">if</span> (mapLen &gt; srcCount) &#123;</span><br><span class="line">                <span class="keyword">char</span>[] result2 = <span class="keyword">new</span> <span class="keyword">char</span>[result.length + mapLen - srcCount];</span><br><span class="line">                System.arraycopy(result, <span class="number">0</span>, result2, <span class="number">0</span>, i + resultOffset);</span><br><span class="line">                result = result2;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; mapLen; ++x) &#123;</span><br><span class="line">                result[i + resultOffset + x] = upperCharArray[x];</span><br><span class="line">            &#125;</span><br><span class="line">            resultOffset += (mapLen - srcCount);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result[i + resultOffset] = (<span class="keyword">char</span>)upperChar;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(result, <span class="number">0</span>, len + resultOffset);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toUpperCase</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> toUpperCase(Locale.getDefault());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>format()函数</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//JAVA字符串格式化</span></span><br><span class="line"><span class="comment">//新字符串使用本地语言环境，制定字符串格式和参数生成格式化的新字符串。</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">format</span><span class="params">(String format, Object... args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Formatter().format(format, args).toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用指定的语言环境，制定字符串格式和参数生成格式化的字符串。</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">format</span><span class="params">(Locale l, String format, Object... args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Formatter(l).format(format, args).toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>valueOf类函数</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//将Object转换为String</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">valueOf</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (obj == <span class="keyword">null</span>) ? <span class="string">"null"</span> : obj.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将char数组转换为String</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">valueOf</span><span class="params">(<span class="keyword">char</span> data[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将字符数组的子数组转换为String</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">valueOf</span><span class="params">(<span class="keyword">char</span> data[], <span class="keyword">int</span> offset, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(data, offset, count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">copyValueOf</span><span class="params">(<span class="keyword">char</span> data[], <span class="keyword">int</span> offset, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(data, offset, count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">copyValueOf</span><span class="params">(<span class="keyword">char</span> data[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将布尔值转换为String</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">valueOf</span><span class="params">(<span class="keyword">boolean</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> b ? <span class="string">"true"</span> : <span class="string">"false"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将单个字符转换为String</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">valueOf</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> data[] = &#123;c&#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(data, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将int转换为String</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">valueOf</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Integer.toString(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将long转换为String</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">valueOf</span><span class="params">(<span class="keyword">long</span> l)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Long.toString(l);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将float转换为String</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">valueOf</span><span class="params">(<span class="keyword">float</span> f)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Float.toString(f);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将double转换为String</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">valueOf</span><span class="params">(<span class="keyword">double</span> d)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Double.toString(d);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<pre><code>**从上看：**</code></pre><ul>
<li><p>copyValueOf和valueOf在Java8看来已经是完全没有区别的函数</p>
<ul>
<li>所有的value的本质都是新new一个String对象</li>
</ul>
</li>
<li><p>intern()函数</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">intern</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<pre><code>**String类中唯一的一条本地方法，既不是用Java语言实现的方法。**

比如str.intern(),作用就是去字符串常量池中寻找str字符串，如果有则返回str在常量池中的引用，如果没有则在常量池中创建str对象</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://fangchenyong.top/2019/09/06/Java-源码-JDK8-String/" data-id="ckmh9z48u0091roumkin5evph" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/String/">String</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/源码/">源码</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-框架-Mybatis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/05/框架-Mybatis/" class="article-date">
  <time datetime="2019-09-04T16:00:00.000Z" itemprop="datePublished">2019-09-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Mybatis/">Mybatis</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/05/框架-Mybatis/">Mybatis</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="什么是-MyBatis？"><a href="#什么是-MyBatis？" class="headerlink" title="什么是 MyBatis？"></a>什么是 <strong>MyBatis</strong>？</h1><p>​        MyBatis 是支持普通 SQL 查询，存储过程和高级映射的优秀持久层框架。MyBatis 消除了几乎所有的 JDBC 代码和参数的手工设置以及对结果集的检索。MyBatis 可以使用简单的XML 或注解用于配置和原始映射，将接口和 Java 的 POJO（Plain Old Java Objects，普通的Java 对象）映射成数据库中的记录。</p>
<h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><p>​        每一个 MyBatis 的应 用程序 都以一 个 SqlSessionFactory 对象的 实例为 核心。SqlSessionFactory 对 象 的 实 例 可 以 通 过 SqlSessionFactoryBuilder 对 象 来 获 得 。SqlSessionFactoryBuilder 对象可以通过 XML 配置文件，或从以往使用惯例中准备好的Configuration 类实例中来构建 SqlSessionFactory 对象。</p>
<h2 id="从-XML-中构建-SqlSessionFactory"><a href="#从-XML-中构建-SqlSessionFactory" class="headerlink" title="从 XML 中构建 SqlSessionFactory"></a>从 <strong>XML</strong> 中构建 <strong>SqlSessionFactory</strong></h2><pre><code>从 XML 文件中构建 SqlSessionFactory 的实例非常简单。这里建议你使用类路径下的资源文件来配置，但是你可以使用任意的 Reader 实例，这个实例包括由文字形式的文件路径或 URL 形式的文件路径 file://来创建。MyBatis 包含了一些工具类，称作为资源，这些工具类包含一些方法，这些方法使得从类路径或其它位置加载资源文件更加简单。</code></pre><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String resource = <span class="string">"org/mybatis/example/Configuration.xml"</span>;</span><br><span class="line">Reader reader = Resources.getResourceAsReader(resource); </span><br><span class="line">sqlMapper = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(reader);</span><br></pre></td></tr></table></figure>

<p>XML 配置文件包含对 MyBatis 系统的核心设置，包含获取数据库连接实例的数据源和决定事务范围和控制的事务管理器。关于 XML 配置文件的详细内容可以在文档后面找到， 这里给出一个简单的示例：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;driver&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;username&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"org/mybatis/example/BlogMapper.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        当然，在XML 配置文件中还有很多可以配置的，上面的示例指出的则是最关键的部分。要注意 XML 头部的声明，需要用来验证 XML 文档正确性。environment 元素体中包含对事务管理和连接池的环境配置。mappers 元素是包含所有 mapper映射器）的列表，这些 mapper的 XML 文件包含 SQL 代码和映射定义信息。</p>
<h2 id="不使用-XML-构建-SqlSessionFactory"><a href="#不使用-XML-构建-SqlSessionFactory" class="headerlink" title="不使用 XML 构建 SqlSessionFactory"></a>不使用 <strong>XML</strong> 构建 <strong>SqlSessionFactory</strong></h2><p>​        如果你喜欢从 Java 程序而不是 XML 文件中直接创建配置实例，或创建你自己的配置构建器，MyBatis 也提供完整的配置类，提供所有从 XML 文件中加载配置信息的选项。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DataSource dataSource = BlogDataSourceFactory.getBlogDataSource();</span><br><span class="line">TransactionFactory transactionFactory = <span class="keyword">new</span> JdbcTransactionFactory(); </span><br><span class="line">Environment environment = <span class="keyword">new</span> Environment(<span class="string">"development"</span>, transactionFactory, dataSource);</span><br><span class="line">Configuration configuration = <span class="keyword">new</span> Configuration(environment); configuration.addMapper(BlogMapper.class);</span><br><span class="line">SqlSessionFactory sqlSessionFactory =<span class="keyword">new</span> SqlSessionFactoryBuilder().build(configuration);</span><br></pre></td></tr></table></figure>

<p>​        注意这种情况下配置是添加映射器类。映射器类是 Java 类，这些类包含 SQL 映射语句的注解从而避免了 XML 文件的依赖，XML 映射仍然在大多数高级映射（比如：嵌套 Join 映射）时需要。出于这样的原因，如果存在 XML 配置文件的话，MyBatis 将会自动查找和加载一个对等的 XML 文件（这种情况下，基于类路径下的 BlogMapper.class 类的类名，那么 BlogMapper.xml 将会被加载）。后面我们会了解更多。</p>
<h2 id="从-SqlSessionFactory-中获取-SqlSession"><a href="#从-SqlSessionFactory-中获取-SqlSession" class="headerlink" title="从 SqlSessionFactory 中获取 SqlSession"></a>从 SqlSessionFactory 中获取 SqlSession</h2><p>​        现在，我们已经知道如何获取 SqlSessionFactory 对象了，基于同样的启示，我们就可以获得 SqlSession 的实例了。SqlSession 对象完全包含以数据库为背景的所有执行 SQL 操作的方法。你可以用 SqlSession 实例来直接执行已映射的 SQL 语句。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SqlSession session = sqlMapper.openSession();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	Blog blog = (Blog) session.selectOne( <span class="string">"org.mybatis.example.BlogMapper.selectBlog"</span>, <span class="number">101</span>);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">	session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        这种方法起到的作用，和我们使用之前的 MyBatis 版本是相似的，现在有一种更简洁的方法。使用合理描述参数和  SQL 语句返回值的接口（比如  BlogMapper.class），这样现在就可以执行更简单，更安全的代码，没有容易发生的字符串文字和转换的错误。</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SqlSession session = sqlSessionFactory.openSession(); </span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    BlogMapper mapper = session.getMapper(BlogMapper.class);</span><br><span class="line">    Blog blog = mapper.selectBlog(<span class="number">101</span>);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们来探究一下这里到底执行了什么。</p>
<h2 id="探究已映射的-SQL-语句"><a href="#探究已映射的-SQL-语句" class="headerlink" title="探究已映射的 SQL 语句"></a>探究已映射的 <strong>SQL</strong> 语句</h2><p>​        这里你也许想知道通过 SqlSession 和 Mapper 对象到底执行了什么操作。已映射的 SQL 语句是一个很大的主题，而且这个主题会贯穿本文档的大部分内容。为了给出一个宏观的概念，这里有一些示例。</p>
<p>​        上面提到的任何一个示例，语句是通过 XML 或注解定义的。我们先来看看 XML。使用基于 XML 的映射语言，在过去的几年中使得 MyBatis 非常流行，它为 MyBatis 提供所有的特性设置。如果你以前用过 MyBatis，这个概念就应该很熟悉了，但是 XML 映射文件也有很多的改进，后面我们会详细来说。这里给出一个基于 XML 映射语句的示例，这些语句应该可以满足上述示例中 SqlSession 对象的调用。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" &lt;http://mybatis.org/dtd/mybatis-3-mapper.dtd&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"org.mybatis.example.BlogMapper"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectBlog"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"Blog"</span>&gt;</span> </span><br><span class="line">		select * from Blog where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        这个简单的例子中看起来有很多额外的东西，但是也相当简洁了。如果你喜欢，你可以在一个单独的 XML 映射文件中定义很多的映射语句，除 XML 头部和文档类型声明之外， 你可以得 到很 多方便 之处。 在文件 的剩 余部分 是很好 的自我 解释 。在命 名空间“com.mybatis.example.BlogMapper”中，它定义了一个名为“selectBlog”的映射语句，这样它允许你使用完全限定名“org.mybatis.example.BlogMapper.selectBlog”来调用映射语句，我们下面示例中所有的写法也是这样的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Blog blog = (Blog) session.selectOne( <span class="string">"org.mybatis.example.BlogMapper.selectBlog"</span>, <span class="number">101</span>);</span><br></pre></td></tr></table></figure>

<p>​        要注意这个使用完全限定名调用 Java 对象的方法是相似的，这样做是有原因的。这个命名可以直接映射相同命名空间下的映射器类，使用一个名称，参数和返回值和已映射的查询语句都一样的方法即可。这就允许你非常容易地调用映射器接口中的方法，这和你前面看到的是一样的，下面这个示例中它又出现了。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">BlogMapper mapper = session.getMapper(BlogMapper.class); </span><br><span class="line">Blog blog = mapper.selectBlog(101);</span><br></pre></td></tr></table></figure>

<p>​        第二种方式有很多的优点，首先它不是基于文字的，那就更安全了。第二，如果你的IDE 有代码补全功能，那么你可以利用它来操纵已映射的 SQL 语句。第三，不需要强制类型转换，同时 BlogMapper 接口可以保持简洁，返回值类型很安全（参数类型也很安全）。</p>
<h2 id="命名空间的一点注释"><a href="#命名空间的一点注释" class="headerlink" title="命名空间的一点注释"></a>命名空间的一点注释</h2><blockquote>
<p>​        命名空间在之前版本的 MyBatis 中是可选项，非常混乱在使用上也没有帮助。现在， 命名空间是必须的，而且有一个目的，它使用更长的完全限定名来隔离语句。 命名空间使得接口绑定成为可能，就像你看到的那样，如果之前不了解，那么现在你 就会使用它们了，你应该按照下面给出示例的来练习，以免改变自己的想法。使用命名空间，并将它放在合适的 Java 包空间之下，这将会使你的代码变得简洁，在很长的时间内提高 MyBatis 的作用。 命名解析：为了减少输入量，MyBatis 对所有的命名配置元素使用如下的命名解析规则，包括语句，结果映射，缓存等。 </p>
<ul>
<li>直接查找完全限定名（比如“com.mypackage.MyMapper.selectAllThings”），如果发现就使用。 l</li>
<li>短名称（比如“selectAllThings”）可以用来引用任意含糊的对象。而如果有两个或两个以上的（比如“com.foo.selectAllThings ”和“com.bar.selectAllThings”）,那么就会得到错误报告，说短名称是含糊的，因此就必须使用完全限定名。</li>
</ul>
</blockquote>
<p>​        对 BlogMapper 这样的映射器类来说，还有一个妙招。它们中间映射的语句可以不需要在 XML 中来写，而可以使用 Java 注解来替换。比如，上面的 XML 示例可以如下来替换：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.mybatis.example; <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BlogMapper</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"SELECT * FROM blog WHERE id = #&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function">Blog <span class="title">selectBlog</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        对于简单语句来说，使用注解代码会更加清晰，然而 Java 注解对于复杂语句来说就会混乱，应该限制使用。因此，如果你不得不做复杂的事情，那么最好使用 XML 来映射语句。当然这也取决于你和你的项目团队的决定，看哪种更适合你来使用，还有以长久方式来使用映射语句的重要性。也就是说，不要将自己局限在一种方式中。你可以轻松地将注解换成 XML 映射语句，反之亦然。</p>
<h2 id="范围和生命周期"><a href="#范围和生命周期" class="headerlink" title="范围和生命周期"></a>范围和生命周期</h2><p>​        理解我们目前已经讨论过的不同范围和生命周期类是很重要的。不正确的使用它们会导致严重的并发问题。</p>
<h2 id="SqlSessionFactoryBuilder"><a href="#SqlSessionFactoryBuilder" class="headerlink" title="SqlSessionFactoryBuilder"></a><strong>SqlSessionFactoryBuilder</strong></h2><pre><code>这个类可以被实例化，使用和丢弃。一旦你创建了 SqlSessionFactory 后，这个类就不需要存在了。因此 SqlSessionFactoryBuilder 实例的最佳范围是方法范围（也就是本地方法变量）。你可以重用 SqlSessionFactoryBuilder 来创建多个 SqlSessionFactory 实例，但是最好的方式是 不需要保持它一直存在来保证所有 XML 解析资源，因为还有更重要的事情要做。</code></pre><p><strong>SqlSessionFactory</strong></p>
<pre><code>一旦被创建，SqlSessionFactory 实例应该在你的应用程序执行期间都存在。没有理由来处理或重新创建它。使用 SqlSessionFactory 的最佳实践是在应用程序运行期间不要重复创建多次。这样的操作将被视为是非常糟糕的。因此 SqlSessionFactory 的最佳范围是应用范围。有很多方法可以做到，最简单的就是使用单例模式或者静态单例模式。然而这两种方法都不认为是最佳实践。这样的话，你可以考虑依赖注入容器，比如 Google Guice 或 Spring。这样的框架允许你创建支持程序来管理单例 SqlSessionFactory 的生命周期。</code></pre><p><strong>SqlSession</strong></p>
<p>​        每个线程都应该有它自己的 SqlSession 实例。SqlSession 的实例不能共享使用，它也是线程不安全的。因此最佳的范围是请求或方法范围。绝对不能将 SqlSession 实例的引用放在一个类的静态字段甚至是实例字段中。也绝不能将 SqlSession 实例的引用放在任何类型的管理范围中，比如 Serlvet 架构中的 HttpSession。如果你现在正用任意的 Web  框架，要考虑SqlSession 放在一个和 HTTP 请求对象相似的范围内。换句话说，基于收到的 HTTP 请求， 你可以打开了一个 SqlSession，然后返回响应，就可以关闭它了。关闭 Session 很重要，你应该确保使用 finally 块来关闭它。下面的示例就是一个确保 SqlSession 关闭的基本模式：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SqlSession session = sqlSessionFactory.openSession(); <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// do work</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">	session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        在你的代码中一贯地使用这种模式，将会保证所有数据库资源都正确地关闭（假设你没有通过你自己的连接关闭，这会给 MyBatis 造成一种迹象表明你要自己管理连接资源）。</p>
<h3 id="映射器实例"><a href="#映射器实例" class="headerlink" title="映射器实例"></a>映射器实例</h3><p>映射器是你创建绑定映射语句的接口。映射器接口的实例可以从 SqlSession 中获得。那么从技术上来说，当被请求时，任意映射器实例的最宽范围和 SqlSession 是相同的。然而， 映射器实例的最佳范围是方法范围。也就是说，它们应该在使用它们的方法中被请求，然后就抛弃掉。它们不需要明确地关闭，那么在请求对象中保留它们也就不是什么问题了，这和</p>
<p>SqlSession 相似。你也许会发现，在这个水平上管理太多的资源的话会失控。保持简单，将</p>
<p>映射器放在方法范围内。下面的示例就展示了这个实例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SqlSession session = sqlSessionFactory.openSession(); </span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	BlogMapper mapper = session.getMapper(BlogMapper.class);</span><br><span class="line"><span class="comment">// do work</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">	session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="XML-映射配置文件"><a href="#XML-映射配置文件" class="headerlink" title="XML 映射配置文件"></a><strong>XML</strong> 映射配置文件</h2><p>MyBatis 的 XML 配置文件包含了影响 MyBatis 行为甚深的设置和属性信息。</p>
<p>XML 文档的高层级结构如下：</p>
<ul>
<li>configuration 配置</li>
<li>properties 属 性</li>
<li>settings 设 置</li>
<li>typeAliases 类型命名</li>
<li>ltypeHandlers 类型处理器</li>
<li>objectFactory 对象工厂</li>
<li>plugins 插 件 </li>
<li>environments 环 境<ul>
<li>environment 环境变量<ul>
<li>transactionManager事务管理器</li>
<li>dataSource 数据源</li>
</ul>
</li>
</ul>
</li>
<li>映射器</li>
</ul>
<h2 id="properties"><a href="#properties" class="headerlink" title="properties"></a>properties</h2><pre><code>这些是外部化的，可替代的属性，这些属性也可以配置在典型的 Java 属性配置文件中， 或者通过 properties 元素的子元素来传递。例如：</code></pre><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"org/mybatis/example/config.properties"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"dev_user"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"F2Fa3!33TYyg"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中的属性就可以在整个配置文件中使用，使用可替换的属性来实现动态配置。比如：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;driver&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;username&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        这个例子中的 username 和 password 将会由 properties 元素中设置的值来替换。driver 和url 属性将会从包含进来的 config.properties 文件中的值来替换。这里提供很多配置的选项。属性也可以被传递到 SqlSessionBuilder.build()方法中。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SqlSessionFactory factory = sqlSessionFactoryBuilder.build(reader, props);</span><br><span class="line"><span class="comment">// ... or ... </span></span><br><span class="line">SqlSessionFactory factory = sqlSessionFactoryBuilder.build(reader, </span><br><span class="line">                                                           environment, </span><br><span class="line">                                                           props);</span><br></pre></td></tr></table></figure>

<p>如果在这些地方，属性多于一个的话，MyBatis 按照如下的顺序加载它们：</p>
<ul>
<li><p>在 properties 元素体内指定的属性首先被读取。</p>
</li>
<li><p>从类路径下资源或 properties 元素的 url 属性中加载的属性第二被读取，它会覆盖已经存在的完全一样的属性。</p>
</li>
<li><p>作为方法参数传递的属性最后被读取，它也会覆盖任一已经存在的完全一样的属性，这些属性可能是从 properties 元素体内和资源/url 属性中加载的。</p>
</li>
</ul>
<p>因此，最高优先级的属性是那些作为方法参数的，然后是资源/url 属性，最后是 properties<br>元素中指定的属性。</p>
<h2 id="Settings"><a href="#Settings" class="headerlink" title="Settings"></a>Settings</h2><pre><code>这些是极其重要的调整，它们会修改 MyBatis 在运行时的行为方式。下面这个表格描述了设置信息，它们的含义和默认值。</code></pre><table>
<thead>
<tr>
<th>设置参数</th>
<th>描述</th>
<th>有效值</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>cacheEnabled</td>
<td>这个配置使全局的映射器启用或禁用   缓存。</td>
<td>true | false</td>
<td>true</td>
</tr>
<tr>
<td>lazyLoadingEnabled</td>
<td>全局启用或禁用延迟加载。当禁用时，   所有关联对象都会即时加载。</td>
<td>true | false</td>
<td>true</td>
</tr>
<tr>
<td>aggressiveLazyLoading</td>
<td>当启用时，有延迟加载属性的对象在被   调用时将会完全加载任意属性。否则，   每种属性将会按需要加载。</td>
<td>true | false</td>
<td>true</td>
</tr>
<tr>
<td>multipleResultSetsEnabled</td>
<td>允许或不允许多种结果集从一个单独   的语句中返回（需要适合的驱动）。</td>
<td>true | false</td>
<td>true</td>
</tr>
<tr>
<td>useColumnLabel</td>
<td>使用列标签代替列名。不同的驱动在这方便表现不同。参考驱动文档或充分测   试两种方法来决定所使用的驱动。</td>
<td>true | false</td>
<td>true</td>
</tr>
<tr>
<td>useGeneratedKeys</td>
<td>允许 JDBC 支持生成的键。需要适合的驱动。如果设置为 true 则这个设置强制生成的键被使用，尽管一些驱动拒绝兼   容但仍然有效（比如   Derby）。</td>
<td>true | false</td>
<td>false</td>
</tr>
<tr>
<td>autoMappingBehavior</td>
<td>指定 MyBatis 如何自动映射列到字段/   属性。PARTIAL 只会自动映射简单， 没有嵌套的结果。FULL   会自动映射任   意复杂的结果（嵌套的或其他情况）。</td>
<td>NONE, PARTIAL, FULL</td>
<td>PARTIAL</td>
</tr>
<tr>
<td>defaultExecutorType</td>
<td>配置默认的执行器。SIMPLE 执行器没   有什么特别之处。REUSE 执行器重用预处理语句。BATCH 执行器重用语句   和批量更新</td>
<td>SIMPLE, REUSE, BAT CH</td>
<td>SIMPLE</td>
</tr>
<tr>
<td>defaultStatementTimeout</td>
<td>设置超时时间，它决定驱动等待一个数   据库响应的时间。</td>
<td>任 何 正 整    数</td>
<td>Not   Set   (null)</td>
</tr>
</tbody></table>
<p>一个设置信息元素的示例，完全的配置如下所示：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"cacheEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"multipleResultSetsEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"useColumnLabel"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"useGeneratedKeys"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"enhancementEnabled"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"defaultExecutorType"</span> <span class="attr">value</span>=<span class="string">"SIMPLE"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"defaultStatementTimeout"</span> <span class="attr">value</span>=<span class="string">"25000"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="typeAliases"><a href="#typeAliases" class="headerlink" title="typeAliases"></a>typeAliases</h2><p>​        类型别名是为 Java 类型命名一个短的名字。它只和 XML 配置有关，只用来减少类完全限定名的多余部分。例如：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Author"</span> <span class="attr">type</span>=<span class="string">"domain.blog.Author"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Blog"</span> <span class="attr">type</span>=<span class="string">"domain.blog.Blog"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Comment"</span> <span class="attr">type</span>=<span class="string">"domain.blog.Comment"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Post"</span> <span class="attr">type</span>=<span class="string">"domain.blog.Post"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Section"</span> <span class="attr">type</span>=<span class="string">"domain.blog.Section"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Tag"</span> <span class="attr">type</span>=<span class="string">"domain.blog.Tag"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        使用这个配置，“Blog”可以任意用来替代“domain.blog. Blog”所使用的地方。</p>
<p>​        对于普通的 类型有许多内建的类型别名。它们都是大小写不敏感的，由于重载的名字，要注意原生类型的特殊处理。</p>
<table>
<thead>
<tr>
<th>别名</th>
<th>映射的类型</th>
</tr>
</thead>
<tbody><tr>
<td>_byte</td>
<td>byte</td>
</tr>
<tr>
<td>_long</td>
<td>long</td>
</tr>
<tr>
<td>_short</td>
<td>short</td>
</tr>
<tr>
<td>_int</td>
<td>int</td>
</tr>
<tr>
<td>_integer</td>
<td>int</td>
</tr>
<tr>
<td>_double</td>
<td>double</td>
</tr>
<tr>
<td>_float</td>
<td>float</td>
</tr>
<tr>
<td>_boolean</td>
<td>boolean</td>
</tr>
<tr>
<td>string</td>
<td>String</td>
</tr>
<tr>
<td>byte</td>
<td>Byte</td>
</tr>
<tr>
<td>long</td>
<td>Long</td>
</tr>
<tr>
<td>short</td>
<td>Short</td>
</tr>
<tr>
<td>int</td>
<td>Integer</td>
</tr>
<tr>
<td>integer</td>
<td>Integer</td>
</tr>
<tr>
<td>double</td>
<td>Double</td>
</tr>
<tr>
<td>float</td>
<td>Float</td>
</tr>
<tr>
<td>boolean</td>
<td>Boolean</td>
</tr>
<tr>
<td>date</td>
<td>Date</td>
</tr>
<tr>
<td>decimal</td>
<td>BigDecimal</td>
</tr>
<tr>
<td>bigdecimal</td>
<td>BigDecimal</td>
</tr>
<tr>
<td>map</td>
<td>Map</td>
</tr>
<tr>
<td>hashmap</td>
<td>HashMap</td>
</tr>
<tr>
<td>list</td>
<td>List</td>
</tr>
<tr>
<td>arraylist</td>
<td>ArrayList</td>
</tr>
<tr>
<td>collection</td>
<td>Collection</td>
</tr>
<tr>
<td>iterator</td>
<td>Iterator</td>
</tr>
</tbody></table>
<h2 id="typeHandlers"><a href="#typeHandlers" class="headerlink" title="typeHandlers"></a>typeHandlers</h2><pre><code>无论是 MyBatis 在预处理语句中设置一个参数，还是从结果集中取出一个值时，类型处理器被用来将获取的值以合适的方式转换成 Java 类型。下面这个表格描述了默认的类型处理器。</code></pre><table>
<thead>
<tr>
<th>类型处理器</th>
<th><strong>Java</strong> 类型</th>
<th><strong>JDBC</strong> 类型</th>
</tr>
</thead>
<tbody><tr>
<td>BooleanTypeHandler</td>
<td>Boolean，boolean</td>
<td>任何兼容的布尔值</td>
</tr>
<tr>
<td>ByteTypeHandler</td>
<td>Byte，byte</td>
<td>任何兼容的数字或字节类型</td>
</tr>
<tr>
<td>ShortTypeHandler</td>
<td>Short，short</td>
<td>任何兼容的数字或短整型</td>
</tr>
<tr>
<td>IntegerTypeHandler</td>
<td>Integer，int</td>
<td>任何兼容的数字和整型</td>
</tr>
<tr>
<td>LongTypeHandler</td>
<td>Long，long</td>
<td>任何兼容的数字或长整型</td>
</tr>
<tr>
<td>FloatTypeHandler</td>
<td>Float，float</td>
<td>任何兼容的数字或单精度浮点型</td>
</tr>
<tr>
<td>DoubleTypeHandler</td>
<td>Double，double</td>
<td>任何兼容的数字或双精度浮点型</td>
</tr>
<tr>
<td>BigDecimalTypeHandler</td>
<td>BigDecimal</td>
<td>任何兼容的数字或十进制小数类型</td>
</tr>
<tr>
<td>StringTypeHandler</td>
<td>String</td>
<td>CHAR   和 VARCHAR 类 型</td>
</tr>
<tr>
<td>ClobTypeHandler</td>
<td>String</td>
<td>CLOB   和 LONGVARCHAR 类 型</td>
</tr>
<tr>
<td>NStringTypeHandler</td>
<td>String</td>
<td>NVARCHAR   和 NCHAR 类 型</td>
</tr>
<tr>
<td>NClobTypeHandler</td>
<td>String</td>
<td>NCLOB   类型</td>
</tr>
<tr>
<td>ByteArrayTypeHandler</td>
<td>byte[]</td>
<td>任何兼容的字节流类型</td>
</tr>
<tr>
<td>BlobTypeHandler</td>
<td>byte[]</td>
<td>BLOB   和 LONGVARBINARY 类型</td>
</tr>
<tr>
<td>DateTypeHandler</td>
<td>Date（java.util）</td>
<td>TIMESTAMP   类型</td>
</tr>
<tr>
<td>DateOnlyTypeHandler</td>
<td>Date（java.util）</td>
<td>DATE   类型</td>
</tr>
<tr>
<td>TimeOnlyTypeHandler</td>
<td>Date（java.util）</td>
<td>TIME   类型</td>
</tr>
<tr>
<td>SqlTimestampTypeHandler</td>
<td>Timestamp（java.sql）</td>
<td>TIMESTAMP   类型</td>
</tr>
<tr>
<td>SqlDateTypeHandler</td>
<td>Date（java.sql）</td>
<td>DATE   类型</td>
</tr>
<tr>
<td>SqlTimeTypeHandler</td>
<td>Time（java.sql）</td>
<td>TIME   类型</td>
</tr>
<tr>
<td>ObjectTypeHandler</td>
<td>任意</td>
<td>其他或未指定类型</td>
</tr>
<tr>
<td>EnumTypeHandler</td>
<td>Enumeration   类型</td>
<td>VARCHAR-任何兼容的字符串类型，   作为代码存储（而不是索引）。</td>
</tr>
</tbody></table>
<p>​        你可以重写类型处理器或创建你自己的类型处理器来处理不支持的或非标准的类型。要这样做的话，简单实现 TypeHandler 接口（org.mybatis.type），然后映射新的类型处理器类到 Java 类型，还有可选的一个 JDBC 类型。例如：</p>
<p><strong>// Example Type Handler.java</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleTypeHandler</span> <span class="keyword">implements</span> <span class="title">TypeHandler</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParameter</span><span class="params">(PreparedStatement ps, </span></span></span><br><span class="line"><span class="function"><span class="params">                             <span class="keyword">int</span> i, </span></span></span><br><span class="line"><span class="function"><span class="params">                             Object parameter,</span></span></span><br><span class="line"><span class="function"><span class="params">                             JdbcType jdbcType)</span> </span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        ps.setString(i, (String) parame ter);</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getResult</span><span class="params">(ResultSet rs, String columnName)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rs.getString(col umnName );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getResult</span><span class="params">(CallableStatement cs, </span></span></span><br><span class="line"><span class="function"><span class="params">                            <span class="keyword">int</span> columnIndex)</span> </span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> cs.getString(col umnInde x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>// MapperConfig.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">javaType</span>=<span class="string">"String"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">handler</span>=<span class="string">"org.mybatis.example.ExampleTypeHandler"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        使用这样的类型处理器将会覆盖已经存在的处理 Java 的 String 类型属性和 VARCHAR 参数及结果的类型处理器。要注意 MyBatis 不会审视数据库元信息来决定使用哪种类型，所以你必须在参数和结果映射中指定那是 VARCHAR 类型的字段，来绑定到正确的类型处理器上。这是因为 MyBatis 直到语句被执行都不知道数据类型的这个现实导致的。</p>
<h2 id="objectFactory"><a href="#objectFactory" class="headerlink" title="objectFactory"></a>objectFactory</h2><pre><code>MyBatis 每次创建结果对象新的实例时，它使用一个 ObjectFactory 实例来完成。如果参数映射存在，默认的 ObjectFactory 不比使用默认构造方法或带参数的构造方法实例化目标类做的工作多。如果你想重写默认的 ObjectFactory，你可以创建你自己的。比如：</code></pre><p><strong>// Example Objec tFac tory.java</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleObjectFactory</span> <span class="keyword">extends</span> <span class="title">DefaultObjectFactory</span> </span>&#123; </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">create</span><span class="params">(Class type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.create(type);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">create</span><span class="params">(Class type,</span></span></span><br><span class="line"><span class="function"><span class="params">                         List&lt;Class&gt; constructorArgTypes, </span></span></span><br><span class="line"><span class="function"><span class="params">                         List&lt;Object&gt; constructorArgs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.create(type, constructorArgTypes, constructorArgs);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setProperties(properties);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>// MapperConfig.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">objectFactory</span> <span class="attr">type</span>=<span class="string">"org.mybatis.example.ExampleObjectFactory"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"someProperty"</span> <span class="attr">value</span>=<span class="string">"100"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">objectFactory</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        ObjectFactory 接口非常简单。它包含两个用于创建的方法，一个是默认构造方法，另外一个是处理带参数的构造方法。最终，setProperties 方法可以被用来配置 ObjectFactory。在初始化你的ObjectFactory 实例后，objectFactory 元素体中定义的属性会被传递给setProperties方法。</p>
<h2 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h2><pre><code>MyBatis 允许你在某一点拦截已映射语句执行的调用。默认情况下，MyBatis 允许使用插件来拦截方法调用：</code></pre><ul>
<li><p>Executor</p>
<blockquote>
<p>(update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</p>
</blockquote>
</li>
<li><p>ParameterHandler</p>
<blockquote>
<p>(getParameterObject, setParameters)</p>
</blockquote>
</li>
<li><p>ResultSetHandler</p>
<blockquote>
<p>(handleResultSets, handleOutputParameters)</p>
</blockquote>
</li>
<li><p>StatementHandler</p>
<blockquote>
<p>(prepare, parameterize, batch, update, query)</p>
</blockquote>
</li>
</ul>
<p>​        这些类中方法的详情可以通过查看每个方法的签名来发现，而且它们的源代码存在于MyBatis 的发行包中。你应该理解你所覆盖方法的行为，假设你所做的要比监视调用要多。如果你尝试修改或覆盖一个给定的方法，你可能会打破 MyBatis 的核心。这是低层次的类和方法，要谨慎使用插件。</p>
<p>​        使用插件是它们提供的非常简单的力量。简单实现拦截器接口，要确定你想拦截的指定签名。</p>
<p><strong>// ExamplePlugin.java</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Intercepts</span>(&#123;<span class="meta">@Signature</span>(type= Executor.class,method = <span class="string">"update"</span>, </span><br><span class="line">    args = &#123;MappedStatement.class,Object.class&#125;)&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExamplePlugin</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> invocation.proceed();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">plugin</span><span class="params">(Object target)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> Plugin.wrap(target, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>// MapperConfig.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">"org.mybatis.example.Example Plugin"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"someProperty"</span> <span class="attr">value</span>=<span class="string">"100"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        上面的插件将会拦截在 实例中所有的update方法调用它也是负责低层次映射语句执行的内部对象。</p>
<blockquote>
<p> 覆盖配置类</p>
<p>​        除了用插件来修改 MyBatis 核心行为之外，你也可以完全覆盖配置类。简单扩展它， 然后覆盖其中的任意方法，之后传递它到 sqlSessionFactoryBuilder.build(myConfig)方法 的调用。这可能会严重影响 MyBatis 的行为，所以要小心。</p>
</blockquote>
<h2 id="environments"><a href="#environments" class="headerlink" title="environments"></a>environments</h2><p>​        MyBatis 可以配置多种环境。这会帮助你将 SQL 映射应用于多种数据库之中。例如， 你也许为开发要设置不同的配置，测试和生产环境。或者你可能有多种生产级数据库却共享相同的模式，所以你会想对不同数据库使用相同的 SQL 映射。这种用例是很多的。</p>
<p>​        <strong>要记得一个很重要的问题：你可以配置多种环境，但你只能为每个 <em>SqlSessionFactory</em></strong></p>
<p><strong>实例选择一个。</strong></p>
<p>​        所以，如果你想连接两个数据库，你需要创建两个 SqlSessionFactory 实例，每个数据库对应一个。而如果是三个数据库，你就需要三个实例，以此类推。记忆起来很简单：</p>
<p>Ø  每个数据库对应一个 <strong>SqlSessionFactory</strong></p>
<p>为了明确创建哪种环境，你可以将它作为可选的参数传递给 SqlSessionFactoryBuilder。可以接受环境配置的两个方法签名是：</p>
<p>SqlSessionFactory factory = sqlSessionFactoryBuilder.build(reader, environment); SqlSessionFactory          factory  =                                       sqlSessionFactoryBuilder.build(reader,</p>
<p>environment,properties);</p>
<p>如果环境被忽略，那么默认环境将会被加载，如下进行：</p>
<p>SqlSessionFactory factory = sqlSessionFactoryBuilder.build(reader); SqlSessionFactory factory = sqlSessionFactoryBuilder.build(reader,properties);</p>
<p>环境元素定义了如何配置环境。</p>
<environments default="**development**">

<environment id="**development**">

<p>&lt;<strong>transactionManager</strong> type=”JDBC”&gt;</p>
<property name="..." value="...">



<p>&lt;<strong>dataSource</strong> type=”POOLED”&gt;</p>
<property name="driver" value="${driver}">

<property name="url" value="${url}">

<property name="username" value="${username}">

<property name="password" value="${password}">



</property></property></property></property></property></environment>

</environments>

<p>注意这里的关键部分：</p>
<p>l  默认的环境 ID（比如：default=”development”）。</p>
<p>l  每个 environment 元素定义的环境 ID（比如：id=”development”）。</p>
<p>l  事务管理器的配置（比如：type=”JDBC”）。</p>
<p>l  数据源的配置（比如：type=”POOLED”）。</p>
<p>默认的环境和环境 ID 是自我解释的。你可以使用你喜欢的名称来命名，只要确定默认的要匹配其中之一。</p>
<p><strong>transactionManager</strong></p>
<p>在 MyBatis 中有两种事务管理器类型（也就是 type=”[JDBC|MANAGED]”）：</p>
<p>l  <strong>JDBC</strong> – 这个配置直接简单使用了 JDBC 的提交和回滚设置。它依赖于从数据源得到的连接来管理事务范围。</p>
<p>l  <strong>MANAGED</strong> – 这个配置几乎没做什么。它从来不提交或回滚一个连接。而它会让容器来管理事务的整个生命周期（比如 Spring 或 JEE 应用服务器的上下文）。默认情况下它会关闭连接。然而一些容器并不希望这样，因此如果你需要从连接中停止它，将 closeConnection 属性设置为 false。例如：</p>
<transactionmanager type="MANAGED">

<property name="**closeConnection**" value="**false**">

</property></transactionmanager>

<p>这两种事务管理器都不需要任何属性。然而它们都是类型别名，要替换使用它们，你需要放置将你自己的类的完全限定名或类型别名，它们引用了你对 TransacFactory 接口的实现类。</p>
<p>public interface TransactionFactory { void setProperties(Properties props);</p>
<p>Transaction newTransaction(Connection conn, boolean autoCommit);</p>
<p>}</p>
<p>任何在 XML 中配置的属性在实例化之后将会被传递给 setProperties()方法。你的实现类需要创建一个事务接口的实现，这个接口也很简单：</p>
<p>public interface Transaction { Connection getConnection();</p>
<p>void commit() throws SQLException;</p>
<p>void rollback() throws SQLException; void close() throws SQLException;</p>
<p>}</p>
<p>使用这两个接口，你可以完全自定义 MyBatis 对事务的处理。</p>
<p><strong>dataSsource</strong></p>
<p>dataSource 元素使用基本的 JDBC 数据源接口来配置 JDBC 连接对象的资源。</p>
<p>Ø  许多 MyBatis 的应用程序将会按示例中的例子来配置数据源。然而它并不是必须的。要知道为了方便使用延迟加载，数据源才是必须的。</p>
<p>有三种内建的数据源类型（也就是 type=”???”）：</p>
<p><strong>UNPOOLED</strong> – 这个数据源的实现是每次被请求时简单打开和关闭连接。它有一点慢， 这是对简单应用程序的一个很好的选择，因为它不需要及时的可用连接。不同的数据库对这个的表现也是不一样的，所以对某些数据库来说配置数据源并不重要，这个配置也是闲置的。UNPOOLED 类型的数据源仅仅用来配置以下 5 种属性：</p>
<p>l  <strong>driver</strong> – 这是 JDBC 驱动的 Java 类的完全限定名（如果你的驱动包含的有，它也不是数据源类）。</p>
<p>l  <strong>url</strong> – 这是数据库的 JDBC URL 地址。</p>
<p>l  <strong>username</strong> –  登录数据库的用户名。</p>
<p>l  <strong>password</strong> – 登录数据库的密码。</p>
<p>l  <strong>defaultTransactionIsolationLevel</strong> – 默认的连接事务隔离级别。</p>
<p>作为可选项，你可以传递数据库驱动的属性。要这样做，属性的前缀是以“driver.”开 头的，例如：</p>
<p>l  driver.encoding=UTF8</p>
<p>这 样 就 会 传 递 以 值 “ UTF8 ” 来 传 递                      “ encoding ” 属 性 ， 它 是 通 过  </p>
<p>DriverManager.getConnection(url,driverProperties)方法传递给数据库驱动。</p>
<p><strong>POOLED</strong> – 这是 JDBC 连接对象的数据源连接池的实现，用来避免创建新的连接实例时必要的初始连接和认证时间。这是一种当前 Web 应用程序用来快速响应请求很流行的方法。</p>
<p>除了上述（UNPOOLED）的属性之外，还有很多属性可以用来配置 POOLED 数据源：</p>
<p>l  <strong>poolMaximumActiveConnections –</strong> 在任意时间存在的活动（也就是正在使用）连接的数量。默认值：10</p>
<p>l  <strong>poolMaximumIdleConnections –</strong>  任意时间存在的空闲连接数。</p>
<p>l  <strong>poolMaximumCheckoutTime –</strong> 在被强制返回之前，池中连接被检查的时间。默认值：20000 毫秒（也就是 20 秒）</p>
<p>l  <strong>poolTimeToWait</strong> <strong>–</strong> 这是给连接池一个打印日志状态机会的低层次设置，还有重新尝试获得连接，这些情况下往往需要很长时间（为了避免连接池没有配置时静默失败）。默认值：20000 毫秒（也就是 20 秒）</p>
<p>l  <strong>poolPingQuery –</strong> 发送到数据的侦测查询，用来验证连接是否正常工作，并且准备接受请求。默认是“NO  PING  QUERY SET”，这会引起许多数据库驱动连接由一个错误信息而导致失败。</p>
<p>l  <strong>poolPingEnabled</strong> – 这是开启或禁用侦测查询。如果开启，你必须用一个合法的</p>
<p>SQL 语句（最好是很快速的）设置 poolPingQuery 属性。默认值：false。</p>
<p>l  <strong>poolPingConnectionsNotUsedFor</strong> – 这是用来配置 poolPingQuery 多次时间被用一次。这可以被设置匹配标准的数据库连接超时时间，来避免不必要的侦测。默认值： 0（也就是所有连接每一时刻都被侦测-但仅仅当 poolPingEnabled 为 true 时适用）。 <strong>JNDI</strong> –  这个数据源的实现是为了使用如 Spring 或应用服务器这类的容器，容器可以集</p>
<p>中或在外部配置数据源，然后放置一个 JNDI 上下文的引用。这个数据源配置只需要两个属性：</p>
<p>l  <strong>initial_context –</strong> 这 个 属 性 用 来 从 初 始 上 下 文 中 寻 找 环 境 （ 也 就 是</p>
<p>initialContext.lookup（initial——context））。这是个可选属性，如果被忽略，那么</p>
<p>data_source 属性将会直接以 initialContext 为背景再次寻找。</p>
<p>l  <strong>data_source –</strong> 这是引用数据源实例位置的上下文的路径。它会以由 initial_context 查询返回的环境为背景来查找，如果 initial_context 没有返回结果时，直接以初始上下文为环境来查找。</p>
<p>和其他数据源配置相似，它也可以通过名为“env.”的前缀直接向初始上下文发送属性。比如：</p>
<p>l  env.encoding=UTF8</p>
<p>在初始化之后，这就会以值“UTF8”向初始上下文的构造方法传递名为“encoding”</p>
<p>的属性。</p>
<h2 id="mappers"><a href="#mappers" class="headerlink" title="mappers"></a>mappers</h2><p>既然 MyBatis 的行为已经由上述元素配置完了，我们现在就要定义 SQL 映射语句了。但是，首先我们需要告诉 MyBatis 到哪里去找到这些语句。Java 在这方面没有提供一个很好的方法，所以最佳的方式是告诉 MyBatis 到哪里去找映射文件。你可以使用相对于类路径的资源引用，或者字符表示，或 url 引用的完全限定名（包括 file:///URLs）。例如：</p>
<p>// 使用相对于类路径的资源</p>
<mappers>

<mapper resource="org/mybatis/builder/AuthorMapper.xml">

<mapper resource="org/mybatis/builder/BlogMapper.xml">

<mapper resource="org/mybatis/builder/PostMapper.xml">

</mapper></mapper></mapper></mappers>

<p>// 使用完全限定路径</p>
<mappers>

<mapper url="file:///var/sqlmaps/AuthorMapper.xml">

<mapper url="file:///var/sqlmaps/BlogMapper.xml">

<mapper url="file:///var/sqlmaps/PostMapper.xml">

</mapper></mapper></mapper></mappers>

<p>这些语句简单告诉了 MyBatis 去哪里找映射文件。其余的细节就是在每个 SQL 映射文件中了，下面的部分我们来讨论 SQL 映射文件。</p>
<p><strong>SQL</strong> 映射的 <strong>XML</strong> 文件</p>
<p>MyBatis 真正的力量是在映射语句中。这里是奇迹发生的地方。对于所有的力量，SQL 映射的 XML 文件是相当的简单。当然如果你将它们和对等功能的 JDBC 代码来比较，你会发现映射文件节省了大约 95%的代码量。MyBatis 的构建就是聚焦于 SQL 的，使其远离于普通的方式。</p>
<p>SQL 映射文件有很少的几个顶级元素（按照它们应该被定义的顺序）：</p>
<p>l  cache - 配置给定命名空间的缓存。</p>
<p>l  cache-ref – 从其他命名空间引用缓存配置。</p>
<p>l  resultMap – 最复杂，也是最有力量的元素，用来描述如何从数据库结果集中来加载你的对象。</p>
<p> l    parameterMap – 已经被废弃了！老式风格的参数映射。内联参数是首选，这个元</p>
<p>素可能在将来被移除。这里不会记录。</p>
<p>l  sql – 可以重用的 SQL 块，也可以被其他语句引用。</p>
<p>l  insert – 映射插入语句</p>
<p>l  update – 映射更新语句</p>
<p>l  delete –  映射删除语句</p>
<p>l  select – 映射查询语句</p>
<p>下一部分将从语句本身开始来描述每个元素的细节。</p>
<h2 id="select"><a href="#select" class="headerlink" title="select"></a>select</h2><p>查询语句是使用 MyBatis 时最常用的元素之一。直到你从数据库取出数据时才会发现将数据存在数据库中是多么的有价值，所以许多应用程序的查询操作要比更改数据操作多的多。对于每次插入，更新或删除，那也会有很多的查询。这是 MyBatis 的一个基本原则，也是将 重心和努力放到查询和结果映射的原因。对简单类别的查询元素是非常简单的。比如：</p>
<p><strong><select id="”selectPerson”" parameter type="”int”" resulttype="”hashmap”"></select></strong></p>
<p>SELECT * FROM PERSON WHERE ID = #{id}</p>
<p><strong></strong></p>
<p>这个语句被称作 selectPerson，使用一个 in（t  或 Integer）类型的参数，并返回一个 HashMap</p>
<p>类型的对象，其中的键是列名，值是列对应的值。</p>
<p>注意参数注释：</p>
<p>#{id}</p>
<p>这就告诉 MyBatis 创建一个 PreparedStatement（预处理语句）参数。使用 JDBC，这样的一个参数在 SQL 中会由一个“?”来标识，并被传递到一个新的预处理语句中，就像这样：</p>
<p>// 相似的JDBC代码，不是MyBatis 的</p>
<p>String selectPerson = “SELECT * FROM PERSON WHERE ID=?”; PreparedStatement ps = conn.prepareStatement(selectPerson); ps.setInt(1,id);</p>
<p>当然，这需要很多单独的 JDBC 的代码来提取结果并将它们映射到对象实例中，这就是</p>
<p>MyBatis 节省你时间的地方。我们需要深入了解参数和结果映射。那些细节部分我们下面来了解。</p>
<p>select 元素有很多属性允许你配置，来决定每条语句的作用细节。</p>
<p>&lt;select</p>
<p>id=”selectPerson” parameterType=”int” parameterMap=”deprecated” resultType=”hashmap” resultMap=”personResultMap” flushCache=”false” useCache=”true” timeout=”10000” fetchSize=”256” statementType=”PREPARED” resultSetType=”FORWARD_ONLY”</p>
<p>&gt; </p>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>在命名空间中唯一的标识符，可以被用来引用这条语句。</td>
</tr>
<tr>
<td>parameterType</td>
<td>将会传入这条语句的参数类的完全限定名或别名。</td>
</tr>
<tr>
<td>parameterMap</td>
<td>这是引用外部 parameterMap 的已经被废弃的方法。使用内联参数   映射和 parameterType 属性。</td>
</tr>
<tr>
<td>resultType</td>
<td>从这条语句中返回的期望类型的类的完全限定名或别名。注意集   合情形，那应该是集合可以包含的类型，而不能是集合本身。使</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th></th>
<th>用 resultType 或 resultMap，但不能同时使用。</th>
</tr>
</thead>
<tbody><tr>
<td>resultMap</td>
<td>命名引用外部的 resultMap。返回 map 是 MyBatis 最具力量的特性， 对其有一个很好的理解的话，许多复杂映射的情形就能被解决了。   使用 resultMap 或 resultType，但不能同时使用。</td>
</tr>
<tr>
<td>flushCache</td>
<td>将其设置为 true，无论语句什么时候被调用，都会导致缓存被清   空。默认值：false。</td>
</tr>
<tr>
<td>useCache</td>
<td>将其设置为 true，将会导致本条语句的结果被缓存。默认值：true。</td>
</tr>
<tr>
<td>timeout</td>
<td>这个设置驱动程序等待数据库返回请求结果，并抛出异常时间的   最大等待值。默认不设置（驱动自行处理）。</td>
</tr>
<tr>
<td>fetchSize</td>
<td>这是暗示驱动程序每次批量返回的结果行数。默认不设置（驱动   自行处理）。</td>
</tr>
<tr>
<td>statementType</td>
<td>STATEMENT,PREPARED 或 CALLABLE   的一种。这会让 MyBatis   使用选择使用 Statement，PreparedStatement 或 CallableStatement。   默认值：PREPARED。</td>
</tr>
<tr>
<td>resultSetType</td>
<td>FORWARD_ONLY|SCROLL_SENSITIVE|SCROLL_INSENSITIVE   中的一种。默认是不设置（驱动自行处理）。</td>
</tr>
</tbody></table>
<h2 id="insert，-update，-delete"><a href="#insert，-update，-delete" class="headerlink" title="insert， update， delete"></a>insert， update， delete</h2><p>数据修改语句 insert，update 和 delete 在它们的实现中非常相似：</p>
<p>&lt;insert</p>
<p>id=”insertAuthor” parameterType=”domain.blog.Author” flushCache=”true” statementType=”PREPARED” keyProperty=””</p>
<p>useGeneratedKeys=”” timeout=”20000”&gt;</p>
<p>&lt;update</p>
<p>id=”insertAuthor” parameterType=”domain.blog.Author” flushCache=”true” statementType=”PREPARED” timeout=”20000”&gt;</p>
<p>&lt;delete</p>
<p>id=”insertAuthor” parameterType=”domain.blog.Author” flushCache=”true” statementType=”PREPARED” timeout=”20000”&gt;</p>
<table>
<thead>
<tr>
<th>id</th>
<th>在命名空间中唯一的标识符，可以被用来引用这条语句。</th>
</tr>
</thead>
<tbody><tr>
<td>parameterType</td>
<td>将会传入这条语句的参数类的完全限定名或别名。</td>
</tr>
<tr>
<td>parameterMap</td>
<td>这是引用外部 parameterMap 的已经被废弃的方法。使用内联参数   映射和 parameterType 属性。</td>
</tr>
<tr>
<td>flushCache</td>
<td>将其设置为 true，不论语句什么时候被带哦用，都会导致缓存被清   空。默认值：false。</td>
</tr>
<tr>
<td>timeout</td>
<td>这个设置驱动程序等待数据库返回请求结果，并抛出异常时间的最   大等待值。默认不设置（驱动自行处理）。</td>
</tr>
<tr>
<td>statementType</td>
<td>STATEMENT,PREPARED 或 CALLABLE 的一种。这会让 MyBatis   使用选择使用 Statement，PreparedStatement 或 CallableStatement。   默认值：PREPARED。</td>
</tr>
<tr>
<td>useGeneratedKeys</td>
<td>（ 仅 对    insert   有 用  ） 这 会  告 诉      MyBatis   使 用    JDBC 的   getGeneratedKeys  方法来取出由数据（比如：像  MySQL 和  SQL   Server 这样的数据库管理系统的自动递增字段）内部生成的主键。   默认值：false。</td>
</tr>
<tr>
<td>keyProperty</td>
<td>（仅对insert 有用）标记一个属性，MyBatis 会通过getGeneratedKeys   或者通过 insert 语句的 selectKey 子元素设置它的值。默认：不设置。</td>
</tr>
</tbody></table>
<p>下面就是 insert，update 和 delete 语句的示例：</p>
<p><strong><insert i d="insertAuthor" parame tertype="domain.bl og.Author"></insert></strong></p>
<p>insert into Author (id,username,password,email,bio) values (#{id},#{username},#{password},#{email},#{bio})</p>
<p><strong></strong></p>
<p><strong><update i d="updateAuthor " par ameter type="domain.bl og.Author"></update></strong></p>
<p>update Author set username = #{username}, password = #{password}, email = #{email},</p>
<p>bio = #{bio} where id = #{id}</p>
<p><strong></strong></p>
<p><strong>&lt;delete i d=”deleteAuthor” par ameter Type =”int”&gt;</strong></p>
<p>delete from Author where id = #{id}</p>
<p><strong>&lt;/ delete&gt;</strong></p>
<p>如前所述，插入语句有一点多，它有一些属性和子元素用来处理主键的生成。</p>
<p>首先，如果你的数据库支持自动生成主键的字段（比如 MySQL 和 SQL Server 数据库）， 那么你可以设置 useGeneratedKeys=”true”，而且设置 keyProperty 到你已经做好的目标属性上。例如，如果上面的 Author 表已经对 id 使用了自动生成的列类型，那么语句可以修改为：</p>
<p><strong>&lt;insert i d=”insertAuthor” parame terType =”domain.bl og.Author” useGener ate dKe ys=”true” keyProperty=”i d”&gt;</strong></p>
<p>insert into Author (username,password,email,bio) values (#{username},#{password},#{email},#{bio})</p>
<p><strong></strong></p>
<p>MyBatis 有另外一种方法来处理数据库不支持自动生成类型，或者可能 JDBC 驱动不支持自动生成主键时的主键生成问题。</p>
<p>这里有一个简单（甚至很傻）的示例，它可以生成一个随机 ID（可能你不会这么做， 但是这展示了 MyBatis 处理问题的灵活性，因为它并不真的关心 ID 的生成）：</p>
<p><strong><insert i d="insertAuthor" parame tertype="domain.bl og.Auth or"></insert></strong></p>
<p><strong><selectke y keypr operty="i d" resulttype="int" or der="B EFORE"></selectke></strong></p>
<p>select CAST(RANDOM()*1000000 as INTEGER) a from SYSIBM.SYSDUMMY1</p>
<p><strong></strong></p>
<p>insert into Author</p>
<p>(id, username, password, email,bio, favourite_section) values</p>
<p>(#{id}, #{username}, #{password}, #{email}, #{bio}, #{favouriteSection,jdbcType=VARCHAR}</p>
<p>)</p>
<p><strong></strong></p>
<p>在上面的示例中，selectKey 元素将会首先运行，Author 的 id 会被设置，然后插入语句会被调用。这给你了一个简单的行为在你的数据库中来处理自动生成的主键，而不需要使你的 Java 代码变得复杂。</p>
<p>selectKey 元素描述如下：</p>
<p>&lt;selectKey</p>
<p>keyProperty=”id” resultType=”int” order=”BEFORE” statementType=”PREPARED”&gt;</p>
<h2 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h2><p>这个元素可以被用来定义可重用的 SQL 代码段，可以包含在其他语句中。比如：</p>
<p><sql id="”userColumns”"> id,username,password </sql></p>
<p>这个 SQL 片段可以被包含在其他语句中，例如：</p>
<p><select id="”selectUsers”" parametertype="”int”" resulttype="”hashmap”"> select <include refid="”userColumns”/"></include></select></p>
<p>from some_table where id = #{id}</p>





<h2 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters"></a>Parameters</h2><p>在之前的语句中，你已经看到了一些简单参数的示例。在 MyBatis 中参数是非常强大的元素。对于简单的做法，大概 90%的情况，是不用太多的，比如：</p>
<p><select id="”selectUsers”" parametertype="”int”" resulttype="”User”"> select id, username, password</select></p>
<p>from users</p>
<p>where id = #{id}</p>


<p>上面的这个示例说明了一个非常简单的命名参数映射。参数类型被设置为“int”，因此这个参数可以被设置成任何内容。原生的类型或简单数据类型，比如整型和没有相关属性的字符串，因此它会完全用参数来替代。然而，如果你传递了一个复杂的对象，那么 MyBatis 的处理方式就会有一点不同。比如：</p>
<p><insert id="”insertUser”" parametertype="”User”"> insert into users (id, username, password) values (#{id}, #{username}, #{password})</insert></p>


<p>如果 User 类型的参数对象传递到了语句中，id、username 和 password 属性将会被查找，然后它们的值就被传递到预处理语句的参数中。</p>
<p>这点对于传递参数到语句中非常好。但是对于参数映射也有一些其他的特性。首先，像 MyBatis 的其他部分，参数可以指定一个确定的数据类型。</p>
<p>#{property,javaType=int,jdbcType=NUMERIC}</p>
<p>像 MyBatis 的剩余部分，javaType 通常可以从参数对象中来确定，除非对象是一个</p>
<p>HashMap。那么 javaType 应该被确定来保证使用正确类型处理器。</p>
<p>注意：如果 null 被当作值来传递，对于所有可能为空的列，JDBC Type 是需要的。也可以通过阅读 PreparedStatement. setNull()方法的 JavaDocs 文档来研究它。</p>
<p>为了以后自定义类型处理器，你可以指定一个确定的类型处理器类（或别名），比如：</p>
<p>#{age,javaType=int,jdbcType=NUMERIC,typeHandler=MyTypeHandler}</p>
<p>尽管它看起来繁琐，但是实际上是你很少设置它们其中之一。</p>
<p>对于数值类型，对于决定有多少数字是相关的，有一个数值范围。</p>
<p>#{height,javaType=double,jdbcType=NUMERIC,numericScale=2}</p>
<p>最后，mode 属性允许你指定 IN，OUT 或 INOUT 参数。如果参数为 OUT 或 INOUT， 参数对象属性的真实值将会被改变，就像你期望你需要你个输出参数。如果 mode 为 OUT</p>
<p>（或 INOUT），而且 jdbcType 为  CURSOR（也就是 Oracle 的  REFCURSOR），你必须指定一个 resultMap 来映射结果集到参数类型。要注意这里的 javaType 属性是可选的，如果左边的空白是 jdbcType 的 CURSOR 类型，它会自动地被设置为结果集。</p>
<p>#{department,</p>
<p>mode=OUT, jdbcType=CURSOR, javaType=ResultSet,</p>
<p>resultMap=departmentResultMap}</p>
<p>MyBatis 也支持很多高级的数据类型，比如结构体，但是当注册 out 参数时你必须告诉语句类型名称。比如（再次提示，在实际中不要像这样换行）：</p>
<p>#{middleInitial,</p>
<p>mode=OUT, jdbcType=STRUCT, jdbcTypeName=MY_TYPE,</p>
<p>resultMap=departmentResultMap}</p>
<p>尽管所有这些强大的选项很多时候你只简单指定属性名，MyBatis 会自己计算剩余的。最多的情况是你为 jdbcType 指定可能为空的列名。</p>
<p>#{firstName} #{middleInitial,jdbcType=VARCHAR} #{lastName}</p>
<p>字符串替换</p>
<p>默认情况下，使用#{}格式的语法会导致 MyBatis 创建预处理语句属性并以它为背景设置安全的值（比如?）。这样做很安全，很迅速，也是首选的做法，有时你只是想直接在 SQL语句中插入一个不改变的字符串。比如，像 ORDER BY，你可以这样来使用：</p>
<p>ORDER BY ${columnName}</p>
<p>这里 MyBatis 不会修改或转义字符串。</p>
<p>重要：接受从用户输出的内容并提供给语句中不变的字符串，这样做是不安全的。这会导致潜在的 SQL 注入攻击，因此你不应该允许用户输入这些字段，或者通常自行转义并检查。</p>
<h2 id="resultMap"><a href="#resultMap" class="headerlink" title="resultMap"></a>resultMap</h2><p>resultMap 元素是 MyBatis 中最重要最强大的元素。它就是让你远离 90%的需要从结果集中取出数据的 JDBC 代码的那个东西，而且在一些情形下允许你做一些 JDBC 不支持的事情。事实上，编写相似于对复杂语句联合映射这些等同的代码，也许可以跨过上千行的代码。</p>
<p>ResultMap 的设计就是简单语句不需要明确的结果映射，而很多复杂语句确实需要描述它们的关系。</p>
<p>你已经看到简单映射语句的示例了，但没有明确的 resultMap。比如：</p>
<p><select id="”selectUsers”" parametertype="”int”" resulttype="”hashmap”"> select id, username, hashedPassword</select></p>
<p>from some_table where id = #{id}</p>


<p>这样一个语句简单作用于所有列被自动映射到 HashMap 的键上，这由 resultType 属性指定。这在很多情况下是有用的，但是 HashMap 不能很好描述一个领域模型。那样你的应用程序将会使用 JavaBeans 或 POJOs（Plain Old Java Objects，普通 Java 对象）来作为领域模型。MyBatis 对两者都支持。看看下面这个 JavaBean：</p>
<p>package com.someapp.model; public class User {</p>
<p>private int id;</p>
<p>private String username; private String hashedPassword; public int getId() {</p>
<p>return id;</p>
<p>}</p>
<p>public void setId(int id) { this.id = id;</p>
<p>}</p>
<p>public String getUsername() { return username;</p>
<p>}</p>
<p>public void setUsername(String username) { this.username = username;</p>
<p>}</p>
<p>public String getHashedPassword() { return hashedPassword;</p>
<p>}</p>
<p>public void setHashedPassword(String hashedPassword) { this.hashedPassword = hashedPassword;</p>
<p>}</p>
<p>}</p>
<p>基于 JavaBean 的规范，上面这个类有 3 个属性：id，username 和 hashedPassword。这些在 select 语句中会精确匹配到列名。</p>
<p>这样的一个 JavaBean 可以被映射到结果集，就像映射到 HashMap 一样简单。</p>
<p>&lt;select id=”selectUsers” parameterType=”int” resultType=”<strong>com.some app.model.User</strong>”&gt;</p>
<p>select id, username, hashedPassword</p>
<p>from some_table where id = #{id}</p>


<p>要记住类型别名是你的伙伴。使用它们你可以不用输入类的全路径。比如：</p>
<!-- 在XML配置文件中-->

<p>&lt;typeAlias type=”<strong>com.some app.model.User</strong>” alias=” <strong>User</strong>”/&gt;</p>
<!-- 在SQL映射的XML文件中-->

<p>&lt;select id=”selectUsers” parameterType=”int” resultType=” <strong>User</strong>”&gt;</p>
<p>select id, username, hashedPassword from some_table</p>
<p>where id = #{id}</p>


<p>这些情况下，MyBatis 会在幕后自动创建一个 ResultMap，基于属性名来映射列到</p>
<p>JavaBean 的属性上。如果列名没有精确匹配，你可以在列名上使用 select 字句的别名（一个标准的 SQL 特性）来匹配标签。比如：</p>
<p>&lt;select id=”selectUsers” parameterType=”int” resultType=” <strong>User</strong>”&gt; select</p>
<p>user_id <strong>as “id”</strong>, user_name <strong>as “userName”</strong>,</p>
<p>hashed_password <strong>as</strong> <strong>“hashe dPasswor d”</strong></p>
<p>from some_table</p>
<p>where id = #{id}</p>


<p>ResultMap 最优秀的地方你已经了解了很多了，但是你还没有真正的看到一个。这些简单的示例不需要比你看到的更多东西。只是出于示例的原因，让我们来看看最后一个示例中外部的 resultMap 是什么样子的，这也是解决列名不匹配的另外一种方式。</p>
<resultmap id="**userResultMap**" type="User">

<id property="id" column="user_id">

<result property="username" column="user_name">

<result property="password" column="hashed_password">

</result></result></id></resultmap>

<p>引用它的语句使用 resultMap 属性就行了（注意我们去掉了 resultType 属性）。比如：</p>
<select id="”selectUsers”" parametertype="”int”" resultmap="”**userResultMap**”">

<p>select user_id, user_name, hashed_password</p>
<p>from some_table where id = #{id}</p>
</select>

<p>如果世界总是这么简单就好了。</p>
<h3 id="高级结果映射"><a href="#高级结果映射" class="headerlink" title="高级结果映射"></a>高级结果映射</h3><p>MyBatis 创建的一个想法：数据库不用永远是你想要的或需要它们是什么样的。而我们最喜欢的数据库最好是第三范式或 BCNF 范式，但它们有时不是。如果可能有一个单独的数据库映射，所有应用程序都可以使用它，这是非常好的，但有时也不是。结果映射就是MyBatis 提供处理这个问题的答案。</p>
<p>比如，我们如何映射下面这个语句？</p>
<!-- 非常复杂的语句 -->

<select id="selectBlogDetails" parametertype="int" resultmap="detailedBlogResultMap">

<p>select</p>
<p>B.id as blog_id, B.title as blog_title,</p>
<p>B.author_id as blog_author_id,</p>
<p>A.id as author_id,</p>
<p>A.username as author_username, A.password as author_password, A.email as author_email,</p>
<p>A.bio as author_bio,</p>
<p>A.favourite_section as author_favourite_section, P.id as post_id,</p>
<p>P.blog_id as post_blog_id, P.author_id as post_author_id, P.created_on as post_created_on, P.section as post_section,</p>
<p>P.subject as post_subject, P.draft as draft,</p>
<p>P.body as post_body, C.id as comment_id,</p>
<p>C.post_id as comment_post_id, C.name as comment_name, C.comment as comment_text, T.id as tag_id,</p>
<p>T.name as tag_name</p>
<p>from Blog B</p>
<p>left outer join Author A on B.author_id = A.id left outer join Post P on B.id = P.blog_id left outer join Comment C on P.id = C.post_id</p>
<p>left outer join Post_Tag PT on PT.post_id = P.id</p>
<p>left outer join Tag T on PT.tag_id = T.id where B.id = #{id}</p>
</select>

<p>你可能想把它映射到一个智能的对象模型，包含一个作者写的博客，有很多的博文，每篇博文有零条或多条的评论和标签。下面是一个完整的复杂结果映射例子（假设作者，博客， 博文，评论和标签都是类型的别名）。我们来看看，但是不用紧张，我们会一步一步来说明。当天最初它看起来令人生畏，但实际上非常简单。</p>
<!-- 非常复杂的结果映射 -->

<resultmap id="detailedBlogResultMap" type="Blog">

<constructor>

<idarg column="blog_id" javatype="int">

</idarg></constructor>

<result property="title" column="blog_title">

<association property="author" column="blog_author_id" javatype=" Author">

<id property="id" column="author_id">

<result property="username" column="author_username">

<result property="password" column="author_password">

<result property="email" column="author_email">

<result property="bio" column="author_bio">

<result property="favouriteSection" column="author_favourite_section">

</result></result></result></result></result></id></association>

<collection property="posts" oftype="Post">

<id property="id" column="post_id">

<result property="subject" column="post_subject">

<association property="author" column="post_author_id" javatype="Author">

<collection property="comments" column="post_id" oftype=" Comment">

<id property="id" column="comment_id">




</id></collection>

<collection property="tags" column="post_id" oftype=" Tag">

<id property="id" column="tag_id">

</id></collection>

<discriminator javatype="int" column="draft">

<case value="1" resulttype="DraftPost">

</case></discriminator>

</association></result></id></collection>

</result></resultmap>

<p>resultMap 元素有很多子元素和一个值得讨论的结构。下面是 resultMap 元素的概念视图</p>
<p>resultMap</p>
<p>l  <strong>constructor</strong> – 类在实例化时，用来注入结果到构造方法中</p>
<p>l  <strong>idArg</strong> – ID 参数；标记结果作为 ID 可以帮助提高整体效能</p>
<p>l  <strong>arg</strong> – 注入到构造方法的一个普通结果</p>
<p>l  <strong>id</strong> – 一个 ID 结果；标记结果作为 ID 可以帮助提高整体效能</p>
<p>l  <strong>result</strong> –  注入到字段或 JavaBean 属性的普通结果</p>
<p>l  <strong>association</strong> – 一个复杂的类型关联；许多结果将包成这种类型</p>
<p>l  嵌入结果映射 –  结果映射自身的关联，或者参考一个</p>
<p>l  <strong>collection</strong> – 复杂类型的集</p>
<p>l  嵌入结果映射 – 结果映射自身的集，或者参考一个</p>
<p>l  <strong>discriminator</strong> – 使用结果值来决定使用哪个结果映射</p>
<p>l  <strong>case</strong> – 基于某些值的结果映射</p>
<p>l  嵌入结果映射 – 这种情形结果也映射它本身，因此可以包含很多相同的元素，或者它可以参照一个外部的结果映射。</p>
<p>最佳实践：通常逐步建立结果映射。单元测试的真正帮助在这里。如果你尝试创建一次创建一个向上面示例那样的巨大的结果映射，那么可能会有错误而且很难去控制它来工作。开始简单一些，一步一步的发展。而且要进行单元测试！使用该框架的缺点是它们有时是黑盒（是否可见源代码）。你确定你实现想要的行为的最好选择是编写单元测试。它也可以你帮助得到提交时的错误。</p>
<p>下面一部分将详细说明每个元素。</p>
<p><strong>id</strong>，<strong>result</strong></p>
<id property="id" column="post_id">

<result property="subject" column="post_subject">

<p>这些是结果映射最基本内容。id 和 result 都映射一个单独列的值到简单数据类型（字符串，整型，双精度浮点数，日期等）的单独属性或字段。</p>
<p>这两者之间的唯一不同是 id 表示的结果将是当比较对象实例时用到的标识属性。这帮</p>
<p>助来改进整体表现，特别是缓存和嵌入结果映射（也就是联合映射）。每个都有一些属性：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>property</td>
<td>映射到列结果的字段或属性。如果匹配的是存在的，和给定名称相同   的 JavaBeans 的属性，那么就会使用。否则   MyBatis 将会寻找给定名称</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th></th>
<th>的字段。这两种情形你可以使用通常点式的复杂属性导航。比如，你可以这样映射一些东西：“username”，或者映射到一些复杂的东西：   “address.street.number”。</th>
</tr>
</thead>
<tbody><tr>
<td>column</td>
<td>从数据库中得到的列名，或者是列名的重命名标签。这也是通常和会   传递给 resultSet.getString(columnName)方法参数中相同的字符串。</td>
</tr>
<tr>
<td>javaType</td>
<td>一个 Java   类的完全限定名，或一个类型别名（参加上面内建类型别名的列表）。如果你映射到一个 JavaBean，MyBatis   通常可以断定类型。然而，如果你映射到的是 HashMap，那么你应该明确地指定 javaType   来保证所需的行为。</td>
</tr>
<tr>
<td>jdbcType</td>
<td>在这个表格之后的所支持的 JDBC 类型列表中的类型。<strong>JDBC</strong> 类型是仅仅需要对插入，更新和删除操作可能为空的列进行处理。这是 JDBC 的需要，而不是 MyBatis   的。如果你直接使用 JDBC 编程，你需要指定   这个类型-但仅仅对可能为空的值。</td>
</tr>
<tr>
<td>typeHandler</td>
<td>我们在前面讨论过默认的类型处理器。使用这个属性，你可以覆盖默认的类型处理器。这个属性值是类的完全限定名或者是一个类型处理   器的实现，或者是类型别名。</td>
</tr>
</tbody></table>
<p>支持的 <strong>JDBC</strong> 类型</p>
<p>为了未来的参考，MyBatis jdbcType JDBC </p>
<h3 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h3><constructor>

<idarg column="id" javatype="int">

<arg column="”username”" javatype="”String”/">

</arg></idarg></constructor>

<p>对于大多数数据传输对象(Data Transfer Object，DTO)类型，属性可以起作用，而且像绝大多数的领域模型，指令也许是你想使用一成不变的类的地方。通常包含引用或查询数据的表很少或基本不变的话对一成不变的类来说是合适的。构造方法注入允许你在初始化时为类设置属性的值，而不用暴露出公有方法。MyBatis 也支持私有属性和私有 JavaBeans 属性来达到这个目的，但是一些人更青睐构造方法注入。<em>Constructor</em>（构造方法）元素支持这个。</p>
<p>看看下面这个构造方法：</p>
<p>public class User {</p>
<p>//…</p>
<p><strong>public User(int id, S tring username) {</strong></p>
<p><strong>//…</strong></p>
<p><strong>}</strong></p>
<p>//…</p>
<p>}</p>
<p>为了向这个构造方法中注入结果，MyBatis 需要通过它的参数的类型来标识构造方法。</p>
<p>Java 没有自查（或反射）参数名的方法。所以当创建一个构造方法元素时，保证参数是按顺序排列的，而且数据类型也是确定的。</p>
<constructor>

<idarg column="id" javatype="int">

<arg column="”username”" javatype="”String”/">

</arg></idarg></constructor>





<p>剩余的属性和规则和固定的 和result </p>
<h3 id="关联"><a href="#关联" class="headerlink" title="关联"></a>关联</h3><association property="author" column="blog_author_id" javatype=" Author">

<id property="id" column="author_id">

<result property="username" column="author_username">

</result></id></association>

<p>关联元素处理“有一个”类型的关系。比如，在我们的示例中，一个博客有一个用户。 关联映射就工作于这种结果之上。你指定了目标属性，来获取值的列，属性的 java 类型（很多情况下 MyBatis 可以自己算出来），如果需要的话还有 jdbc 类型，如果你想覆盖或获取的结果值还需要类型控制器。</p>
<p>关联中不同的是你需要告诉 MyBatis 如何加载关联。MyBatis 在这方面会有两种不同的方式：</p>
<p>l  嵌套查询：通过执行另外一个 SQL 映射语句来返回预期的复杂类型。</p>
<p>l  嵌套结果：使用嵌套结果映射来处理重复的联合结果的子集。</p>
<p>首先，然让我们来查看这个元素的属性。所有的你都会看到，它和普通的只由 select 和</p>
<p>resultMap 属性的结果映射不同。</p>
<table>
<thead>
<tr>
<th></th>
<th>JavaBeans 的属性，那么就会使用。否则 MyBatis 将会寻找给定名称的字段。这两种情形你可以使用通常点式的复杂属性导航。比如，你可以这样映射一  些  东  西  ：“  username  ”，  或  者  映  射  到  一  些  复  杂  的  东  西  ：   “address.street.number”。</th>
</tr>
</thead>
<tbody><tr>
<td>column</td>
<td>来 自 数 据 库 的 列 名 ， 或 重 命 名 的   列 标 签 。 这 和 通 常 传 递 给   resultSet.getString(columnName)方法的字符串是相同的。   注意： 要处理复合主键，你可以指定多个列名通过 <strong>column=</strong> ”   <strong>{prop1=col1,prop2=col2}</strong> ” 这种语法来传递给嵌套查询语句。这会引起   <strong>prop1</strong>   和 <strong>prop2</strong>   以参数对象形式来设置给目标嵌套查询语句。</td>
</tr>
<tr>
<td>javaType</td>
<td>一个 Java 类的完全限定名，或一个类型别名（参加上面内建类型别名的列   表）。如果你映射到一个   JavaBean，MyBatis 通常可以断定类型。然而，如果你映射到的是   HashMap，那么你应该明确地指定 javaType 来保证所需的   行为。</td>
</tr>
<tr>
<td>jdbcType</td>
<td>在这个表格之前的所支持的 JDBC   类型列表中的类型。<strong>JDBC</strong>   类型是仅仅需要对插入，更新和删除操作可能为空的列进行处理。这是   JDBC 的需要， 而不是 MyBatis 的。如果你直接使用 JDBC 编程，你需要指定这个类型-但   仅仅对可能为空的值。</td>
</tr>
<tr>
<td>typeHandler</td>
<td>我们在前面讨论过默认的类型处理器。使用这个属性，你可以覆盖默认的类型处理器。这个属性值是类的完全限定名或者是一个类型处理器的实现，   或者是类型别名。</td>
</tr>
</tbody></table>
<p>关联的嵌套查询</p>
<p>示例：</p>
<resultmap id="”blogResult”" type="”Blog”">

<p>&lt;association property=”author” column=”blog_author_id” javaType=”Author” <strong>select=”selectAuthor”</strong>/&gt;</p>
</resultmap>

<p><select id="”selectBlog”" parametertype="”int”" resultmap="”blogResult”"> SELECT * FROM BLOG WHERE ID = #{id}</select></p>


<p><select id="”selectAuthor”" parametertype="”int”" resulttype="Author"> SELECT * FROM AUTHOR WHERE ID = #{id}</select></p>


<p>我们有两个查询语句：一个来加载博客，另外一个来加载作者，而且博客的结果映射描述了“selectAuthor”语句应该被用来加载它的 author 属性。</p>
<h6 id="其他所有的属性将会被自动加载，假设它们的列和属性名相匹配。"><a href="#其他所有的属性将会被自动加载，假设它们的列和属性名相匹配。" class="headerlink" title="其他所有的属性将会被自动加载，假设它们的列和属性名相匹配。"></a>其他所有的属性将会被自动加载，假设它们的列和属性名相匹配。</h6><p>这种方式很简单，但是对于大型数据集合和列表将不会表现很好。问题就是我们熟知的</p>
<p>“N+1 查询问题”。概括地讲，N+1 查询问题可以是这样引起的：</p>
<p>l  你执行了一个单独的 SQL 语句来获取结果列表（就是“+1”）。</p>
<p>l  对返回的每条记录，你执行了一个查询语句来为每个加载细节（就是“N”）。这个问题会导致成百上千的 SQL 语句被执行。这通常不是期望的。</p>
<p>MyBatis 能延迟加载这样的查询就是一个好处，因此你可以分散这些语句同时运行的消耗。然而，如果你加载一个列表，之后迅速迭代来访问嵌套的数据，你会调用所有的延迟加载，这样的行为可能是很糟糕的。</p>
<p>所以还有另外一种方法。关联的嵌套结果</p>
<table>
<thead>
<tr>
<th>resultMap</th>
<th>这是结果映射的   ID，可以映射关联的嵌套结果到一个合适的对象图中。这   是一种替代方法来调用另外一个查询语句。这允许你联合多个表来合成到一个单独的结果集。这样的结果集可能包含重复，数据的重复组需要被分解，合理映射到一个嵌套的对象图。为了使它变得容易，MyBatis 让你“链接”结果映射，来处理嵌套结果。例子会很容易来仿照，这个表格后面也   有一个示例。</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>在上面你已经看到了一个非常复杂的嵌套关联的示例。下面这个是一个非常简单的示例来说明它如何工作。代替了执行一个分离的语句，我们联合博客表和作者表在一起，就像：</p>
<p><select id="selectBlog" parametertype="int" resultmap="blogResult"> select</select></p>
<p>B.id as blog_id, B.title as blog_title,</p>
<p>B.author_id as blog_author_id, A.id as author_id,</p>
<p>A.username as author_username, A.password as author_password, A.email as author_email,</p>
<p>A. bio as author_bio</p>
<p>From Blog B <strong>left outer join Author A on B.author_id = A.id</strong></p>
<p>where B.id = #{id}</p>


<p>注意这个联合查询，以及采取保护来确保所有结果被唯一而且清晰的名字来重命名。这使得映射非常简单。现在我们可以映射这个结果：</p>
<p><strong><resultmap id="blogResult" type="Blog"></resultmap></strong></p>
<p><strong><id property="”blog_id”" column="id"></id></strong></p>
<result property="title" column="blog_title">

<p>&lt;association property=”author” column=”blog_author_id” javaType=”Author” <strong>resultMap=”authorResult”/&gt;</strong></p>
<p><strong></strong></p>
<p><strong><resultmap id="authorResult" type="Author"></resultmap></strong></p>
<p><strong><id property="id" column="author_id"></id></strong></p>
<result property="username" column="author_username">

<result property="password" column="author_password">

<result property="email" column="author_email">

<result property="bio" column="author_bio">

<p><strong></strong></p>
<p>在上面的示例中你可以看到博客的作者关联代表着“authorResult”结果映射来加载作</p>
<p>者实例。</p>
<p>非常重要：在嵌套结果映射中 <em>id</em> 元素扮演了非常重要的角色。应该通常指定一个或多个属性，它们可以用来唯一标识结果。实际上就是如果你不使用它（id 元素），但是会产生一个严重的性能问题，不过 MyBatis 仍然可以正常工作。选择的属性越少越好，它们可以唯一地标识结果。主键就是一个显而易见的选择（即便是联合主键）。</p>
<p>现在，上面的示例用了外部的结果映射元素来映射关联。这使得 Author 结果映射可以重用。然而，如果你不需要重用它的话，或者你仅仅引用你所有的结果映射合到一个单独描述的结果映射中。你可以嵌套结果映射。这里给出使用这种方式的相同示例：</p>
<p><strong><resultmap id="blogResult" type="Blog"></resultmap></strong></p>
<p><strong><id property="”blog_id”" column="id"></id></strong></p>
<result property="title" column="blog_title">

<association property="author" column="blog_author_id" javatype="Author">

<p><strong><id property="id" column="author_id"></id></strong></p>
<result property="username" column="author_username">

<result property="password" column="author_password">

<result property="email" column="author_email">

<result property="bio" column="author_bio">

</result></result></result></result></association>

<p><strong></strong></p>
<p>上面你已经看到了如何处理“有一个”类型关联。但是“有很多个”是怎样的？下面这个部分就是来讨论这个主题的。</p>
<h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><collection property="posts" oftype="domain.blog.Post">

<id property="id" column="post_id">

<result property="subject" column="post_subject">

<result property="body" column="post_body">

</result></result></id></collection>

<p>集合元素的作用几乎和关联是相同的。实际上，它们也很相似，文档的异同是多余的。     所以我们更多关注于它们的不同。</p>
<p>我们来继续上面的示例，一个博客只有一个作者。但是博客有很多文章。在博客类中，</p>
<p>这可以由下面这样的写法来表示：</p>
<p>private List<post> posts;</post></p>
<p>要映射嵌套结果集合到 List 中，我们使用集合元素。就像关联元素一样，我们可以从连接中使用嵌套查询，或者嵌套结果。</p>
<p>集合的嵌套查询</p>
<p>首先，让我们看看使用嵌套查询来为博客加载文章。</p>
<resultmap id="”blogResult”" type="”Blog”">

<p><strong><collection property="posts" javatype="”ArrayList”" column="blog_id" oftype="Post" select="”selectPostsForBlog”/"></collection></strong></p>
</resultmap>

<select id="”selectBlog”" parametertype="”int”" resultmap="”blogResult”">




<p>SELECT * FROM BLOG WHERE ID = #{id}</p>
</select>

<p><select id="”selectPostsForBlog”" parametertype="”int”" resulttype="Author"> SELECT * FROM POST WHERE <strong>BLOG_ID = #{id}</strong></select></p>


<p>这里你应该注意很多东西，但大部分代码和上面的关联元素是非常相似的。首先，你应该注意我们使用的是集合元素。然后要注意那个新的“<strong>of Type</strong>”属性。这个属性用来区分</p>
<p>JavaBean（或字段）属性类型和集合包含的类型来说是很重要的。所以你可以读出下面这个映射：</p>
<p><strong><collection property="posts" javatype="”ArrayList”" column="blog_id" oftype="Post" select="”selectPostsForBlog”/"></collection></strong></p>
<p>读作：“在 Post 类型的 ArrayList 中的 posts 的集合。”</p>
<p>javaType 属性是不需要的，因为 MyBatis 在很多情况下会为你算出来。所以你可以缩短写法：</p>
<p><strong><collection property="posts" column="blog_id" oftype="Post" select="”selectPostsForBlog”/"></collection></strong></p>
<p>集合的嵌套结果</p>
<p>至此，你可以猜测集合的嵌套结果是如何来工作的，因为它和关联完全相同，除了它应用了一个“<strong>ofType</strong>”属性</p>
<p><select id="selectBlog" parametertype="int" resultmap="blogResult"> select</select></p>
<p>B. id as blog_id, B.title as blog_title,</p>
<p>B.author_id as blog_author_id, P.id as post_id,</p>
<p>P.subject as post_subject, P.body as post_body,</p>
<p>from Blog B</p>
<p>left outer join Post P on B.id = P.blog_id where B.id = #{id}</p>


<p>我们又一次联合了博客表和文章表，而且关注于保证特性，结果列标签的简单映射。现在用文章映射集合映射博客，可以简单写为：</p>
<p><strong><resultmap id="blogResult" type="Blog"></resultmap></strong></p>
<p><strong><id property="”id”" column="blog_id"></id></strong></p>
<result property="title" column="blog_title">

<p><strong><collection property="posts" oftype="Post"></collection></strong></p>
<p><strong><id property="id" column="post_id"></id></strong></p>
<result property="subject" column="post_subject">

<result property="body" column="post_body">

<p><strong></strong></p>
<p><strong></strong></p>
<p>同样，要记得 <em>id</em> 元素的重要性，如果你不记得了，请阅读上面的关联部分。</p>
<p>同样，如果你引用更长的形式允许你的结果映射的更多重用，你可以使用下面这个替代的映射：</p>
<p><strong><resultmap id="blogResult" type="Blog"></resultmap></strong></p>
<p><strong><id property="”id”" column="blog_id"></id></strong></p>
<result property="title" column="blog_title">

<p><strong><collection property="posts" oftype="Post" resultmap="”blogPostResult”/"></collection></strong></p>
<p><strong></strong></p>
<p><strong><resultmap id="blogPostResult" type="Post"></resultmap></strong></p>
<p><strong><id property="id" column="post_id"></id></strong></p>
<result property="subject" column="post_subject">

<result property="body" column="post_body">

<p><strong></strong></p>
<p>注意：这个对你所映射的内容没有深度，广度或关联和集合相联合的限制。当映射它们时你应该在大脑中保留它们的表现。你的应用在找到最佳方法前要一直进行的单元测试和性能测试。好在 myBatis 让你后来可以改变想法，而不对你的代码造成很小（或任何）影响。高级关联和集合映射是一个深度的主题。文档只能给你介绍到这了。加上一点联系，你</p>
<p>会很快清楚它们的用法。</p>
<h3 id="鉴别器"><a href="#鉴别器" class="headerlink" title="鉴别器"></a>鉴别器</h3><discriminator javatype="int" column="draft">

<case value="1" resulttype="DraftPost">

</case></discriminator>

<p>有时一个单独的数据库查询也许返回很多不同（但是希望有些关联）数据类型的结果集。鉴别器元素就是被设计来处理这个情况的，还有包括类的继承层次结构。鉴别器非常容易理解，因为它的表现很像 Java 语言中的 switch 语句。</p>
<p>定义鉴别器指定了 <em>column</em> 和 <em>javaType</em> 属性。列是 MyBatis 查找比较值的地方。JavaType 是需要被用来保证等价测试的合适类型（尽管字符串在很多情形下都会有用）。比如：</p>
<resultmap id="vehicleResult" type="Vehicle">

<id property="”id”" column="id">

<result property="vin" column="vin">

<result property="year" column="year">

<result property="make" column="make">

<result property="model" column="model">

<result property="color" column="color">

<discriminator javatype="int" column="vehicle_type">

<case value="1" resultmap="carResult">

<case value="2" resultmap="truckResult">

<case value="3" resultmap="vanResult">

<case value="4" resultmap="suvResult">

</case></case></case></case></discriminator>

</result></result></result></result></result></id></resultmap>

<p>在这个示例中，MyBatis 会从结果集中得到每条记录，然后比较它的 vehicle 类型的值。如果它匹配任何一个鉴别器的实例，那么就使用这个实例指定的结果映射。换句话说，这样做完全是剩余的结果映射被忽略（除非它被扩展，这在第二个示例中讨论）。如果没有任何一个实例相匹配，那么 MyBatis 仅仅使用鉴别器块外定义的结果映射。所以，如果 carResult</p>
<p>按如下声明：</p>
<resultmap id="carResult" type="Car">

<result property="”doorCount”" column="door_count">

</result></resultmap>

<p>那么只有 doorCount 属性会被加载。这步完成后完整地允许鉴别器实例的独立组，尽管和父结果映射可能没有什么关系。这种情况下，我们当然知道 cars 和 vehicles 之间有关系， 如 Car 是一个 Vehicle 实例。因此，我们想要剩余的属性也被加载。我们设置的结果映射的简单改变如下。</p>
<resultmap id="carResult" type="Car" extends="”vehicleResult”">

<result property="”doorCount”" column="door_count">

</result></resultmap>

<p>现在 vehicleResult 和 carResult 的属性都会被加载了。</p>
<p>尽管曾经有些人会发现这个外部映射定义会多少有一些令人厌烦之处。因此还有另外一种语法来做简洁的映射风格。比如：</p>
<resultmap id="vehicleResult" type="Vehicle">

<id property="”id”" column="id">

<result property="vin" column="vin">

<result property="year" column="year">

<result property="make" column="make">

<result property="model" column="model">

<result property="color" column="color">

<discriminator javatype="int" column="vehicle_type">

<case value="1" resulttype="carResult">

<result property="”doorCount”" column="door_count">

</result></case>

<case value="2" resulttype="truckResult">

<result property="”boxSize”" column="box_size">

<result property="”extendedCab”" column="extended_cab">

</result></result></case>

<case value="3" resulttype="vanResult">

<result property="”powerSlidingDoor”" column="power_sliding_door">

</result></case>

<case value="4" resulttype="suvResult">

<result property="”allWheelDrive”" column="all_wheel_drive">

</result></case>

</discriminator>

</result></result></result></result></result></id></resultmap>

<p>要记得这些都是结果映射，如果你不指定任何结果，那么 MyBatis 将会为你自动匹配列和属性。所以这些例子中的大部分是很冗长的，而其实是不需要的。也就是说，很多数据库是很复杂的，我们不太可能对所有示例都能依靠它。</p>
<p>缓存</p>
<p>MyBatis 包含一个非常强大的查询缓存特性，它可以非常方便地配置和定制。MyBatis 3</p>
<p>中的缓存实现的很多改进都已经实现了，使得它更加强大而且易于配置。</p>
<p>默认情况下是没有开启缓存的，除了局部的 session 缓存，可以增强变现而且处理循环依赖也是必须的。要开启二级缓存，你需要在你的 SQL 映射文件中添加一行：</p>
<cache>

<p>字面上看就是这样。这个简单语句的效果如下：</p>
<p>l  映射语句文件中的所有 <strong>select</strong> 语句将会被缓存。</p>
<p>l  映射语句文件中的所有 <strong>insert</strong>，<strong>update</strong> 和 <strong>delete</strong> 语句会刷新缓存。</p>
<p>l  缓存会使用 <strong>Least Recently Used</strong>（<strong>LRU</strong>，最近最少使用的）算法来收回。</p>
<p>l  根据时间表（比如 <strong>n**</strong>o  Flush  Interval**，没有刷新间隔），缓存不会以任何时间顺序来刷新。</p>
<p>l  缓存会存储列表集合或对象（无论查询方法返回什么）的 <strong>1024</strong> 个引用。</p>
<p>l  缓存会被视为是 <strong>read/write</strong>（可读/可写）的缓存，意味着对象检索不是共享的，而且可以安全地被调用者修改，而不干扰其他调用者或线程所做的潜在修改。</p>
<p>所有的这些属性都可以通过缓存元素的属性来修改。比如：</p>
<p>&lt;cache</p>
<p>eviction=”FIFO” flushInterval=”60000” size=”512” readOnly=”true”/&gt;</p>
<p>这个更高级的配置创建了一个 FIFO 缓存，并每隔 60 秒刷新，存数结果对象或列表的</p>
<p>512 个引用，而且返回的对象被认为是只读的，因此在不同线程中的调用者之间修改它们会导致冲突。</p>
<p>可用的收回策略有：</p>
<p>l  <strong>LRU</strong> – 最近最少使用的：移除最长时间不被使用的对象。</p>
<p>l  <strong>FIFO</strong> – 先进先出：按对象进入缓存的顺序来移除它们。</p>
<p>l  <strong>SOFT</strong> – 软引用：移除基于垃圾回收器状态和软引用规则的对象。</p>
<p>l  <strong>WEAK</strong> – 弱引用：更积极地移除基于垃圾收集器状态和弱引用规则的对象。默认的是 LRU。</p>
<p><strong>flushInterval</strong>（刷新间隔）可以被设置为任意的正整数，而且它们代表一个合理的毫秒形式的时间段。默认情况是不设置，也就是没有刷新间隔，缓存仅仅调用语句时刷新。</p>
<p><strong>size</strong>（引用数目）可以被设置为任意正整数，要记住你缓存的对象数目和你运行环境的可用内存资源数目。默认值是 1024。</p>
<p><strong>readOnly</strong>（只读）属性可以被设置为 <em>true</em> 或 <em>false</em>。只读的缓存会给所有调用者返回缓存对象的相同实例。因此这些对象不能被修改。这提供了很重要的性能优势。可读写的缓存会返回缓存对象的拷贝（通过序列化）。这会慢一些，但是安全，因此默认是 <em>false</em>。</p>
<h3 id="使用自定义缓存"><a href="#使用自定义缓存" class="headerlink" title="使用自定义缓存"></a>使用自定义缓存</h3><p>除了这些自定义缓存的方式，你也可以通过实现你自己的缓存或为其他第三方缓存方案创建适配器来完全覆盖缓存行为。</p>
<cache type="”com.domain.something.MyCustomCache”/">

<p>这个示例展示了如何使用一个自定义的缓存实现。type 属性指定的类必须实现</p>
<p>org.mybatis.cache.Cache 接口。这个接口是 MyBatis 框架中很多复杂的接口之一，但是简单给定它做什么就行。</p>
<p>public interface Cache { String getId();</p>
<p>int getSize();</p>
<p>void putObject(Object key, Object value); Object getObject(Object key);</p>
<p>boolean hasKey(Object key); Object removeObject(Object key); void clear();</p>
<p>ReadWriteLock getReadWriteLock();</p>
<p>}</p>
<p>要配置你的缓存，简单和公有的 JavaBeans 属性来配置你的缓存实现，而且是通过 cache 元素来传递属性，比如，下面代码会在你的缓存实现中调用一个称为“setCacheFile(String file)”的方法：</p>
<cache type="”com.domain.something.MyCustomCache”">

<property name="”cacheFile”" value="”/tmp/my-custom-cache.tmp”/">

</property></cache>

<p>你可以使用所有简单类型作为 JavaBeans 的属性，MyBatis 会进行转换。</p>
<p>记得缓存配置和缓存实例是绑定在 SQL 映射文件的命名空间是很重要的。因此，所有在相同命名空间的语句正如绑定的缓存一样。语句可以修改和缓存交互的方式，或在语句的语句的基础上使用两种简单的属性来完全排除它们。默认情况下，语句可以这样来配置：</p>
<p>&lt;select … flushCache=”false” useCache=”true”/&gt;</p>
<p>&lt;insert … flushCache=”true”/&gt;</p>
<p>&lt;update … flushCache=”true”/&gt;</p>
<p>&lt;delete … flushCache=”true”/&gt;</p>
<p>因为那些是默认的，你明显不能明确地以这种方式来配置一条语句。相反，如果你想改变默认的行为，只能设置 flushCache 和 useCache 属性。比如，在一些情况下你也许想排除从缓存中查询特定语句结果，或者你也许想要一个查询语句来刷新缓存。相似地，你也许有一些更新语句依靠执行而不需要刷新缓存。</p>
<p>参照缓存</p>
<p>回想一下上一节内容，这个特殊命名空间的唯一缓存会被使用或者刷新相同命名空间内的语句。也许将来的某个时候，你会想在命名空间中共享相同的缓存配置和实例。在这样的情况下你可以使用 cache-ref 元素来引用另外一个缓存。</p>
<cache-ref namespace="”com.someone.application.data.SomeMapper”/">



<p>动态 <strong>SQL</strong></p>
<p>MyBatis 的一个强大的特性之一通常是它的动态 SQL 能力。如果你有使用 JDBC 或其他</p>
<p>相似框架的经验，你就明白条件地串联 SQL 字符串在一起是多么的痛苦，确保不能忘了空格或在列表的最后省略逗号。动态 SQL 可以彻底处理这种痛苦。</p>
<p>通常使用动态 SQL 不可能是独立的一部分，MyBatis 当然使用一种强大的动态 SQL 语言来改进这种情形，这种语言可以被用在任意映射的 SQL 语句中。</p>
<p>动态 SQL 元素和使用 JSTL 或其它相似的基于 XML 的文本处理器相似。在 MyBatis 之前的版本中，有很多的元素需要来了解。MyBatis 3 大大提升了它们，现在用不到原先一半的元素就能工作了。MyBatis 采用功能强大的基于 OGNL 的表达式来消除其他元素。</p>
<p>l  if</p>
<p>l  choose(when,otherwise)</p>
<p>l  trim(where,set)</p>
<p>l  foreach</p>
<p><strong>if</strong></p>
<p>在动态 SQL 中所做的最通用的事情是包含部分 where 字句的条件。比如：</p>
<p><select id="”findActiveBlogWithTitleLike”" parametertype="”Blog”" resulttype="”Blog”"> SELECT * FROM BLOG</select></p>
<p>WHERE state = „ACTIVE‟</p>
<p>&lt;if test=”title != null”&gt; AND title like #{title}</p>




<p>这条语句会提供一个可选的文本查找功能。如果你没有传递 title，那么所有激活的博客都会被返回。但是如果你传递了 title，那么就会查找相近的 title（对于敏锐的检索，这中情况下你的参数值需要包含任意的遮掩或通配符）的博客。</p>
<p>假若我们想可选地搜索 title 和 author 呢？首先，要改变语句的名称让它有意义。然后简单加入另外的一个条件。</p>
<select id="”findActiveBlogLike”" parametertype="”Blog”" resulttype="”Blog”">

<p>SELECT * FROM BLOG WHERE state = „ACTIVE‟</p>
<p>&lt;if test=”title != null”&gt; AND title like #{title}</p>


<p>&lt;if test=”author != null and author.name != null”&gt; AND title like #{author.name}</p>


</select>





<p><strong>choose, when, otherwise</strong></p>
<p>有时我们不想应用所有的条件，相反我们想选择很多情况下的一种。和 Java 中的 switch</p>
<p>语句相似，MyBatis 提供 choose 元素。</p>
<p>我们使用上面的示例，但是现在我们来搜索当 title 提供时仅有 title 条件，当 author 提供时仅有 author 条件。如果二者都没提供，只返回 featured blogs（也许是由管理员策略地选择的结果列表，而不是返回大量没有意义的，随机的博客结果列表）。</p>
<select id="”findActiveBlogLike”" parametertype="”Blog”" resulttype="”Blog”">

<p>SELECT * FROM BLOG WHERE state = „ACTIVE‟</p>
<choose>

<p>&lt;when test=”title != null”&gt; AND title like #{title}</p>


<p>&lt;when test=”author != null and author.name != null”&gt; AND title like #{author.name}</p>


<otherwise>

<p>AND featured = 1</p>
</otherwise>

</choose>

</select>



<p><strong>trim, where, set</strong></p>
<p>前面的例子已经方便地处理了一个臭名昭著的动态 SQL 问题。要考虑我们回到“<em>i*</em>f*”示例后会发生什么，但是这次我们将“ACTIVE = 1”也设置成动态的条件。</p>
<select id="”findActiveBlogLike”" parametertype="”Blog”" resulttype="”Blog”">

<p>SELECT * FROM BLOG WHERE</p>
<p>&lt;if test=”state != null”&gt;</p>
<p>state = #{state}</p>


<p>&lt;if test=”title != null”&gt; AND title like #{title}</p>


<p>&lt;if test=”author != null and author.name != null”&gt; AND title like #{author.name}</p>


</select>

<p>如果这些条件都没有匹配上将会发生什么？这条 SQL 结束时就会成这样：</p>
<p>SELECT * FROM BLOG WHERE</p>
<p>这会导致查询失败。如果仅仅第二个条件匹配是什么样的？这条 SQL 结束时就会是这</p>
<p>样：</p>
<p>SELECT * FROM BLOG WHERE</p>
<p><strong>AND</strong> title like „someTitle‟</p>
<p>这个查询也会失败。这个问题不能简单的用条件来解决，如果你从来没有这样写过，那么你以后也不会这样来写。</p>
<p>MyBatis 有一个简单的处理，这在 90%的情况下都会有用。而在不能使用的地方，你可</p>
<p>以自定义处理方式。加上一个简单的改变，所有事情都会顺利进行：</p>
<select id="”findActiveBlogLike”" parametertype="”Blog”" resulttype="”Blog”">

<p>SELECT * FROM BLOG</p>
<p><strong><where></where></strong></p>
<p>&lt;if test=”state != null”&gt; state = #{state}</p>


<p>&lt;if test=”title != null”&gt; AND title like #{title}</p>


<p>&lt;if test=”author != null and author.name != null”&gt; AND title like #{author.name}</p>


<p><strong>&lt;/ where &gt;</strong></p>
</select>

<p><em>w**here</em> 元素知道如果由被包含的标记返回任意内容，就仅仅插入“WHERE”。而且，如果以“AND”或“OR”开头的内容，那么就会跳过 WHERE 不插入。</p>
<p>如果 <em>where</em> 元素没有做出你想要的，你可以使用 <em>trim</em> 元素来自定义。比如，和 <em>where</em></p>
<p>元素相等的 <em>trim</em> 元素是：</p>
<trim prefix="WHERE" prefixoverrides="AND |OR ">

<p>…</p>
</trim>

<p>overrides 属性采用管道文本分隔符来覆盖，这里的空白也是重要的。它的结果就是移除在 <em>overrides</em> 属性中指定的内容，插入在 <em>with</em> 属性中的内容。</p>
<p>和动态更新语句相似的解决方案是 <em>set<em>。</em>set</em> 元素可以被用于动态包含更新的列，而不包含不需更新的。比如：</p>
<update id="updateAuthorIfNecessary" parametertype="domain.blog.Author">

<p>update Author</p>
<set>

<p><if test="username != null">username=#{username},</if></p>
<p><if test="password != null">password=#{password},</if></p>
<p><if test="email != null">email=#{email},</if></p>
<p><if test="bio != null">bio=#{bio}</if></p>
</set>

<p>where id=#{id}</p>
</update>

<p>这里，<em>set</em> 元素会动态前置 SET 关键字，而且也会消除任意无关的逗号，那也许在应用条件之后来跟踪定义的值。</p>
<p>如果你对和这相等的 <em>trim</em> 元素好奇，它看起来就是这样的：</p>
<trim prefix="SET" suffixoverrides=",">

<p>…</p>
</trim>

<p>注意这种情况下我们覆盖一个后缀，而同时也附加前缀。</p>
<p><strong>foreach</strong></p>
<p>另外一个动态SQL 通用的必要操作是迭代一个集合，通常是构建在IN 条件中的。比如：</p>
<p><select id="selectPostIn" resulttype="domain.blog.Post"> SELECT *</select></p>
<p>FROM POST P WHERE ID in</p>
<p><strong><foreac h ite m="ite m" inde x="index" c ollection="list" open="(" separator="," close=")"></foreac></strong></p>
<p><strong>#{item}</strong></p>
<p><strong>&lt;/fore ach&gt;</strong></p>


<p><em>foreach</em> 元素是非常强大的，它允许你指定一个集合，声明集合项和索引变量，它们可以用在元素体内。它也允许你指定开放和关闭的字符串，在迭代之间放置分隔符。这个元素是很智能的，它不会偶然地附加多余的分隔符。</p>
<p>注意：你可以传递一个 List 实例或者数组作为参数对象传给 MyBatis。当你这么做的时候，MyBatis  会自动将它包装在一个  Map 中，用名称作为键。List 实例将会以“list”作为键，而数组实例将会以“array”作为键。</p>
<p>这个部分是对关于 XML 配置文件和 XML 映射文件的而讨论的。下一部分将详细讨论</p>
<p>Java API，所以你可以得到你已经创建的最有效的映射。</p>
<p><strong>Java API</strong></p>
<p>既然你已经知道如何配置 MyBatis 和创建映射文件，你就已经准备好来提升技能了。MyBatis 的 Java API 就是你收获你所做的努力的地方。正如你即将看到的，和 JDBC 相比， MyBatis 很大程度简化了你的代码而且保持简洁，很容易理解和维护。MyBatis 3 已经引入了很多重要的改进来使得 SQL 映射更加优秀。</p>
<p>应用目录结构</p>
<p>在我们深入 Java API 之前，理解关于目录结构的最佳实践是很重要的。MyBatis 非常灵活，你可以用你自己的文件来做几乎所有的事情。但是对于任一框架，都有一些最佳的方式。</p>
<p>让我们看一下典型应用的目录结构：</p>
<h6 id="my-application"><a href="#my-application" class="headerlink" title="/my_application"></a>/my_application</h6><h6 id="bin"><a href="#bin" class="headerlink" title="/bin"></a>/bin</h6><h6 id="devlib"><a href="#devlib" class="headerlink" title="/devlib"></a>/devlib</h6><p><strong>/lib</strong>                                                                                    ←MyBatis *.jar文件在这里。</p>
<h6 id="src"><a href="#src" class="headerlink" title="/src"></a>/src</h6><h6 id="org-myapp"><a href="#org-myapp" class="headerlink" title="/org/myapp/"></a>/org/myapp/</h6><h6 id="action"><a href="#action" class="headerlink" title="/action"></a>/action</h6><p><strong>/data</strong>                                                                  ←MyBatis配置文件在这里，</p>
<p>/SqlMapConfig.xml             包括映射器类，XML配置，</p>
<p>/BlogMapper.java              XML映射文件。</p>
<h5 id="BlogMapper-xml"><a href="#BlogMapper-xml" class="headerlink" title="/BlogMapper.xml"></a>/BlogMapper.xml</h5><h6 id="model"><a href="#model" class="headerlink" title="/model"></a>/model</h6><h6 id="service"><a href="#service" class="headerlink" title="/service"></a>/service</h6><h6 id="view"><a href="#view" class="headerlink" title="/view"></a>/view</h6><p><strong>/prope</strong> <strong>rties</strong>                                                                ←在你XML中配置的属性</p>
<p>/test                                      文件在这里。</p>
<h6 id="org-myapp-1"><a href="#org-myapp-1" class="headerlink" title="/org/myapp/"></a>/org/myapp/</h6><h6 id="action-1"><a href="#action-1" class="headerlink" title="/action"></a>/action</h6><h6 id="data"><a href="#data" class="headerlink" title="/data"></a>/data</h6><h6 id="model-1"><a href="#model-1" class="headerlink" title="/model"></a>/model</h6><h6 id="service-1"><a href="#service-1" class="headerlink" title="/service"></a>/service</h6><h6 id="view-1"><a href="#view-1" class="headerlink" title="/view"></a>/view</h6><h6 id="properties-1"><a href="#properties-1" class="headerlink" title="/properties"></a>/properties</h6><h6 id="web-要记得这只是参照，而不是"><a href="#web-要记得这只是参照，而不是" class="headerlink" title="/web                                    要记得这只是参照，而不是"></a>/web                                    要记得这只是参照，而不是</h6><h6 id="WEB-INF-要求，可能其他人会感谢你"><a href="#WEB-INF-要求，可能其他人会感谢你" class="headerlink" title="/WEB-INF                             要求，可能其他人会感谢你"></a>/WEB-INF                             要求，可能其他人会感谢你</h6><h6 id="web-xml-使用了通用的目录结构。"><a href="#web-xml-使用了通用的目录结构。" class="headerlink" title="/web.xml                          使用了通用的目录结构。"></a>/web.xml                          使用了通用的目录结构。</h6><p>这部分内容剩余的示例将假设你使用了这种目录结构。</p>
<h2 id="SqlSessions"><a href="#SqlSessions" class="headerlink" title="SqlSessions"></a>SqlSessions</h2><p>使用 MyBatis 的主要 Java 接口就是 SqlSession。尽管你可以使用这个接口执行命令，获取映射器和管理事务。我们会讨论 SqlSession 本身更多，但是首先我们还是要了解如果获取一个 SqlSession 实例。SqlSessions 是由 SqlSessionFactory 实例创建的。SqlSessionFactory 对象 包 含 创 建 SqlSession 实 例 的 所 有 方 法 。 而 SqlSessionFactory 本 身 是 由SqlSessionFactoryBuilder 创建的，它可以从 XML 配置，注解或手动配置 Java 来创建SqlSessionFactory。</p>
<p><strong>SqlSessionFactoryBuilder</strong></p>
<p>SqlSessionFactoryBuilder 有五个 build()方法，每一种都允许你从不同的资源中创建一个</p>
<p>SqlSession 实例。</p>
<p>SqlSessionFactory build(Reader reader)</p>
<p>SqlSessionFactory build(Reader reader, String environment) SqlSessionFactory build(Reader reader, Properties properties) SqlSessionFactory build(Reader reader, String env, Properties props) SqlSessionFactory build(Configuration config)</p>
<p>第一种方法是最常用的，它使用了一个参照了 XML 文档或上面讨论过的更特定的</p>
<p>SqlMapConfig.xml 文件的 Reader 实例。可选的参数是 <em>environment</em> 和 <em>properties</em>。Environment</p>
<p>决定加载哪种环境，包括数据源和事务管理器。比如：</p>
<environments default=" **de** **velopment**">

<environment id=" **de** **velopment**">

<transactionmanager type="JDBC">

<p>…</p>
<datasource type="POOLED">

<p>…</p>
</datasource></transactionmanager></environment>

<environment id=" **producti** **on**">

<transactionmanager type="EXTERNAL">

<p>…</p>
<datasource type="JNDI">

<p>…</p>
</datasource></transactionmanager></environment>

</environments>

<p>如果你调用了一个使用 <em>environment</em> 参数的 build 方法， 那么 MyBatis 将会使用</p>
<p>configuration 对象来配置这个 environment。当然，如果你指定了一个不合法的 environment， 你会得到错误提示。如果你调用了其中之一没有 <em>environment</em> 参数的 build 方法，那么就使用默认的 environment（在上面的示例中就会指定为 default=”development”）。</p>
<p>如果你调用了使用 properties 实例的方法，那么 MyBatis 就会加载那些 properties（属性</p>
<p>配置文件），并你在你配置中可使用它们。那些属性可以用${propName}语法形式多次用在配置文件中。</p>
<p>回想一下，属性可以从 SqlMapConf ig.xml 中被引用，或者直接指定它。因此理解优先</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td><img src="file:///C:/Users/10136/AppData/Local/Temp/msohtmlclip1/01/clip_image002.gif" alt="img"></td>
</tr>
</tbody></table>
<p> 级是很重要的。我们在文档前面已经提及它了，但是这里要再次重申：</p>
<p>如果一个属性存在于这些位置，那么 MyBatis 将会按找下面的顺序来加载它们：</p>
<p>l  在 properties 元素体中指定的属性首先被读取，</p>
<p>l  从 properties 元素的类路径 resource 或 url 指定的属性第二个被读取，可以覆盖已经指定的重复属性，</p>
<p>l  作为方法参数传递的属性最后被读取，可以覆盖已经从 properties 元素体和</p>
<p>resource/url 属性中加载的任意重复属性。</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td><img src="file:///C:/Users/10136/AppData/Local/Temp/msohtmlclip1/01/clip_image002.gif" alt="img"></td>
</tr>
</tbody></table>
<p> 因此，最高优先级的属性是通过方法参数传递的，之后是 属性指定的，最后是在 元素体中指定的属性。</p>
<p>总结一下，前四个方法很大程度上是相同的，但是由于可以覆盖，就允许你可选地指定environment 和/或 properties。这里给出一个从 SqlMapConfig.xml 文件创建 SqlSessionFactory 的示例：</p>
<p>String <strong>resource</strong> = “org/mybatis/builder/MapperConfig.xml”; Reader <strong>reader</strong> = Resources.getResourceAsReader(<strong>resource</strong>);</p>
<p>SqlSessionFactoryBuilder <strong>buil der</strong> = new SqlSessionFactoryBuilder(); SqlSessionFactory <strong>fac tor y</strong> = builder.build(<strong>re ader</strong>);</p>
<p>注意这里我们使用了 <em>Resources</em> 工具类，这个类在 org.mybatis.io 包中。<em>Resources</em> 类正</p>
<p>如其名，会帮助你从类路径下，文件系统或一个 web URL 加载资源文件。看一下这个类的源代码或者通过你的 IDE 来查看，就会看到一整套有用的方法。这里给出一个简表：</p>
<p>URL getResourceURL(String resource)</p>
<p>URL getResourceURL(ClassLoader loader, String resource) InputStream getResourceAsStream(String resource)</p>
<p>InputStream getResourceAsStream(ClassLoader loader, String resource) Properties getResourceAsProperties(String resource)</p>
<p>Properties getResourceAsProperties(ClassLoader loader, String resource)</p>
<p>Reader getResourceAsReader(String resource)</p>
<p>Reader getResourceAsReader(ClassLoader loader, String resource) File getResourceAsFile(String resource)</p>
<p>File getResourceAsFile(ClassLoader loader, String resource) InputStream getUrlAsStream(String urlString)</p>
<p>Reader getUrlAsReader(String urlString)</p>
<p>Properties getUrlAsProperties(String urlString) Class classForName(String className)</p>
<p>最后一个 build 方法使用了一个 Configuration 实例。configuration 类包含你可能需要了</p>
<p>解 SqlSessionFactory 实例的所有内容。Configuration 类对于配置的自查很有用，包含查找和操作 SQL 映射（不推荐使用，因为应用正接收请求）。configuration 类有所有配置的开关， 这些你已经了解了，只在  Java  API  中露出来。这里有一个简单的示例，如何手动配置</p>
<p>configuration 实例，然后将它传递给 build()方法来创建 SqlSessionFactory。</p>
<p>DataSource <strong>dataSource</strong> = BaseDataTest.createBlogDataSource(); TransactionFactory <strong>transactionFac tor y</strong> = new JdbcTransactionFactory( ); Environment <strong>environment</strong> =</p>
<p>new Environment(“development”, <strong>transactionFac tor y</strong>, <strong>dataSource</strong>); Configuration <strong>configurati on</strong> = n ew Configuration(<strong>envir onme nt</strong>); configuration.setLazyLoadingEnabled(true); configuration.setEnhancementEnabled(true); configuration.getTypeAliasRegistry().registerAlias(Blog.class); configuration.getTypeAliasRegistry().registerAlias(Post.class); configuration.getTypeAliasRegistry().registerAlias(Author.class); configuration.addMapper(BoundBlogMapper.class); configuration.addMapper(BoundAuthorMapper.class); SqlSessionFactoryBuilder <strong>buil der</strong> = new SqlSessionFactoryBuilder(); SqlSessionFactory factory = builder.build(<strong>configurati on</strong>);</p>
<p>现在你有一个 SqlSessionFactory，可以用来创建 SqlSession 实例。</p>
<p><strong>SqlSessionFactory</strong></p>
<p>SqlSessionFactory 有六个方法可以用来创建 SqlSession 实例。通常来说，如何决定是你选择下面这些方法时：</p>
<p>l  <strong>Transaction</strong>（事务）：你想为 session 使用事务或者使用自动提交（通常意味着很多数据库和/或 JDBC 驱动没有事务）？</p>
<p>l  <strong>C**</strong>onnection**（连接）：你想  MyBatis  获得来自配置的数据源的连接还是提供你自己定义的连接？</p>
<p>l  <strong>Execution</strong>（执行）：你想 MyBatis 复用预处理语句和/或批量更新语句（包括插入和删除）？</p>
<p>重载的 openSession()方法签名设置允许你选择这些可选中的任何一个组合。</p>
<p>SqlSession openSession()</p>
<p>SqlSession openSession(boolean autoCommit) SqlSession openSession(Connection connection)</p>
<p>SqlSession openSession(TransactionIsolationLevel level)</p>
<p>SqlSession openSession(ExecutorType execType,</p>
<p>TransactionIsolationLevel level) SqlSession openSession(ExecutorType execType)</p>
<p>SqlSession openSession(ExecutorType execType, boolean autoCommit) SqlSession openSession(ExecutorType execType, Connec tion connection) Configuration getConfiguration();</p>
<p>默认的 openSession()方法没有参数，它会创建有如下特性的 SqlSession：</p>
<p>l  将会开启一个事务（也就是不自动提交）范围</p>
<p>l  连接对象会从由活动环境配置的数据源实例中得到。</p>
<p>l  事务隔离级别将会使用驱动或数据源的默认设置。</p>
<p>l  预处理语句不会被复用，也不会批量处理更新。</p>
<p>这些方法大都可以自我解释的。开启自动提交，传递“true”给可选的 <em>autoCommit</em> 参数。提供自定义的连接，传递一个 Connection 实例给 <em>connection</em> 参数。注意没有覆盖同时设置Connection 和 autoCommit 两者的方法，因为 MyBatis 会使用当前 connection 对象提供的设置。MyBatis 为事务隔离级别调用使用一个 Java 枚举包装器，称为 TransactionIsolationLevel， 否 则 它 们 按 预 期 的 方 式 来 工 作 ， 并 有 JDBC 支 持 的 5 级</p>
<p>（ NONE,READ_UNCOMMITTED,READ_COMMITTED,REPEATABLE_READ,SERI ALIZA BLE）</p>
<p>还有一个可能对你来说是新见到的参数，就是 ExecutorType。这个枚举类型定义了 3 个值：</p>
<p>ExecutorType.SIMPLE</p>
<p>这个执行器类型不做特殊的事情。它为每个语句的执行创建一个新的预处理语句。</p>
<p>ExecutorType.REUSE</p>
<p>这个执行器类型会复用预处理语句。</p>
<p>ExecutorType.BATCH</p>
<p>这个执行器会批量执行所有更新语句，如果 SELECT  在它们中间执行还会标定它们是必须的，来保证一个简单并易于理解的行为。</p>
<p>注意：在 SqlSessionFactory 中还有一个方法我们没有提及，就是 <em>getConfiguration()</em>。这个方法会返回一个 Configuration 实例，在运行时你可以使用它来自检 MyBatis 的配置。</p>
<p>注意：如果你已经使用之前版本 MyBatis，你要回忆那些 session，transaction 和 batch</p>
<p>都是分离的。现在和以往不同了，这些都包含在 session 的范围内了。你需要处理分开处理事务或批量操作来得到它们的效果。</p>
<p><strong>SqlSession</strong></p>
<p>如上面所提到的，SqlSession 实例在 MyBatis 中是非常强大的一个类。在这里你会发现所有执行语句的方法，提交或回滚事务，还有获取映射器实例。</p>
<p>在 SqlSession 类中有超过 20 个方法，所以将它们分开成易于理解的组合。语句执行方法</p>
<p>这些方法被用来执行定义在 SQL 映射的 XML 文件中的 SELECT，INSERT，UPDAT E 和 DELETE 语句。它们都会自行解释，每一句都使用语句的 ID 属性和参数对象，参数可以是原生类型（自动装箱或包装类），JavaBean，POJO 或 Map。</p>
<p>Object selectOne(String statement, Object parameter) List selectList(String statement, Object parameter) int insert(String statement, Object parameter)</p>
<p>int update(String statement, Object parameter) int delete(String statement, Object parameter)</p>
<p>selectOne 和 selectList 的不同仅仅是 selectOne 必须返回一个对象。如果多余一个，或者</p>
<p>没有返回（或返回了 null），那么就会抛出异常。如果你不知道需要多少对象，使用 selectList。如果你想检查一个对象是否存在，那么最好返回统计数（0 或 1）。因为并不是所有语句都需要参数，这些方法都是有不同重载版本的，它们可以不需要参数对象。</p>
<p>Object selectOne(String statement) List selectList(String statement) int insert(String statement)</p>
<p>int update(String statement) int delete(String statement)</p>
<p>最后，还有查询方法的三个高级版本，它们允许你限制返回行数的范围，或者提供自定</p>
<p>义结果控制逻辑，这通常用于大量的数据集合。</p>
<p>List selectList</p>
<p>(String statement, Object parameter, RowBounds rowBounds)</p>
<p>void select</p>
<p>(String statement, Object parameter, ResultHandler handler) void select</p>
<p>(String statement, Object parameter, RowBounds rowBounds,</p>
<p>ResultHandler handler)</p>
<p>RowBounds 参数会告诉 MyBatis 略过指定数量的记录，还有限制返回结果的数量。</p>
<p>RowBounds 类有一个构造方法来接收 offset 和 limit，否则是不可改变的。</p>
<p>int offset = 100; int limit = 25;</p>
<p>RowBounds rowBounds = new RowBounds(offset, limit);</p>
<p>不同的驱动会实现这方面的不同级别的效率。对于最佳的表现，使用结果集类型的</p>
<p>SCROLL_SENSITIVE 或 SCROLL_INSENSITIVE（或句话说：不是 FORWARD_ONLY）。</p>
<p>ResultHandler 参数允许你按你喜欢的方式处理每一行。你可以将它添加到 List 中，创建Map，Set 或抛出每个结果而不是只保留总计。你可以使用ResultHandler 做很多漂亮的事，那就是 MyBatis 内部创建结果集列表。</p>
<p>它的接口很简单。</p>
<p>package org.mybatis.executor.result; public interface ResultHandler {</p>
<p>void handleResult(ResultContext context);</p>
<p>}</p>
<p>ResultContext 参数给你访问结果对象本身的方法，大量结果对象被创建，你可以使用布尔返回值的 stop()方法来停止 MyBatis 加载更多的结果。</p>
<p>事务控制方法</p>
<p>控制事务范围有四个方法。当然，如果你已经选择了自动提交或你正在使用外部事务管理器，这就没有任何效果了。然而，如果你正在使用 JDBC 事务管理员，由 Connection 实例来控制，那么这四个方法就会派上用场：</p>
<p>void commit()</p>
<p>void commit(boolean force) void rollback()</p>
<p>void rollback(boolean force)</p>
<p>默认情况下 MyBatis 不会自动提交事务，除非它侦测到有插入，更新或删除操作改变了数据库。如果你已经做出了一些改变而没有使用这些方法，那么你可以传递 true 到 commit 和 rollback 方法来保证它会被提交（注意，你不能在自动提交模式下强制 session，或者使用了外部事务管理器时）。很多时候你不用调用 rollback()，因为如果你没有调用 commit 时MyBatis 会替你完成。然而，如果你需要更多对多提交和回滚都可能的 session 的细粒度控制，你可以使用回滚选择来使它成为可能。</p>
<p>清理 <strong>Session</strong> 级的缓存</p>
<p>void clearCache()</p>
<p>SqlSession 实例有一个本地缓存在执行 update，commit，rollback 和 close 时被清理。要明确地关闭它（获取打算做更多的工作），你可以调用 clearCache()。</p>
<p>确保 <strong>SqlSession</strong> 被关闭</p>
<p>void close()</p>
<p>你必须保证的最重要的事情是你要关闭所打开的任何 session。保证做到这点的最佳方式是下面的工作模式：</p>
<p>SqlSession session = sqlSessionFactory.openSession(); try {</p>
<p>// 下面3行pseudocod来做一些工作</p>
<p>session.insert(…); session.update(…); session.delete(…); session.commit();</p>
<p>} finally {</p>
<p>session.close();</p>
<p>}</p>
<p>注意：就像 SqlSessionFactory，你可以通过调用 getConfiguration()方法获得 SqlSession</p>
<p>使用的 Configuration 实例</p>
<p>Configuration getConfiguration()</p>
<p>使用映射器</p>
<p><t> T getMapper(Class<t> type)</t></t></p>
<p>上述的各个 insert，update，delete 和 select 方法都很强大，但也有些繁琐，没有类型安全，对于你的 IDE 也没有帮助，还有可能的单元测试。在上面的入门章节中我们已经看到了一个使用映射器的示例。</p>
<p>因此，一个更通用的方式来执行映射语句是使用映射器类。一个映射器类就是一个简单</p>
<p>的接口，其中的方法定义匹配于 SqlSession 方法。下面的示例展示了一些方法签名和它们是如何映射到 SqlSession 的。</p>
<p><strong>public inter face Author Mapper {</strong></p>
<p>// (Author) selectOne(“selectAuthor”,5);</p>
<p><strong>Author selectAuthor(int i d);</strong></p>
<p>// (List<author>) selectList(“selectAuthors”)</author></p>
<p><strong>List<author> selectAuthors();</author></strong></p>
<p>// insert(“insertAuthor”, author)</p>
<p><strong>voi d insertAuthor(Author author);</strong></p>
<p>// updateAuthor(“updateAuhor”, author)</p>
<p><strong>voi d update Author(Author author );</strong></p>
<p>// delete(“deleteAuthor”,5)</p>
<p><strong>voi d delete Author(int i d);</strong></p>
<p><strong>}</strong></p>
<p>总之，每个映射器方法签名应该匹配相关联的 SqlSession 方法，而没有字符串参数 ID。相反，方法名必须匹配映射语句的 ID。</p>
<p>此外，返回类型必须匹配期望的结果类型。所有常用的类型都是支持的，包括：原生类型，Map，POJO 和 JavaBean。</p>
<p>映射器接口不需要去实现任何接口或扩展任何类。只要方法前面可以被用来唯一标识对应的映射语句就可以了。</p>
<p>映射器接口可以扩展其他接口。当使用 XML 来构建映射器接口时要保证在合适的命名空间中有语句。而且，唯一的限制就是你不能在两个继承关系的接口中有相同的方法签名（这也是不好的想法）。</p>
<p>你可以传递多个参数给一个映射器方法。如果你这样做了，默认情况下它们将会以它们在参数列表中的位置来命名，比如：#{1},#{2}等。如果你想改变参数的名称（只在多参数</p>
<p>情况下），那么你可以在参数上使用@Param(“paramName”)注解。你也可以给方法传递一个 RowBounds 实例来限制查询结果。</p>
<p>映射器注解</p>
<p>因为最初设计时，MyBatis 是一个 XML 驱动的框架。配置信息是基于 XML 的，而且映射语句也是定义在 XML 中的。而到了 MyBatis 3，有新的可用的选择了。MyBatis 3 构建在基于全面而且强大的 Java 配置 API 之上。这个配置 API 是基于 XML 的 MyBatis 配置的基础，也是新的基于注解配置的基础。注解提供了一种简单的方式来实现简单映射语句，而不会引入大量的开销。</p>
<p>注意：不幸的是，Java 注解限制了它们的表现和灵活。尽管很多时间都花调查，设计和</p>
<p>实验上，最强大的 MyBatis 映射不能用注解来构建，那并不可笑。C#属性（做示例）就没有这些限制，因此 MyBatis.NET 将会比 XML 有更丰富的选择。也就是说，基于 Java 注解的配置离不开它的特性。</p>
<p>注解有下面这些：</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th>示了应该被用于比较（和在 XML 映射中的<id>相似）的属性。one 属性是单独的联系， 和<association> 相似，而   many   属 性 是 对 集 合 而 言 的 ， 和    <collection>相似。它们这样命名是为了   避免名称冲突。</collection></association></id></th>
</tr>
</thead>
<tbody><tr>
<td><strong>@One</strong></td>
<td>方法</td>
<td><association></association></td>
<td>复杂类型的单独属性值映射。属性：   <strong>select</strong>，已映射语句（也就是映射器方法）的完全限定名，它可以加载合适类型的实例。注意：联合映射在注解 API 中是不支持的。这是因为  Java 注解的   限制，不允许循环引用。</td>
</tr>
<tr>
<td><strong>@Many</strong></td>
<td>方法</td>
<td><collection></collection></td>
<td>复杂类型的集合属性映射。属性：   <strong>select</strong>，是映射语句（也就是映射器方法）的完全限定名，它可以加载合适类型的一组实例。注意：联合映射在 Java   注解中是不支持的。这是因为  Java 注   解的限制，不允许循环引用。</td>
</tr>
<tr>
<td><strong>@Options</strong></td>
<td>方法</td>
<td>映射语句的属性</td>
<td>这个注解提供访问交换和配置选项的宽广范围，它们通常在映射语句上作为属性出现。而不是将每条语句注解变复杂，Options 注解提供连贯清晰的方式来访问它们。属性：<strong>useCache=true</strong> ， <strong>flushCache=false</strong> ，   <strong>resultSetType=FORWARD_ONLY</strong>   ， <strong>statementType=PREPARED</strong>            ， <strong>fetchSize=-1</strong> ， <strong>timeout=-1</strong> ， <strong>useGeneratedKeys=false</strong>                  ，   <strong>keyProperty=”id”</strong>。理解 Java 注解是很重要的，因为没有办法来指定“null”作为值。因此，一旦你使用了 Options 注解，语句就受所有默认值的支配。要注意什么样的默认值来避免不期望的   行为。</td>
</tr>
<tr>
<td><strong>@Insert   @Update @Delete</strong></td>
<td>方法</td>
<td><insert>   <update>   <delete></delete></update></insert></td>
<td>这些注解中的每一个代表了执行的真实 SQL。它们每一个都使用字符串数组   （或单独的字符串）。如果传递的是字符串数组，它们由每个分隔它们的单独空间串联起来。这就当用 Java 代码构建 SQL 时避免了“丢失空间”的问题。然而，如果你喜欢，也欢迎你串联单独的字符串。属性：<strong>value</strong>，这是字符串   数组用来组成单独的 SQL 语句。</td>
</tr>
<tr>
<td><strong>@InsertProvider</strong></td>
<td>方法</td>
<td><insert></insert></td>
<td>这些可选的 SQL 注解允许你指定一个</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><strong>@UpdateProvider   @DeleteProvider @SelectProvider</strong></th>
<th></th>
<th><update>   <delete>   <select>   允许创建动态    SQL。</select></delete></update></th>
<th>类名和一个方法在执行时来返回运行的 SQL。基于执行的映射语句，MyBatis会实例化这个类，然后执行由 provider 指定的方法. 这个方法可以选择性的接受参数对象作为它的唯一参数，但是必须只指定该参数或者没有参数。属性：   <strong>type</strong>，<strong>method</strong>。type   属性是类的完全限定名。method 是该类中的那个方法名。注意：这节之后是对   SelectBuilder   类的讨论，它可以帮助你以干净，容于阅读   的方式来构建动态 SQL。</th>
</tr>
</thead>
<tbody><tr>
<td><strong>@Param</strong></td>
<td>参数</td>
<td>N/A</td>
<td>如果你的映射器的方法需要多个参数， 这个注解可以被应用于映射器的方法参数来给每个参数一个名字。否则，多参数将会以它们的顺序位置来被命名   （不包括任何 RowBounds 参数）。比如   #{1} ， #{2} 等，这是默认的。使用   @Param(“person”)，参数应该被命名为   #{person}。</td>
</tr>
</tbody></table>
<p><strong>SelectBuilder</strong></p>
<p>一个 Java 程序员面对的最痛苦的事情之一就是在 Java 代码中嵌入 SQL 语句。通常这么做是因为 SQL 要动态的生成-否则你可以将它们放到外部的文件或存储过程中。正如你已经看到的，MyBatis 在它的 XML 映射特性中有处理生成动态 SQL 的很强大的方案。然而，有时必须在 Java 代码中创建 SQL 语句的字符串。这种情况下，MyBatis 有另外一种特性来帮助你，在减少典型的加号，引号，新行，格式化问题和嵌入条件来处理多余的逗号或 AND 连接词之前，事实上，在 Java 代码中动态生成 SQL 就是一个噩梦。</p>
<p>MyBatis 3 引入了一些不同的理念来处理这个问题，我们可以创建一个类的实例来调用其中的方法来一次构建 SQL 语句。但是我们的 SQL 结尾时看起来很像 Java 代码而不是 SQL 语句。相反，我们尝试了一些不同的做法。最终的结果是关于特定领域语言的结束，Java 也 不 断 实 现 它 目 前 的 形 式 …                                                                               <strong>SelectBuilder</strong> 的秘密</p>
<p>SelectBuilder 类并不神奇，如果你不了解它的工作机制也不会有什么好的作用。别犹豫，</p>
<p>让我们来看看它是怎么工作的。SelectBuilder 使用了静态引入和 TreadLocal 变量的组合来开启简洁的语法可以很容易地用条件进行隔行扫描，而且为你保护所有 SQL 的格式。它允许你创建这样的方法：</p>
<p>public String selectBlogsSql() {</p>
<p><strong>B EGIN</strong>(); // Clears ThreadLocal variable</p>
<p><strong>SELECT</strong>(“*”);</p>
<p><strong>FROM</strong>(“BLOG”);</p>
<p>return <strong>SQL</strong>();</p>
<p>}</p>
<p>这是一个非常简单的示例，你也许会选择静态地来构建。所以这里给出一个复杂一点的</p>
<p>示例：</p>
<p>private String selectPersonSql() {</p>
<p><strong>B EGIN</strong>(); // Clears ThreadLocal variable <strong>SELECT</strong>(“P.ID, P.USERNAME, P.PASSWORD, P.FULL_NAME”); <strong>SELECT</strong>(“P.LAST_NAME, P.CREATED_ON, P.UPDATED_ON”); <strong>FROM</strong>(“PERSON P”);</p>
<p><strong>FROM</strong>(“ACCOUNT A”);</p>
<p><strong>INNER_JOIN</strong>(“DEPARTMENT D on D.ID = P.DEPARTMENT_ID”);</p>
<p><strong>INNER_JOIN</strong>(“COMPANY C on D.COMPANY_ID = C.ID”);</p>
<p><strong>WHERE</strong>(“P.ID = A.ID”);</p>
<p><strong>WHERE</strong>(“P.FIRST_NAME like ?”);</p>
<p><strong>OR</strong>();</p>
<p><strong>WHERE</strong>(“P.LAST_NAME like ?”); <strong>GROUP_B Y</strong>(“P.ID”); <strong>HAVING</strong>(“P.LAST_NAME like ?”); <strong>OR</strong>();</p>
<p><strong>HAVING</strong>(“P.FIRST_NAME like ?”);</p>
<p><strong>ORDER_B Y</strong>(“P.ID”); <strong>ORDER_B Y</strong>(“P.FULL_NAME”);</p>
<p>return <strong>SQL</strong>();</p>
<p>}</p>
<p>用字符串连接的方式来构建上面的 SQL 就会有一些繁琐了。比如：</p>
<p>“SELECT P.ID, P.USERNAME, P.PASSWORD, P.FULL_NAME, “ “P.LAST_NAME,P.CREATED_ON, P.UPDATED_ON “ +</p>
<p>“FROM PERSON P, ACCOUNT A “ +</p>
<p>“INNER JOIN DEPARTMENT D on D.ID = P.DEPARTMENT_ID “ + “INNER JOIN COMPANY C on D.COMPANY_ID = C.ID “ + “WHERE (P.ID = A.ID AND P.FIRST_NAME like ?) “ +</p>
<p>“OR (P.LAST_NAME like ?) “ +</p>
<p>“GROUP BY P.ID “ +</p>
<p>“HAVING (P.LAST_NAME like ?) “ + “OR (P.FIRST_NAME like ?) “ + “ORDER BY P.ID, P.FULL_NAME”;</p>
<p>如果你喜欢那样的语法，那么你就可以使用它。它很容易出错，要小心那些每行结尾增</p>
<p>加的空间。现在，即使你喜欢这样的语法，下面的示例比 Java 中的字符串连接要简单也是没有疑问的：</p>
<p>private String selectPersonLike(Person p){</p>
<p><strong>B EGIN</strong>(); // Clears ThreadLocal variable</p>
<p><strong>SELECT</strong>(“P.ID, P.USERNAME, P.PASSWORD, P.FIRST_NAME, P.LAST_NAME”);</p>
<p><strong>FROM</strong>(“PERSON P”);</p>
<p>if (p.id != null) {</p>
<p><strong>WHERE</strong>(“P.ID like #{id}”);</p>
<p>}</p>
<p>if (p.firstName != null) {</p>
<p><strong>WHERE</strong>(“P.FIRST_NAME like #{firstName}”);</p>
<p>}</p>
<p>if (p.lastName != null) {</p>
<p><strong>WHERE</strong>(“P.LAST_NAME like #{lastName}”);</p>
<p>}</p>
<p><strong>ORDER_B Y</strong>(“P.LAST_NAME”);</p>
<p>return <strong>SQL</strong>();</p>
<p>}</p>
<p>这个例子有什么特殊之处？如果你看得仔细，那就不同担心偶然会重复的“AND”关键字，或在“WHERE”和“AND”或两者都没有中选择！上面的语句将会由例子对所有</p>
<p>PERSON 记录生成一个查询，有像参数一样的 ID 或 firstName 或 lastName-或这三者的任意组合。SelectBuilder 对理解哪里放置“WHERE”，哪里应该使用“AND”还有所有的字符串连接都是很小心的。最好的情况，无论你以何种顺序调用这些方法（只有一种例外使用 OR() 方法）。</p>
<p>有两个方法会吸引你的眼球：BEGIN()和 SQL()。总之，每个 SelectBuilder 方法应该以调用 BEGIN（）开始，以调用 SQL()结束。当然你可以在中途提取方法来打断你执行的逻辑，但是 SQL 生成的范围应该以 BEGIN()方法开始而且以 SQL()方法结束。BEGIN()方法清理 ThreadLocal 变量，来确保你不会不小心执行了前面的状态，而且 SQL()方法会基于这些调用，从最后一次调用 BEGIN()开始组装你的 SQL 语句。注意 BEGIN()有一个称为 RESET() 的代替方法，它们所做的工作相同，只是 RESET()会在特定上下文中读取的更好。</p>
<p>要按照上面示例的方式使用 SelectBuilder，你应该静态引入如下内容：</p>
<p>import <strong>static</strong> org.mybatis.jdbc.<strong>SelectBuilder.* ;</strong></p>
<p>只要这个被引入了，那么你使用的类就会拥有 SelectBuilder 的所有可用的方法。下表就是可用方法的完整列表：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>BEGIN()/RESET()</td>
<td>这些方法清理 SelectBuilder 类的 ThreadLocal   的状态，而且准备构建新的语句。当开始一条新的语句时，BEGIN()读取得最好。当在执行中间因为某些原因（在某些条件下，也许处理逻辑需要一个完整的而且不同的语句）要清理一条语句   时 RESET()读取的做好。</td>
</tr>
<tr>
<td>SELECT(String)</td>
<td>开始或附加一个 SELECT   子句。可以被多次调用，而且参数会被追加在 SELECT 子句后面。参数通常是逗号分隔的列名   列表和别名，但要是驱动程序可以接受的东西。</td>
</tr>
<tr>
<td>SELECT_DISTINCT(String)</td>
<td>开始或附加一个   SELECT 子句，也在生成的查询语句中添加   “DISTINCT”关键字。可以被多次调用，而且参数会被追加在 SELECT 子句后面。参数通常是逗号分隔的列名列表和   别名，但要是驱动程序可以接受的东西。</td>
</tr>
<tr>
<td>FROM(String)</td>
<td>开始或附加一个 FROM 子句。可以被多次调用，而且参数会被追加在 FROM   子句后面。参数通常是表明或别名，或是驱   动程序可以接受的任意内容。</td>
</tr>
<tr>
<td>JOIN(String)   INNER_JOIN(String)   LEFT_OUTER_JOIN(String)</td>
<td>基于调用的方法，添加一个合适类型的新的   JOIN   子句。参数可以包含列之间基本的 join 连接还有条件连接。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>RIGHT_OUTER_JOIN(String)</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>WHERE(String)</td>
<td>添加一个新的 WHERE 条件子句，由 AND 串联起来。可以被多次调用，由 AND 告诉它来串联一个新的条件。使用 OR()   方法来分隔 OR 条件。</td>
</tr>
<tr>
<td>OR()</td>
<td>使用 OR 来分隔当前 WHERE 子句的条件。可以被多次调用，   但是在一行上多次调用会生成不稳定的 SQL。</td>
</tr>
<tr>
<td>AND()</td>
<td>使用 AND 来分隔当前 WHERE 字句的条件。可以被多次调   用，但是在一行上多次调用会生成不稳定的 SQL。因为   WHERE 和 HAVING 两者都自动串联 AND，这样使用是非   常罕见的，包含它也仅仅是为了完整性。</td>
</tr>
<tr>
<td>GROUP_BY(String)</td>
<td>附加一个新的 GROUP BY 子句，由逗号串联起来。可以被   多次调用，每次使用逗号来告诉它串联一个新的条件。</td>
</tr>
<tr>
<td>HAVING(String)</td>
<td>附加一个新的 HAVING   条件子句，由 AND 串联起来。可以被多次调用，每次使用   AND   来告诉它要串联新的条件。使   用 OR()方法来分隔 OR 条件。</td>
</tr>
<tr>
<td>ORDER_BY(String)</td>
<td>附加一个新的 ORDER BY 子句，由逗号串联起来。可以被   多次调用，每次使用逗号来告诉它串联新的条件。</td>
</tr>
<tr>
<td>SQL()</td>
<td>这会返回生成  SQL 而且重置  SelectBuilder  的状态（正如   BEGIN()或 RESET()方法被调用）。因此，这个方法只能被调   用一次！</td>
</tr>
</tbody></table>
<p><strong>SqlBuilder</strong></p>
<p>和 SelectBuilder 相似，MyBatis 也包含一个一般性的 SqlBuilder。它包含 SelectBuilder 的所有方法，还有构建 insert，update 和 delete 的方法。在 DeleteProvider，InsertProvider 或UpdateProvider 中（还有 SelectProvider）构建 SQL 字符串时这个类就很有用。</p>
<p>在上述示例中要使用 SqlBuilder，你只需简单静态引入如下内容：</p>
<p>import <strong>static</strong> org.mybatis.jdbc.<strong>S</strong> <strong>qlBuil der.*;</strong></p>
<p>SqlBuilder 包含 中的所有方法，还有下面这些额外的方法：</p>
<p>这里是一些示例：</p>
<p>public String deletePersonSql() {</p>
<p><strong>B EGIN</strong>(); // Clears ThreadLocal variable</p>
<p><strong>DELET E_ FROM(</strong>“PERSON”);</p>
<p><strong>WHERE(</strong>“ID = ${id}”);</p>
<p>return <strong>SQL</strong>();</p>
<p>}</p>
<p>public String insertPersonSql() {</p>
<p><strong>B EGIN</strong>(); // Clears ThreadLocal variable</p>
<p><strong>INS ERT_ INTO(</strong>“PERSON”);</p>
<p><strong>VALUES (</strong>“ID, FIRST_NAME”, “${id}, ${firstName}”);</p>
<p><strong>VALUES (</strong>“LAST_NAME”, “${lastName}”);</p>
<p>return <strong>SQL</strong>();</p>
<p>}</p>
<p>public String updatePersonSql() {</p>
<p><strong>B EGIN</strong>(); // Clears ThreadLocal variable</p>
<p><strong>UPDATE(</strong>“PERSON”);</p>
<p><strong>SET(</strong>“FIRST_NAME = ${firstName}”);</p>
<p><strong>WHERE(</strong>“ID = ${id}”);</p>
<p>return <strong>SQL</strong>();</p>
<p>}</p>
</cache-ref></cache></cache></result></result></result></result></result></result></result></result></result></result></result></result></result></id>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://fangchenyong.top/2019/09/05/框架-Mybatis/" data-id="ckmh9z493009droumfe89s7cj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mybatis/">Mybatis</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-框架-Spring" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/02/框架-Spring/" class="article-date">
  <time datetime="2019-09-01T16:00:00.000Z" itemprop="datePublished">2019-09-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Spring/">Spring</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/02/框架-Spring/">Spring笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Spring笔记"><a href="#Spring笔记" class="headerlink" title="Spring笔记"></a>Spring笔记</h2><h3 id="1-Spring-IOC"><a href="#1-Spring-IOC" class="headerlink" title="1. Spring IOC"></a>1. Spring IOC</h3><h4 id="1-1-Spring核心包"><a href="#1-1-Spring核心包" class="headerlink" title="1.1 Spring核心包"></a>1.1 Spring核心包</h4><p><img src="https://fangchenyong.oss-cn-hangzhou.aliyuncs.com/img/20190905092338.png" alt="Spring核心包"></p>
<blockquote>
<p><em>XML编写提示：配置Schema，修改Key type 为Schema location</em></p>
</blockquote>
<h4 id="1-2-SpringIOC入门"><a href="#1-2-SpringIOC入门" class="headerlink" title="1.2. SpringIOC入门"></a>1.2. SpringIOC入门</h4><ol>
<li><p>IOC: Inversion of Control(控制反转)。将对象的创建权反转给（交给）Spring。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean1"</span> <span class="attr">class</span>=<span class="string">"com.joey.spring.Bean1"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>DI：依赖注入，前提必须有IOC的环境，Spring管理这个类的时候将类的依赖的属性注入（设置）进来。</p>
</li>
</ol>
<p><img src="https://fangchenyong.oss-cn-hangzhou.aliyuncs.com/img/20190902210244.png" alt="IOC"></p>
<h4 id="1-3-Spring工厂类结构图"><a href="#1-3-Spring工厂类结构图" class="headerlink" title="1.3. Spring工厂类结构图"></a>1.3. Spring工厂类结构图</h4><p><img src="https://fangchenyong.oss-cn-hangzhou.aliyuncs.com/img/20190902210417.png" alt="工厂类结构图"></p>
<ol>
<li><p>ApplicationContext继承BeanFactory</p>
</li>
<li><p>BeanFactory</p>
<blockquote>
<p>老版本的工厂类，在调用getBean的时候才会产生类的实例</p>
</blockquote>
</li>
<li><p>ApplicationContext</p>
<blockquote>
<p>新版本的工厂类，加载配置文件的时候，将Spring管理的类都实例化</p>
<p>两个实现类：</p>
<ul>
<li>ClassPathXmlApplicationContext：加载类路径下的配置文件</li>
<li>FileSystemXmlApplicationContext：加载文件系统下的配置文件</li>
</ul>
</blockquote>
</li>
</ol>
<h4 id="1-4-Spring-Bean配置"><a href="#1-4-Spring-Bean配置" class="headerlink" title="1.4. Spring Bean配置"></a>1.4. Spring Bean配置</h4><ol>
<li><p><bean>标签的id和name配置</bean></p>
<blockquote>
<p>id：使用了约束中的唯一约束，里面不能出现特殊字符。</p>
<p>name：没有使用约束中的唯一约束（理论上可以出现重复的，但是实际开发不能出现），里面可以出现特殊字符。</p>
</blockquote>
</li>
<li><p>Bean的生命周期配置</p>
<blockquote>
<p>init-method：Bean被初始化的时候执行的方法</p>
<p>destory-method：Bean被销毁的时候执行的方法（Bean是单例创建，工厂关闭）</p>
</blockquote>
</li>
<li><p>Bean的作用范围配置</p>
<blockquote>
<p>scope：Bean的作用范围</p>
<ul>
<li>singleton：默认单例模式创建对象</li>
<li>prototype：多例模式</li>
<li>request：应用在web项目中，Spring创建这个类以后存到request范围中</li>
<li>session：应用在web项目中，Spring创建这个类以后存到session范围中</li>
<li>globalsession：应用在web项目中，必须在porlet环境下使用，但是如果没有这种环境，相对于session</li>
</ul>
</blockquote>
</li>
</ol>
<h4 id="1-5-Spring的Bean管理（XML方式）"><a href="#1-5-Spring的Bean管理（XML方式）" class="headerlink" title="1.5. Spring的Bean管理（XML方式）"></a>1.5. Spring的Bean管理（XML方式）</h4><ol>
<li><p>Spring的Bean的实例化方式</p>
<blockquote>
<ol>
<li><p>无参构造方法</p>
<ul>
<li><p>编写类构造方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&gt;      <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bean1</span></span>&#123;</span><br><span class="line">&gt;          <span class="function"><span class="keyword">public</span> <span class="title">Bean1</span><span class="params">()</span></span>&#123;</span><br><span class="line">&gt;              <span class="keyword">super</span>();</span><br><span class="line">&gt;              System.out.pringt(<span class="string">"Bean1的无参构造方法执行。。。"</span>);</span><br><span class="line">&gt;          &#125;</span><br><span class="line">&gt;      &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
</blockquote>
<blockquote>
<ul>
<li><p>编写XML配置文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">&gt;      <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean1"</span> <span class="attr">class</span>=<span class="string">"com.joey.spring.Bean1"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<ol start="2">
<li><p>静态工厂实例化</p>
<ul>
<li><p>编写静态工厂</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&gt;      <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bean2Factory</span></span>&#123;</span><br><span class="line">&gt;          <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bean2 <span class="title">createBean2</span><span class="params">()</span></span>&#123;</span><br><span class="line">&gt;              System.out.pringt(<span class="string">"Bean2的静态工厂方法执行。。。"</span>);</span><br><span class="line">&gt;              <span class="keyword">return</span> <span class="keyword">new</span> Bean2();</span><br><span class="line">&gt;          &#125;</span><br><span class="line">&gt;      &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
</blockquote>
<blockquote>
<ul>
<li><p>编写XML配置文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">&gt;      <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean2"</span> <span class="attr">class</span>=<span class="string">"com.joey.spring.Bean2Factory"</span> <span class="attr">factory-method</span>=<span class="string">"createBean2"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<ol start="3">
<li><p>实例工厂实例化</p>
<ul>
<li><p>编写实例工厂</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&gt;      <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bean3Factory</span></span>&#123;</span><br><span class="line">&gt;          <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bean3 <span class="title">createBean3</span><span class="params">()</span></span>&#123;</span><br><span class="line">&gt;              System.out.pringt(<span class="string">"Bean3的实例工厂方法执行。。。"</span>);</span><br><span class="line">&gt;              <span class="keyword">return</span> <span class="keyword">new</span> Bean3();</span><br><span class="line">&gt;          &#125;</span><br><span class="line">&gt;      &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
</blockquote>
<blockquote>
<ul>
<li><p>配置XML文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">&gt;      <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean3Factory"</span> <span class="attr">class</span>=<span class="string">"com.joey.spring.Bean3Factory"</span> &gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">&gt;      <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean3"</span> <span class="attr">factory-bean</span>=<span class="string">"bean3Factory"</span> <span class="attr">factory-method</span>=<span class="string">"createBean3"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
</li>
<li><p>Spring的属性注入(DI)</p>
<ol>
<li><p>构造方法的方式属性注入</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置一个可以执行批量的sqlSession --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSession"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionTemplate"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"executorType"</span> <span class="attr">value</span>=<span class="string">"BATCH"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Set方法的方式属性注入</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--================== 配置和MyBatis的整合=============== --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 指定mybatis全局配置文件的位置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis-config.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"pooledDataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 指定mybatis，mapper文件的位置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperLocations"</span> <span class="attr">value</span>=<span class="string">"classpath:mapper/*.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>P名称空间属性注入</p>
<ol>
<li><p>引入P名称空间</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.3.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.3.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd"</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>P名称空间的属性注入</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car"</span> <span class="attr">class</span>=<span class="string">"com.joey.spring.Car"</span> <span class="attr">p:name</span>=<span class="string">""</span> <span class="attr">p:price</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"employee"</span> <span class="attr">class</span>=<span class="string">"com.joey.spring.Employee"</span> <span class="attr">p:name</span>=<span class="string">""</span> <span class="attr">p:car-ref</span>=<span class="string">"car"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>SpEL的属性注入（Spring3.0以后）</p>
<blockquote>
<p>spring表达式语言简称<strong>SPEL</strong>：是一个支持运行时查询和操作对象图的强大的表达式语言。语法类似于<strong>EL</strong>，SpEL 使用 #{…} 作为定界符 , 所有在大括号中的字符都将被认为是 SpEL , SpEL 为 bean 的属性进行动态赋值提供了便利。</p>
</blockquote>
<blockquote>
<h5 id="通过-SpEL-可以实现："><a href="#通过-SpEL-可以实现：" class="headerlink" title="通过 SpEL 可以实现："></a>通过 SpEL 可以实现：</h5><ul>
<li>通过 bean 的 id 对 bean 进行引用。</li>
<li>调用方式以及引用对象中的属性。</li>
<li>计算表达式的值</li>
<li>正则表达式的匹配</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"carInfo"</span> <span class="attr">class</span>=<span class="string">"com.joey.spring.CarInfo"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car"</span> <span class="attr">class</span>=<span class="string">"com.joey.spring.car"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"#&#123;carInfo.name&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"drive"</span> <span class="attr">value</span>=<span class="string">"#&#123;carInfo.drive()&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>Spring集合类型属性注入</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Spring的集合属性的注入============================ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 注入数组类型 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"collectionBean"</span> <span class="attr">class</span>=<span class="string">"com.joey.spring.CollectionBean"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 数组类型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"arrs"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注入list集合 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>5<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>6<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>7<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注入set集合 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"set"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>aaa<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>bbb<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>ccc<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注入Map集合 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"aaa"</span> <span class="attr">value</span>=<span class="string">"111"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"bbb"</span> <span class="attr">value</span>=<span class="string">"222"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"ccc"</span> <span class="attr">value</span>=<span class="string">"333"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>分模块开发配置</p>
<ol>
<li><p>加载配置文件的时候加载多个</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ApplicationCOntext applicationCOntext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationConetxt.xml"</span>,<span class="string">"applicationConetxt.xml2"</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>在一个配置文件中引入多个配置文件</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;<span class="keyword">import</span> resource=<span class="string">"applicationConetxt2.xml"</span>/&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
</li>
</ol>
<h4 id="1-6-Spring的Bean管理（注解开发）"><a href="#1-6-Spring的Bean管理（注解开发）" class="headerlink" title="1.6. Spring的Bean管理（注解开发）"></a>1.6. Spring的Bean管理（注解开发）</h4><ol>
<li><p>引入context约束</p>
</li>
<li><p>开启Spring组件扫描</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.joey.spring"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>


</li>
</ol>
<ol start="3">
<li><p>类上添加注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Compoent</span>(<span class="string">"userDao"</span>) <span class="comment">//相当于&lt;bean id="userDao" class="com.joey.spring.UserDaoImpl"&gt;&lt;/bean&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">UserDao</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注解方式设置属性值</p>
<blockquote>
<p>使用注解方式，可以没有set方法的</p>
<ul>
<li><p>属性如果有set方法，需要将属性注入的注解添加到set方法</p>
</li>
<li><p>如果没有set方法，需要将属性注入的注解添加属性上</p>
</li>
</ul>
</blockquote>
</li>
<li><p>IOC 注解</p>
<ol>
<li>@Component：组件，修饰一个类，将这个类交给Spring管理</li>
<li>三个衍生注解，修饰类<ul>
<li>@Controller：Web层</li>
<li>@ServIce：service层</li>
<li>@Respository：dao层</li>
</ul>
</li>
<li>属性注入的注解：<ul>
<li>普通属性：@Value</li>
<li>按照类型对象注入：@Autoware</li>
<li>按照名称对象注入：@Resource</li>
</ul>
</li>
<li>Bean的其他注解：<ul>
<li>生命周期相关注解<ul>
<li>PostConstruct：初始化方法</li>
<li>PreDestory：销毁方法</li>
</ul>
</li>
<li>Bean作用范围的注解<ul>
<li>@Scope<ul>
<li>Singleton</li>
<li>prototype</li>
<li>request</li>
<li>session</li>
<li>globalsession</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
<li><p>IOC的XML和注解开发比较</p>
<blockquote>
<p>XML ：可以适用任何场景，结构清晰，维护方便</p>
<p>注解：有些地方用不了，类不是自己提供，开发方便</p>
<p>XML和注解整合开发：XML管理Bean，注解完成属性注入</p>
<p>没有使用扫描类上的注解，需要开启属性注入的注解</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">&gt; <span class="tag">&lt;<span class="name">context：annotation-config</span>/&gt;</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<table>
<thead>
<tr>
<th></th>
<th>基于XML配置</th>
<th>基于注解配置</th>
</tr>
</thead>
<tbody><tr>
<td>Bean定义</td>
<td><bean id class></bean></td>
<td>@Component，衍生类：@Repository、@Service、@Controller</td>
</tr>
<tr>
<td>Bean名称</td>
<td>通过id或name指定</td>
<td>@Component(“person”)</td>
</tr>
<tr>
<td>Bean注入</td>
<td><property>或者通过p命名空间</property></td>
<td>@Autowired按照类型注入，@Qualifier按照名称注入</td>
</tr>
<tr>
<td>生命过程，Bean作用范围</td>
<td>init-method，destory-method，范围scope属性</td>
<td>@PostConstructa初始化、@PreDestory销毁、@Scope设置作用范围</td>
</tr>
<tr>
<td>适合场景</td>
<td>Bean来自第三方，使用其它</td>
<td>Bean的实现类由用户自己开发</td>
</tr>
</tbody></table>
</blockquote>
</li>
</ol>
<h3 id="2-Spring-AOP"><a href="#2-Spring-AOP" class="headerlink" title="2. Spring AOP"></a>2. Spring AOP</h3><h4 id="2-1-Spring-底层实现原理"><a href="#2-1-Spring-底层实现原理" class="headerlink" title="2.1 Spring 底层实现原理"></a>2.1 Spring 底层实现原理</h4><blockquote>
<p>动态代理</p>
<ul>
<li><p>JDK动态代理（默认，先修改java文件然后再编译成class文件）</p>
<blockquote>
<p>JDK动态代理只能够对接口进行代理，不能对普通的类进行代理（因为所有生成的代理类的父类为Proxy，Java类继承机制不允许多重继承）</p>
<p>JDK动态代理主要涉及java.lang.reflect包下的两个类：Proxy类和InvocationHandler接口。<br>JDK动态代理实现的三个要点：</p>
<ol>
<li>通过java.lang.reflect.Proxy类来动态生成代理类</li>
<li>代理类要实现InvocationHandler接口</li>
<li>JDK动态代理只能基于接口进行动态代理的</li>
</ol>
</blockquote>
</li>
<li><p>Cglib动态代理（运行更快,在内存直接生成子类class文件继承父类重写所有父类方法(不能声明成final)）</p>
<blockquote>
<p>Cglib采用非常底层的字节码技术，可以为一个类创建子类，并在子类中采用方法拦截的技术拦截所有的父类方法的调用，并顺势织入横切逻辑。</p>
</blockquote>
</li>
<li><p>区别</p>
<blockquote>
<p>JDK动态代理是利用反射机制生成一个实现代理接口的匿名类，在调用具体方法前调用InvokeHandler来处理。</p>
<p>而Cglib动态代理是利用asm开源包，对代理对象类的class文件加载进来，通过修改其字节码生成子类来处理。</p>
<ol>
<li><p>如果目标对象实现了接口，默认情况下会采用JDK的动态代理实现AOP</p>
</li>
<li><p>如果目标对象实现了接口，可以强制使用CGLIB实现AOP’</p>
<blockquote>
<p>如何强制使用Cglib：</p>
<ol>
<li>在spring配置文件中加入&lt;aop:aspectj-autoproxy proxy-target-class=“true”/&gt;</li>
<li>EnableAspectJAutoProxy注解参数proxyTargetClass=true使用Cglib</li>
</ol>
</blockquote>
</li>
<li><p>如果目标对象没有实现了接口，必须采用Cglib库，spring会自动在JDK动态代理和Cglib之间转换</p>
</li>
<li><p>JDK动态代理和Cglib字节码生成的区别？<br>（1）JDK动态代理只能对实现了接口的类生成代理，而不能针对类<br>（2）Cglib是针对类实现代理，主要是对指定的类生成一个子类，覆盖其中的方法。   因为是继承，所以该类或方法最好不要声明成final</p>
</li>
</ol>
</blockquote>
</li>
<li><p>性能问题</p>
<blockquote>
<p>由于Cglib代理是利用ASM字节码生成框架在内存中生成一个需要被代理类的子类完成代理，而JDK动态代理是利用反射原理完成动态代理，所以Cglib创建的动态代理对象性能比JDK动态代理动态创建出来的代理对象新能要好的多，但是对象创建的速度比JDK动态代理要慢，所以，当Spring使用的是单例情况下可以选用Cglib代理，反之使用JDK动态代理更加合适。同时还有一个问题，被final修饰的类只能使用JDK动态代理，因为被final修饰的类不能被继承，而Cglib则是利用的继承原理实现代理的。</p>
</blockquote>
</li>
</ul>
</blockquote>
<h4 id="2-2-Spring-AOP相关术语"><a href="#2-2-Spring-AOP相关术语" class="headerlink" title="2.2 Spring AOP相关术语"></a>2.2 Spring AOP相关术语</h4><blockquote>
<ul>
<li><p>Joinpoint(连接点) : </p>
<p>​        所谓连接点是指那些被拦截到的点。在Spring中,这些点指的是方法，因为Spring只支持方法类型的连接点。</p>
</li>
<li><p>Pointcut(切入点) : </p>
<p>​        所谓的切入点是指我们要对哪些Joinpoint进行拦截的定义。</p>
</li>
<li><p>Advice(通知/增强) : </p>
<p>​        所谓通知是指拦截到Joinpoint之后所要做的事情就是通知。</p>
<p>​        通知的类型：前置类型，后置通知，异常通知，环绕通知。</p>
</li>
<li><p>Introduction(引介) : </p>
<p>​        引介是一种特殊的通知在不修改类代码的前提下，Introduction可以在运行期为类动态地添加一些方法或Field。</p>
</li>
<li><p>Target(目标对象) : </p>
<p>​        代理的目标对象。</p>
</li>
<li><p>Weaving(织入) : </p>
<p>​        是指把增强应用到目标对象来创建新的代理对象的过程。</p>
<p>​        Spring采用动态代理织入，而AspectJ采用编译期织入和类装载期织入。</p>
</li>
<li><p>Proxy(代理) : </p>
<p>​        一个类被AOP织入增强，就产生一个结果代理类。</p>
</li>
<li><p>Aspect(切面) : </p>
<p>​        是切入点和通知（引介）的结合。</p>
</li>
</ul>
</blockquote>
<p><img src="https://fangchenyong.oss-cn-hangzhou.aliyuncs.com/img/20190905152719.png" alt="AOP相关术语"></p>
<h4 id="2-3-SpringAOP-的入门开发"><a href="#2-3-SpringAOP-的入门开发" class="headerlink" title="2.3 SpringAOP 的入门开发"></a>2.3 SpringAOP 的入门开发</h4><ol>
<li><p>引入jar包</p>
</li>
<li><p>编写目标类并配置</p>
</li>
<li><p>编写切面类并配置</p>
</li>
<li><p>进行aop配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(表达式"</span> <span class="attr">id</span>=<span class="string">"pc1"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:aspect</span> &gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">""</span> <span class="attr">pointcut-ref</span>=<span class="string">"pc1"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>通知类型</p>
<ul>
<li>前置通知</li>
<li>后置通知</li>
<li>环绕通知</li>
<li>异常抛出通知</li>
<li>最终通知</li>
</ul>
</li>
<li><p>XML配置</p>
</li>
<li><p>基于execution的函数完成</p>
<blockquote>
<p>[访问修饰符] 方法返回值 包名.类名.方法名(参数)</p>
</blockquote>
</li>
</ol>
<h4 id="2-4-基于AspectJ的XML配置"><a href="#2-4-基于AspectJ的XML配置" class="headerlink" title="2.4  基于AspectJ的XML配置"></a>2.4  基于AspectJ的XML配置</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!--前置通知 : 获得切入点信息--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">""</span> <span class="attr">pointcut-ref</span>=<span class="string">"pc1"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--后置通知 : 获得方法的返回值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">""</span> <span class="attr">pointcut-ref</span>=<span class="string">"pc1"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--环绕通知 : 阻止目标方法的执行--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">""</span> <span class="attr">pointcut-ref</span>=<span class="string">"pc1"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--异常抛出通知--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">""</span> <span class="attr">pointcut-ref</span>=<span class="string">"pc1"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--最终通知--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">""</span> <span class="attr">pointcut-ref</span>=<span class="string">"pc1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-5-基于AspectJ的注解配置"><a href="#2-5-基于AspectJ的注解配置" class="headerlink" title="2.5 基于AspectJ的注解配置"></a>2.5 基于AspectJ的注解配置</h4><ol>
<li><p>在配置文件中开启AOP注解开发</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>切面类上使用注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspectj</span></span>&#123;</span><br><span class="line">    <span class="meta">@Before</span>(value=<span class="string">"execution(* com.joey.spring.save(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"前置通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterReturning</span>(value=<span class="string">"execution(* com.joey.spring.save(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"后置通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Around</span>(value=<span class="string">"execution(* com.joey.spring.save(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">around</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"环绕通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterThrowing</span>(value=<span class="string">"execution(* com.joey.spring.save(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"异常抛出通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@After</span>(value=<span class="string">"execution(* com.joey.spring.save(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"最终通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="3-Spring的JDBC模板使用"><a href="#3-Spring的JDBC模板使用" class="headerlink" title="3. Spring的JDBC模板使用"></a>3. Spring的JDBC模板使用</h3><ul>
<li><p>Spring的JDBC模板</p>
<table>
<thead>
<tr>
<th>ORM持久化技术</th>
<th>模板类</th>
</tr>
</thead>
<tbody><tr>
<td>JDBC</td>
<td>org.springframework.jdbc.core.JdbcTemplate</td>
</tr>
<tr>
<td>Hibernate3.0</td>
<td>org.springframework.orm.hibernate3.HeibernateTemplate</td>
</tr>
<tr>
<td>IBatis(Mybatis)</td>
<td>org.springframework.orm.ibatis.SqlMapClientTemplate</td>
</tr>
<tr>
<td>JPA</td>
<td>org.springframework.orm.jpa.JpaTemplate</td>
</tr>
</tbody></table>
</li>
<li><p>JDBC模板使用(例: c3p0)</p>
<ol>
<li><p>引入jar包</p>
</li>
<li><p>配置c3p0连接池</p>
</li>
<li><p>抽取配置到属性文件</p>
</li>
<li><p>在Spring的配置文件中引入属性文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--第一种(常用)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:dbconfig.properties"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--第二种--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"location"</span> <span class="attr">value</span>=<span class="string">"classpath:dbconfig.properties"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>引入属性文件的值 </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"pooledDataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.jdbcUrl&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driverClass&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.user&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
</li>
</ul>
<h3 id="4-Spring-的事务管理"><a href="#4-Spring-的事务管理" class="headerlink" title="4. Spring 的事务管理"></a>4. Spring 的事务管理</h3><h4 id="4-1-事务特性"><a href="#4-1-事务特性" class="headerlink" title="4. 1 事务特性"></a>4. 1 事务特性</h4><ul>
<li>原子性 : 事务不可分割</li>
<li>一致性 : 事务执行前后数据完整性保持一致</li>
<li>隔离性 : 一个事务的执行不应该受到其他事务的干扰</li>
<li>持久性 : 一旦事务结束,数据就持久到数据库</li>
</ul>
<h4 id="4-2-事务隔离级别"><a href="#4-2-事务隔离级别" class="headerlink" title="4.2 事务隔离级别"></a>4.2 事务隔离级别</h4><ul>
<li><p>Read uncommitted ：未提交读，任何读问题解决不了。</p>
</li>
<li><p>Read committed      ：已提交读，解决脏读，但是不可重复读和虚读有可能发生。</p>
</li>
<li><p>Repeatable read      ：重复读，解决脏读和不可重复读，但是虚读有可能发生。</p>
</li>
<li><p>Serializable               ：解决所有读问题。</p>
</li>
</ul>
<h4 id="4-3-事务管理的API"><a href="#4-3-事务管理的API" class="headerlink" title="4.3 事务管理的API"></a>4.3 事务管理的API</h4><ol>
<li><p>PlatformTransactionManager: 平台事务管理器</p>
<blockquote>
<ul>
<li>DataSourceTransactionManager: 底层使用JDBC管理事务</li>
<li>HibernateTransactionManager   : 底层使用Hibernate管理事务</li>
</ul>
</blockquote>
</li>
<li><p>事务定义信息</p>
<blockquote>
<p> 用于定义事务的相关信息</p>
<ul>
<li>隔离级别</li>
<li>超时信息</li>
<li>传播行为</li>
<li>是否只读 </li>
</ul>
</blockquote>
</li>
<li><p>事务的状态</p>
<blockquote>
<p>用于记录在事务管理过程中, 事务的状态的对象</p>
</blockquote>
</li>
</ol>
<h4 id="4-4-Spring事务的传播行为-七种事务"><a href="#4-4-Spring事务的传播行为-七种事务" class="headerlink" title="4.4 Spring事务的传播行为(七种事务)"></a>4.4 Spring事务的传播行为(七种事务)</h4><ol>
<li>保证多个操作在同一个事务中<ul>
<li><strong>PROPAGATION_REQUIRED</strong>     <strong>：默认值，如果A中有事务，使用A中的事务，如果A没有，创建一个新的事务，将操作包含进来</strong></li>
<li><strong>PROPAGATION_SUPPORTS   ：支持事务，如果A中有事务，使用A中的事务。如果A没有事务，不使用事务。</strong></li>
<li><strong>PROPAGATION_MANDATORY：如果A中有事务，使用A中的事务。如果A没有事务，抛出异常。</strong></li>
</ul>
</li>
<li>保证多个操作不在同一个事务中<ul>
<li><strong>PROPAGATION_REQUIRES_NEW   ：如果A中有事务，将A的事务挂起（暂停），创建新事务，只包含自身操作。如果A中没有事务，创建一个新事务，包含自身操作。</strong></li>
<li><strong>PROPAGATION_NOT_SUPPORTED ：如果A中有事务，将A的事务挂起。不使用事务管理。</strong></li>
<li><strong>PROPAGATION_NEVER：如果A中有事务，报异常。</strong></li>
</ul>
</li>
<li>嵌套式事务<ul>
<li><strong>PROPAGATION_NESTED：嵌套事务，如果A中有事务，按照A的事务执行，执行完成后，设置一个保存点，执行B中的操作，如果没有异常，执行通过，如果有异常，可以选择回滚到最初始位置，也可以回滚到保存点。</strong></li>
</ul>
</li>
</ol>
<h4 id="4-5-Spring事务管理"><a href="#4-5-Spring事务管理" class="headerlink" title="4.5 Spring事务管理"></a>4.5 Spring事务管理</h4><ol>
<li><p>编程式事务(需手动编写代码)</p>
<ol>
<li>配置平台事务管理器</li>
<li>配置事务管理的模板类</li>
<li>在业务层注入事务管理的模板</li>
<li>编写事务管理的代码</li>
</ol>
</li>
<li><p>声明式事务管理(XML方式)</p>
<ol>
<li><p>配置事务管理器</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--控制住数据源  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"pooledDataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置增强</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 所有方法都是事务方法 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"*"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--以get开始的所有方法  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"get*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>AOP配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 切入点表达式 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.joey.service..*(..))"</span> <span class="attr">id</span>=<span class="string">"txPoint"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置事务增强 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"txPoint"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>声明式事务管理(注解方式)</p>
<ol>
<li><p>配置事务管理器</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置事务增强，事务如何切入  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 所有方法都是事务方法 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"*"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--以get开始的所有方法  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"get*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>开启注解事务</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transationManager"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在业务层添加注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImple</span> <span class="keyword">implements</span> <span class="title">UserService</span></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fangchenyong.top/2019/09/02/框架-Spring/" data-id="ckmh9z47v007oroum5b34jem2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/">Spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-项目-基于Netty+WebSocket简易版微信" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/23/项目-基于Netty+WebSocket简易版微信/" class="article-date">
  <time datetime="2019-08-23T14:12:23.000Z" itemprop="datePublished">2019-08-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>►<a class="article-category-link" href="/categories/Java/SpringBoot/">SpringBoot</a>►<a class="article-category-link" href="/categories/Java/SpringBoot/netty/">netty</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/23/项目-基于Netty+WebSocket简易版微信/">基于Netty+WebSocket简易版微信</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="基于Netty-WebSocket简易版微信-慕课网"><a href="#基于Netty-WebSocket简易版微信-慕课网" class="headerlink" title="基于Netty+WebSocket简易版微信-慕课网"></a>基于Netty+WebSocket简易版微信-慕课网</h1><h3 id="1-技术栈"><a href="#1-技术栈" class="headerlink" title="1. 技术栈"></a>1. 技术栈</h3><p><strong>前端：MUI 、H5PLUS</strong></p>
<p><strong>后端：SpringBoot 、Netty、WebSocket、Mysql、FastDFS、Nginx、Mybatis</strong></p>
<h3 id="2-数据库建表"><a href="#2-数据库建表" class="headerlink" title="2. 数据库建表"></a>2. 数据库建表</h3><h4 id="表：users"><a href="#表：users" class="headerlink" title="表：users"></a>表：users</h4><table>
<thead>
<tr>
<th>表名</th>
<th align="left">users</th>
<th>表名中文</th>
<th>用户表</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>No</td>
<td align="left">列名</td>
<td>列名中文</td>
<td>类型</td>
<td>长度</td>
<td>Key</td>
<td>Null</td>
<td>默认值</td>
<td>备注</td>
</tr>
<tr>
<td>1</td>
<td align="left">id</td>
<td>主键</td>
<td>varchar</td>
<td>64</td>
<td>Y</td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td align="left">username</td>
<td>名称</td>
<td>varchar</td>
<td>20</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>3</td>
<td align="left">password</td>
<td>密码</td>
<td>varchar</td>
<td>64</td>
<td></td>
<td>M</td>
<td></td>
<td></td>
</tr>
<tr>
<td>4</td>
<td align="left">face_image</td>
<td>头像</td>
<td>varchar</td>
<td>255</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>5</td>
<td align="left">face_image_big</td>
<td>大头像</td>
<td>varchar</td>
<td>255</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>6</td>
<td align="left">nickname</td>
<td>昵称</td>
<td>varchar</td>
<td>20</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>7</td>
<td align="left">qrcode</td>
<td>二维码</td>
<td>varchar</td>
<td>255</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>8</td>
<td align="left">cid</td>
<td>设备ID</td>
<td>varchar</td>
<td>64</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="表：friends-request"><a href="#表：friends-request" class="headerlink" title="表：friends_request"></a>表：friends_request</h4><table>
<thead>
<tr>
<th>表名</th>
<th>friends_request</th>
<th>表名中文</th>
<th>用户请求表</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>No</td>
<td>列名</td>
<td>列名中文</td>
<td>类型</td>
<td>长度</td>
<td>Key</td>
<td>Null</td>
<td>默认值</td>
<td>备注</td>
</tr>
<tr>
<td>1</td>
<td>id</td>
<td>主键</td>
<td>varchar</td>
<td>64</td>
<td>Y</td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>send_user_id</td>
<td>发送者ID</td>
<td>varchar</td>
<td>64</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>accept_user_id</td>
<td>接收者ID</td>
<td>varchar</td>
<td>64</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>request_date_time</td>
<td>接收时间</td>
<td>datetime</td>
<td>0</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="表：my-friends"><a href="#表：my-friends" class="headerlink" title="表：my_friends"></a>表：my_friends</h4><table>
<thead>
<tr>
<th>表名</th>
<th>my_friends</th>
<th>表名中文</th>
<th>好友中间表</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>No</td>
<td>列名</td>
<td>列名中文</td>
<td>类型</td>
<td>长度</td>
<td>Key</td>
<td>Null</td>
<td>默认值</td>
<td>备注</td>
</tr>
<tr>
<td>1</td>
<td>id</td>
<td>主键</td>
<td>varchar</td>
<td>64</td>
<td>Y</td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>my_user_id</td>
<td>我的ID</td>
<td>varchar</td>
<td>64</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>my_friend_user_id</td>
<td>好友的ID</td>
<td>varchar</td>
<td>64</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="表：chat-msg"><a href="#表：chat-msg" class="headerlink" title="表：chat_msg"></a>表：chat_msg</h4><table>
<thead>
<tr>
<th>表名</th>
<th>chat_msg</th>
<th>表名中文</th>
<th>好友中间表</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>No</td>
<td>列名</td>
<td>列名中文</td>
<td>类型</td>
<td>长度</td>
<td>Key</td>
<td>Null</td>
<td>默认值</td>
<td>备注</td>
</tr>
<tr>
<td>1</td>
<td>id</td>
<td>主键</td>
<td>varchar</td>
<td>64</td>
<td>Y</td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>send_user_id</td>
<td>我的ID</td>
<td>varchar</td>
<td>64</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>accept_user_id</td>
<td>好友的ID</td>
<td>varchar</td>
<td>64</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>msg</td>
<td>消息</td>
<td>varchar</td>
<td>255</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>sign_flag</td>
<td>已读未读</td>
<td>int</td>
<td>1</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>6</td>
<td>create_time</td>
<td>发送时间</td>
<td>datetime</td>
<td>0</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">TABLE</span> <span class="keyword">user</span>(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">varchar</span>(<span class="number">64</span>)  <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'主键'</span>,</span><br><span class="line">	username <span class="built_in">varchar</span>(<span class="number">20</span>)  <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'名称'</span>,</span><br><span class="line">	<span class="keyword">password</span> <span class="built_in">varchar</span>(<span class="number">64</span>)  <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'密码'</span>,</span><br><span class="line">	face_image <span class="built_in">varchar</span>(<span class="number">255</span>)  <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'头像'</span>,</span><br><span class="line">	face_image_big  <span class="built_in">varchar</span>(<span class="number">255</span>)  <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'大头像'</span>,</span><br><span class="line">	nickname <span class="built_in">varchar</span>(<span class="number">20</span>)  <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'昵称'</span>,</span><br><span class="line">	qrcode <span class="built_in">varchar</span>(<span class="number">255</span>)  <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'二维码'</span>,</span><br><span class="line">	cid <span class="built_in">VARCHAR</span>(<span class="number">64</span>)  <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'设备ID'</span>,</span><br><span class="line">	PRIMARY <span class="keyword">KEY</span>(<span class="keyword">id</span>)</span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">TABLE</span> friends_request(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">varchar</span>(<span class="number">64</span>)  <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'主键'</span>,</span><br><span class="line">	send_user_id <span class="built_in">varchar</span>(<span class="number">64</span>)  <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'发送者ID'</span>,</span><br><span class="line">	accept_user_id <span class="built_in">varchar</span>(<span class="number">64</span>)  <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'接收者ID'</span>,</span><br><span class="line">	request_date_time datetime  <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'接收时间'</span>,</span><br><span class="line">	PRIMARY <span class="keyword">KEY</span>(<span class="keyword">id</span>)</span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">TABLE</span> my_friends(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">varchar</span>(<span class="number">64</span>)  <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'主键'</span>,</span><br><span class="line">	my_user_id <span class="built_in">varchar</span>(<span class="number">64</span>)  <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'我的ID'</span>,</span><br><span class="line">	my_friend_user_id <span class="built_in">varchar</span>(<span class="number">64</span>)  <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'好友的ID'</span>,</span><br><span class="line">	PRIMARY <span class="keyword">KEY</span>(<span class="keyword">id</span>)</span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">TABLE</span> chat_msg(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">varchar</span>(<span class="number">64</span>)  <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'主键'</span>,</span><br><span class="line">	send_user_id <span class="built_in">varchar</span>(<span class="number">64</span>)  <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'我的ID'</span>,</span><br><span class="line">	accept_user_id <span class="built_in">varchar</span>(<span class="number">64</span>)  <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'好友的ID'</span>,</span><br><span class="line">	msg <span class="built_in">varchar</span>(<span class="number">255</span>)   <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'消息'</span>,</span><br><span class="line">    sign_flag <span class="built_in">int</span> <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'已读未读'</span>,</span><br><span class="line">    create_time datetime  <span class="literal">null</span> <span class="keyword">COMMENT</span> <span class="string">'发送时间'</span>,</span><br><span class="line">	PRIMARY <span class="keyword">KEY</span>(<span class="keyword">id</span>)</span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>

<h3 id="问题解决记录"><a href="#问题解决记录" class="headerlink" title="问题解决记录"></a>问题解决记录</h3><ul>
<li><a href="https://fangchenyong.top/2019/08/14/install_FastDFS+Nginx/">安装fastDFS+nginx实现文件存储服务器</a></li>
<li><a href="https://blog.csdn.net/svneclipse/article/details/80719480" target="_blank" rel="noopener">The type org.springframework.context.ConfigurableApplicationContext cannot be resolved.</a></li>
<li><a href="https://www.iteye.com/blog/1615714" target="_blank" rel="noopener">Spring配置事务的传播行为（PROPAGATION)和隔离级别(Isolation)（终于懂了）</a></li>
<li><a href="https://ask.dcloud.net.cn/question/8161" target="_blank" rel="noopener">mui.ajax() abort</a></li>
<li><a href="https://blog.csdn.net/bmw601055/article/details/77414855" target="_blank" rel="noopener">Uncaught SyntaxError: Unexpected token o</a> </li>
</ul>
<p><em>注：安装测试需要更改application.properties中fastdfs配置以及数据库连接，修改前端app.js配置以及后端新增用户产生二维码的文件目录和文件上传目录</em></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fangchenyong.top/2019/08/23/项目-基于Netty+WebSocket简易版微信/" data-id="ckmh9z4580018roumos4zbryj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SpringBoot/">SpringBoot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/netty/">netty</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Java-源码-JDK8-Object" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/23/Java-源码-JDK8-Object/" class="article-date">
  <time datetime="2019-08-22T16:00:00.000Z" itemprop="datePublished">2019-08-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>►<a class="article-category-link" href="/categories/Java/源码/">源码</a>►<a class="article-category-link" href="/categories/Java/源码/Object/">Object</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/23/Java-源码-JDK8-Object/">JDK8 Object源码</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h1 id="JDK8-Object"><a href="#JDK8-Object" class="headerlink" title="JDK8 Object"></a>JDK8 Object</h1><h2 id="1-简述"><a href="#1-简述" class="headerlink" title="1.简述"></a>1.简述</h2><p>Java对象被设计成单继承，所有的对象都直接或者间接的继承Object类，拥有Object的一些属性和方法。所以Object也可以理解为所有类的父类。</p>
<h2 id="2-方法汇总"><a href="#2-方法汇总" class="headerlink" title="2.方法汇总"></a>2.方法汇总</h2><table>
<thead>
<tr>
<th>Modifier and Type</th>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>protected Object</td>
<td>clone()</td>
<td>Creates and returns a copy of this object.</td>
</tr>
<tr>
<td>boolean</td>
<td>equals(Object obj)</td>
<td>Indicates whether some other object is “equal to” this one.</td>
</tr>
<tr>
<td>protected void</td>
<td>finalize()</td>
<td>Called by the garbage collector on an object when garbage collection determines that there are no more references to the object.</td>
</tr>
<tr>
<td>Class&lt;?&gt;</td>
<td>getClass()</td>
<td>Returns the runtime class of this Object.</td>
</tr>
<tr>
<td>int</td>
<td>hashCode()</td>
<td>Returns a hash code value for the object.</td>
</tr>
<tr>
<td>String</td>
<td>toString()</td>
<td>Returns a string representation of the object.</td>
</tr>
<tr>
<td>void</td>
<td>notify()</td>
<td>Wakes up a single thread that is waiting on this object’s monitor.</td>
</tr>
<tr>
<td>void</td>
<td>notifyAll()</td>
<td>Wakes up all threads that are waiting on this object’s monitor.</td>
</tr>
<tr>
<td>void</td>
<td>wait()</td>
<td>Causes the current thread to wait until another thread invokes the notify() method or the notifyAll() method for this object.</td>
</tr>
<tr>
<td>void</td>
<td>wait(long timeout)</td>
<td>Causes the current thread to wait until either another thread invokes the notify() method or the notifyAll() method for this object, or a specified amount of time has elapsed.</td>
</tr>
<tr>
<td>void</td>
<td>wait(long timeout, int nanos)</td>
<td>Causes the current thread to wait until another thread invokes the notify() method or the notifyAll() method for this object, or some other thread interrupts the current thread, or a certain amount of real time has elapsed.</td>
</tr>
</tbody></table>
<h2 id="3-方法详细信息"><a href="#3-方法详细信息" class="headerlink" title="3.方法详细信息"></a>3.方法详细信息</h2><ol>
<li><p>Clone()</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建并返回此对象的副本。</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException</span></span><br></pre></td></tr></table></figure>

<p> 如何实现拷贝，到底是浅拷贝？还是深拷贝？</p>
<ol>
<li><p>要想重写clone方法，需要实现Cloneable接口</p>
</li>
<li><p>通过super.clone()获取Objec.clone()方法返回的拷贝对象</p>
</li>
<li><p>如果你想要实现深拷贝，你需要在对象返回前进行修改</p>
<blockquote>
<p>情况一：创建一个Person类，实现Cloneable接口，重写clone方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&gt; <span class="keyword">package</span> com.joey.object;</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</span><br><span class="line">&gt;     <span class="keyword">int</span> age;</span><br><span class="line">&gt;     String name;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(<span class="keyword">int</span> age, String name)</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">this</span>.age = age;</span><br><span class="line">&gt;         <span class="keyword">this</span>.name = name;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="meta">@Override</span></span><br><span class="line">&gt;     <span class="function"><span class="keyword">protected</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">return</span> <span class="keyword">super</span>.clone();</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">return</span> age;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">this</span>.age = age;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">return</span> name;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">this</span>.name = name;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="comment">//不重写toString()方法，为了看哈希值是否一致</span></span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> String <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">return</span> <span class="string">"年龄："</span> + <span class="keyword">this</span>.age + <span class="string">",姓名："</span> + <span class="keyword">this</span>.name;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="class"><span class="keyword">class</span> <span class="title">ObjectTest</span></span>&#123;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">&gt;         Person person = <span class="keyword">new</span> Person(<span class="number">18</span>,<span class="string">"joey"</span>);</span><br><span class="line">&gt;         <span class="comment">//深拷贝一个对象</span></span><br><span class="line">&gt;         Person person1 = (Person)person.clone();</span><br><span class="line">&gt;         <span class="comment">//输出对象的哈希地址值</span></span><br><span class="line">&gt;         System.out.println(person);</span><br><span class="line">&gt;         System.out.println(person1);</span><br><span class="line">&gt;         <span class="comment">//输出对象的内容</span></span><br><span class="line">&gt;         System.out.println(person.show());</span><br><span class="line">&gt;         System.out.println(person1.show());</span><br><span class="line">&gt;         <span class="comment">//修改复制的对象</span></span><br><span class="line">&gt;         person1.setAge(<span class="number">24</span>);</span><br><span class="line">&gt;         person1.setName(<span class="string">"方陈勇"</span>);</span><br><span class="line">&gt;         <span class="comment">//输出判断是否会修改person的值，其实地址值不一样就已经很清楚了</span></span><br><span class="line">&gt;         System.out.println(person.show());</span><br><span class="line">&gt;         System.out.println(person1.show());</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; <span class="comment">/*输出结果：</span></span><br><span class="line"><span class="comment">&gt; com.joey.object.Person@1b6d3586</span></span><br><span class="line"><span class="comment">&gt; com.joey.object.Person@4554617c</span></span><br><span class="line"><span class="comment">&gt; 年龄：18,姓名：joey</span></span><br><span class="line"><span class="comment">&gt; 年龄：18,姓名：joey</span></span><br><span class="line"><span class="comment">&gt; 年龄：18,姓名：joey</span></span><br><span class="line"><span class="comment">&gt; 年龄：24,姓名：方陈勇</span></span><br><span class="line"><span class="comment">&gt; */</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><strong>结论一：单纯看地址值能够判断两个是不同的对象，属于深拷贝，并且修改person1的值不会影响person的值。</strong></p>
<p>情况二：创建一个Address类，重写toString()方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&gt; <span class="keyword">package</span> com.joey.object;</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span></span>&#123;</span><br><span class="line">&gt;     String location;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> <span class="title">Address</span><span class="params">(String location)</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">this</span>.location = location;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> String <span class="title">getLocation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">return</span> location;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocation</span><span class="params">(String location)</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">this</span>.location = location;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="meta">@Override</span></span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">return</span> <span class="string">"Address&#123;"</span> +</span><br><span class="line">&gt;                 <span class="string">"location='"</span> + location + <span class="string">'\''</span> +</span><br><span class="line">&gt;                 <span class="string">'&#125;'</span>;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>Person类做一下修改</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&gt; <span class="keyword">package</span> com.joey.object;</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</span><br><span class="line">&gt;     <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">&gt;     <span class="keyword">private</span> String name;</span><br><span class="line">&gt;     <span class="keyword">private</span> Address address;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(<span class="keyword">int</span> age, String name,Address address)</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">this</span>.age = age;</span><br><span class="line">&gt;         <span class="keyword">this</span>.name = name;</span><br><span class="line">&gt;         <span class="keyword">this</span>.address= address;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="meta">@Override</span></span><br><span class="line">&gt;     <span class="function"><span class="keyword">protected</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">return</span> <span class="keyword">super</span>.clone();</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt;    </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">return</span> age;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">this</span>.age = age;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">return</span> name;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">this</span>.name = name;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> Address <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">return</span> address;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(Address address)</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">this</span>.address = address;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="comment">//不重写toString()方法，为了看地址值是否一致</span></span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> String <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">return</span> <span class="string">"年龄："</span> + <span class="keyword">this</span>.age + <span class="string">",姓名："</span> + <span class="keyword">this</span>.name +<span class="string">",地址："</span> +<span class="keyword">this</span>.address;</span><br><span class="line">&gt;  &#125;</span><br><span class="line">&gt;    &#125;</span><br><span class="line">&gt;    </span><br><span class="line">&gt;    <span class="class"><span class="keyword">class</span> <span class="title">ObjectTest</span></span>&#123;</span><br><span class="line">&gt;    </span><br><span class="line">&gt;  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">&gt;      Person person = <span class="keyword">new</span> Person(<span class="number">18</span>,<span class="string">"joey"</span>,<span class="keyword">new</span> Address(<span class="string">"杭州西湖"</span>));</span><br><span class="line">&gt;      <span class="comment">//拷贝一个对象</span></span><br><span class="line">&gt;      Person person1 = (Person)person.clone();</span><br><span class="line">&gt;         <span class="comment">//输出对象的哈希地址值</span></span><br><span class="line">&gt;         System.out.println(person);</span><br><span class="line">&gt;         System.out.println(person1);</span><br><span class="line">&gt;         <span class="comment">//输出对象的内容</span></span><br><span class="line">&gt;         System.out.println(<span class="string">"**********************复制后************************"</span>);</span><br><span class="line">&gt;         System.out.println(person.show());</span><br><span class="line">&gt;         System.out.println(person1.show());</span><br><span class="line">&gt;    </span><br><span class="line">&gt;         <span class="comment">//修改复制的对象</span></span><br><span class="line">&gt;         System.out.println(<span class="string">"*****************修改person1中的age和name*************"</span>);</span><br><span class="line">&gt;         person1.setAge(<span class="number">24</span>);</span><br><span class="line">&gt;      person1.setName(<span class="string">"方陈勇"</span>);</span><br><span class="line">&gt;         <span class="comment">//输出判断</span></span><br><span class="line">&gt;         System.out.println(person.show());</span><br><span class="line">&gt;         System.out.println(person1.show());</span><br><span class="line">&gt;    </span><br><span class="line">&gt;         <span class="comment">//修改复制的对象</span></span><br><span class="line">&gt;         System.out.println(<span class="string">"*****************修改person1中的age和name*************"</span>);</span><br><span class="line">&gt;         Address address = person1.getAddress();</span><br><span class="line">&gt;      address.setLocation(<span class="string">"杭州滨江"</span>);</span><br><span class="line">&gt;         <span class="comment">//输出判断</span></span><br><span class="line">&gt;         System.out.println(person.show());</span><br><span class="line">&gt;         System.out.println(person1.show());</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt;    &#125;</span><br><span class="line">&gt;    <span class="comment">/*输出结果：</span></span><br><span class="line"><span class="comment">&gt;    com.joey.object.Person@1b6d3586</span></span><br><span class="line"><span class="comment">&gt;    com.joey.object.Person@4554617c</span></span><br><span class="line"><span class="comment">&gt; **********************复制后************************</span></span><br><span class="line"><span class="comment">&gt; 年龄：18,姓名：joey,地址：Address&#123;location='杭州西湖'&#125;</span></span><br><span class="line"><span class="comment">&gt; 年龄：18,姓名：joey,地址：Address&#123;location='杭州西湖'&#125;</span></span><br><span class="line"><span class="comment">&gt; *****************修改person1中的age和name*************</span></span><br><span class="line"><span class="comment">&gt; 年龄：18,姓名：joey,地址：Address&#123;location='杭州西湖'&#125;</span></span><br><span class="line"><span class="comment">&gt; 年龄：24,姓名：方陈勇,地址：Address&#123;location='杭州西湖'&#125;</span></span><br><span class="line"><span class="comment">&gt; *****************修改person1中的age和name*************</span></span><br><span class="line"><span class="comment">&gt; 年龄：18,姓名：joey,地址：Address&#123;location='杭州滨江'&#125;</span></span><br><span class="line"><span class="comment">&gt; 年龄：24,姓名：方陈勇,地址：Address&#123;location='杭州滨江'&#125;</span></span><br><span class="line"><span class="comment">&gt; */</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><strong>结论二：person1只修改age和name时发现不会影响person的值，但是修改address对象的值时就会有影响。是因为Address类没有重写Clone()方法，person和person1指向的都是同一个Address对象</strong></p>
<p>情况三：那么如何实现深拷贝。修改Address类实现Cloneable接口，重写clone()方法，在Person类中重写Clone()方法的时候调用Address重写后的clone()方法，即同时克隆Person类和Address类。</p>
<p>修改Address类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&gt;<span class="keyword">package</span> com.joey.object;</span><br><span class="line">&gt; </span><br><span class="line">&gt;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> <span class="keyword">implements</span> <span class="title">Cloneable</span></span>&#123;</span><br><span class="line">&gt;  String location;</span><br><span class="line">&gt; </span><br><span class="line">&gt;  <span class="meta">@Override</span></span><br><span class="line">&gt;  <span class="function"><span class="keyword">protected</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">return</span> <span class="keyword">super</span>.clone();</span><br><span class="line">&gt;  &#125;</span><br><span class="line">&gt;    </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> <span class="title">Address</span><span class="params">(String location)</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">this</span>.location = location;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> String <span class="title">getLocation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">return</span> location;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocation</span><span class="params">(String location)</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">this</span>.location = location;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="meta">@Override</span></span><br><span class="line">&gt;     <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">return</span> <span class="string">"Address&#123;"</span> +</span><br><span class="line">&gt;              <span class="string">"location='"</span> + location + <span class="string">'\''</span> +</span><br><span class="line">&gt;                 <span class="string">'&#125;'</span>;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt;    &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>   修改Person类中重写的Clone()方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&gt;<span class="meta">@Override</span></span><br><span class="line">&gt; <span class="function"><span class="keyword">protected</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">&gt; <span class="comment">//深拷贝</span></span><br><span class="line">&gt;  Person person = (Person)<span class="keyword">super</span>.clone();</span><br><span class="line">&gt;  person.address = (Address) <span class="keyword">this</span>.address.clone();</span><br><span class="line">&gt;  <span class="keyword">return</span> person;</span><br><span class="line">&gt;     <span class="comment">//return super.clone();</span></span><br><span class="line">&gt;    &#125;</span><br><span class="line">&gt;    </span><br><span class="line">&gt;    <span class="comment">/*输出结果：</span></span><br><span class="line"><span class="comment">&gt;    com.joey.object.Person@1b6d3586</span></span><br><span class="line"><span class="comment">&gt; com.joey.object.Person@4554617c</span></span><br><span class="line"><span class="comment">&gt; **********************复制后************************</span></span><br><span class="line"><span class="comment">&gt; 年龄：18,姓名：joey,地址：Address&#123;location='杭州西湖'&#125;</span></span><br><span class="line"><span class="comment">&gt; 年龄：18,姓名：joey,地址：Address&#123;location='杭州西湖'&#125;</span></span><br><span class="line"><span class="comment">&gt; *****************修改person1中的age和name*************</span></span><br><span class="line"><span class="comment">&gt; 年龄：18,姓名：joey,地址：Address&#123;location='杭州西湖'&#125;</span></span><br><span class="line"><span class="comment">&gt; 年龄：24,姓名：方陈勇,地址：Address&#123;location='杭州西湖'&#125;</span></span><br><span class="line"><span class="comment">&gt; *****************修改person1中的age和name*************</span></span><br><span class="line"><span class="comment">&gt; 年龄：18,姓名：joey,地址：Address&#123;location='杭州西湖'&#125;</span></span><br><span class="line"><span class="comment">&gt; 年龄：24,姓名：方陈勇,地址：Address&#123;location='杭州滨江'&#125;</span></span><br><span class="line"><span class="comment">&gt; */</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><strong>结论三：可以看到最后person的address内容也没有改变。也就是说，当一个类里有很多引用类型时，如果想实现深拷贝那就得将每个引用类型都实现Cloneable接口重写一下clone()方法，比较麻烦的。可能好奇为什么String为什么没有影响，因为String是不可变的，相当于重新new了一个String。</strong></p>
<p><strong>所以，对于很多引用类型，可以使用序列化对象的方式进行深拷贝。</strong></p>
</blockquote>
</li>
</ol>
</li>
<li><p>equals(Object obj)</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//直接判断的是引用，若想判断内容是否相同，需要重写此方法。</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span></span></span><br></pre></td></tr></table></figure>

<p> 常见问题：equals()和==的比较</p>
<ul>
<li><p>equals()用于引用类型的比较，如果引用类型没有重写equals()方法，调用的就是Object类中的equals()，比较的是地址值。</p>
</li>
<li><p>==用于在基本数据类型和引用数据类型的比较。如果是基本数据类型，比较的是内容，如果是引用数据类型，那比较的就是地址值。</p>
<p>哪些类重写了equals()方法</p>
</li>
<li><p>String</p>
</li>
<li><p>Date</p>
</li>
<li><p>File</p>
</li>
<li><p>包装类</p>
</li>
<li><p>…</p>
<p>如何重写equals方法</p>
<blockquote>
<p>equals()方法里面提到了四个原则：</p>
<ol>
<li>自反性reflexive，a.equals(a) == true</li>
<li>对称性symmetric，a.equals(b) == b.equals(a)</li>
<li>传递性transitive，当a.equals(b) == true且b.equals(c) == true时，a.equals(c) == true</li>
<li>一致性consistent，当equals实现不变时，a.equals(b)返回值永远不变</li>
</ol>
<p>例如String中的equals()，重写判断的是内容相等，hashCode()方法也重写了</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&gt; <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object anObject)</span> </span>&#123;</span><br><span class="line">&gt;     <span class="keyword">if</span> (<span class="keyword">this</span> == anObject) &#123;</span><br><span class="line">&gt;         <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt;     <span class="keyword">if</span> (anObject <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">&gt;         String anotherString = (String)anObject;</span><br><span class="line">&gt;         <span class="keyword">int</span> n = value.length;</span><br><span class="line">&gt;         <span class="keyword">if</span> (n == anotherString.value.length) &#123;</span><br><span class="line">&gt;             <span class="keyword">char</span> v1[] = value;</span><br><span class="line">&gt;             <span class="keyword">char</span> v2[] = anotherString.value;</span><br><span class="line">&gt;             <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">&gt;             <span class="keyword">while</span> (n-- != <span class="number">0</span>) &#123;</span><br><span class="line">&gt;                 <span class="keyword">if</span> (v1[i] != v2[i])</span><br><span class="line">&gt;                     <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&gt;                 i++;</span><br><span class="line">&gt;             &#125;</span><br><span class="line">&gt;             <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&gt;         &#125;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt;     <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<p> <strong>注意：重写equals()方法，需要重写hashCode()</strong></p>
</li>
<li><p>finalize()</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//该方法用于释放资源。因为无法确定该方法什么时候被调用，很少使用。</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>finalize的原理</p>
<p>（1）对象在初始化的过程中会判断是否重写了finalize，方法是判断两个字段标志has_finalizer_flag和RegisterFinalizersAtInit。</p>
<p>（2）如果重写了finalize，那就把当前对象注册到FinalizerThread的ReferenceQueue队列中。注册之后的对象就叫做Finalizer。方法是调用register_finalizer函数。此时java虚拟机一看当前有这个对象的引用，于是就不进行垃圾回收了。</p>
<p>（3）对象开始被调用，FinalizerThread线程负责从ReferenceQueue队列中获取Finalizer对象。开始执行finalize方法，在执行之前，这个对象一直在堆中。</p>
<p>（4）对象执行完毕之后，将这个Finalizer对象从队列中移除，java虚拟机一看对象没有引用了，就进行垃圾回收了。</p>
<p>这就是整个过程。不过在这里我们主要看的是finalize方法对垃圾回收的影响，其实就是在第三步，也就是这个对象含有finalize，进入了队列但一直没有被调用的这段时间，会一直占用内存。</p>
</blockquote>
<p> <strong>注意：应该避免使用finalize()方法，可能会导致内存溢出。</strong></p>
</li>
<li><p>getClass()</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//返回此Object运行时类类型，final修饰不可重写，一般和getName()联合使用，如getName().getClass().</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> Class&lt;?&gt; getClass();</span><br></pre></td></tr></table></figure>

<p> getClass()返回调用对象的包名+类名，jvm可以根据这个唯一定位一个类</p>
</li>
<li><p>hashCode()</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//返回对象的哈希码值。</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p> 这里存在一种情况，重写了equals()方法没有重写，两个对象的内容确实相等了。但是，地址值还是不一样。</p>
<p> 比如String类中，String a = “a”;String b = new String(“a”); a在字符串常量池中，b在堆中，地址值不一样。比如在使用集合Set或者其他一些需要唯一性判断的地方，内容相等其实就是相等，但是有两个地址值，可能会造成重复。</p>
<p> 所以说重写equals()方法同时也要注意重写hashCode()方法</p>
</li>
<li><p>toString()</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//返回了Object对象的全限定类名+@+16进制表示的物理地址，它建议所有的子类都重写该方法，以致于可以打印出关键信息</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>notify()</p>
</li>
<li><p>notifyAll()</p>
</li>
<li><p>wait()</p>
</li>
<li><p>wait(long timeout)</p>
</li>
<li><p>wait(long timeout, int nanos)</p>
</li>
</ol>
<p>到线程再看这几个……</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fangchenyong.top/2019/08/23/Java-源码-JDK8-Object/" data-id="ckmh9z47s007lroumjjk4p7gw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Object/">Object</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/源码/">源码</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Linux-install_FastDFS+Nginx" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/14/Linux-install_FastDFS+Nginx/" class="article-date">
  <time datetime="2019-08-13T16:00:00.000Z" itemprop="datePublished">2019-08-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>►<a class="article-category-link" href="/categories/Linux/CentOS/">CentOS</a>►<a class="article-category-link" href="/categories/Linux/CentOS/FastDFS/">FastDFS</a>►<a class="article-category-link" href="/categories/Linux/CentOS/FastDFS/nginx/">nginx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/14/Linux-install_FastDFS+Nginx/">CentOS7 安装FastDFS+nginx</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="CentOS7-安装FastDFS-nginx"><a href="#CentOS7-安装FastDFS-nginx" class="headerlink" title="CentOS7 安装FastDFS+nginx"></a>CentOS7 安装FastDFS+nginx</h2><h4 id="1-先查看有没有安装gcc，FastDFS是C语言开发，编译依赖gcc环境"><a href="#1-先查看有没有安装gcc，FastDFS是C语言开发，编译依赖gcc环境" class="headerlink" title="1.  先查看有没有安装gcc，FastDFS是C语言开发，编译依赖gcc环境"></a>1.  先查看有没有安装gcc，FastDFS是C语言开发，编译依赖gcc环境</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# gcc -v</span><br><span class="line">bash: gcc: 未找到命令...</span><br><span class="line"><span class="meta">#</span>安装gcc、libevent、perl</span><br><span class="line">[root@root ~]# yum install gcc-c++</span><br><span class="line">[root@root ~]# yum -y install libevent</span><br><span class="line">[root@root ~]# yum install perl</span><br></pre></td></tr></table></figure>

<h4 id="2-解压libfastcommon"><a href="#2-解压libfastcommon" class="headerlink" title="2.  解压libfastcommon"></a>2.  解压libfastcommon</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root opt]# cd fastDFS/</span><br><span class="line">[root@root fastDFS]# ls</span><br><span class="line">fastdfs-nginx-module_v1.16.tar.gz  FastDFS_v5.05.tar.gz  libfastcommonV1.0.7.tar.gz</span><br><span class="line"><span class="meta">#</span>解压libfastcommon</span><br><span class="line">[root@root fastDFS]# tar -zxvf libfastcommonV1.0.7.tar.gz </span><br><span class="line">[root@root fastDFS]# cd libfastcommon-1.0.7/</span><br><span class="line">[root@root libfastcommon-1.0.7]# ls</span><br><span class="line">HISTORY  INSTALL  libfastcommon.spec  make.sh  README  src</span><br><span class="line"><span class="meta">#</span>编译</span><br><span class="line">[root@root libfastcommon-1.0.7]# ./make.sh </span><br><span class="line"><span class="meta">#</span>安装</span><br><span class="line">[root@root libfastcommon-1.0.7]# ./make.sh install</span><br><span class="line">mkdir -p /usr/lib64</span><br><span class="line">install -m 755 libfastcommon.so /usr/lib64</span><br><span class="line">mkdir -p /usr/include/fastcommon</span><br><span class="line">install -m 644 common_define.h hash.h chain.h logger.h base64.h shared_func.h pthread_func.h ini_file_reader.h _os_bits.h sockopt.h sched_thread.h http_func.h md5.h local_ip_func.h avl_tree.h ioevent.h ioevent_loop.h fast_task_queue.h fast_timer.h process_ctrl.h fast_mblock.h connection_pool.h /usr/include/fastcommon</span><br><span class="line">[root@root lib64]# cd /usr/lib64</span><br><span class="line">[root@root lib64]# ls libfastcommon.*</span><br><span class="line">libfastcommon.so</span><br><span class="line"><span class="meta">#</span>拷贝到32位环境中</span><br><span class="line">[root@root lib64]# cp libfastcommon.so /usr/lib</span><br><span class="line">[root@root lib64]# cd /usr/lib</span><br><span class="line">[root@root lib]# ls libfastcommon.*</span><br><span class="line">libfastcommon.so</span><br></pre></td></tr></table></figure>

<h4 id="3-安装FastDFS"><a href="#3-安装FastDFS" class="headerlink" title="3.安装FastDFS"></a>3.安装FastDFS</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>解压</span><br><span class="line">[root@root fastDFS]# tar -zxvf FastDFS_v5.05.tar.gz </span><br><span class="line">[root@root fastDFS]# cd FastDFS/</span><br><span class="line">[root@root FastDFS]# ls</span><br><span class="line">client  conf             fastdfs.spec  init.d   make.sh     README.md   stop.sh  test</span><br><span class="line">common  COPYING-3_0.txt  HISTORY       INSTALL  php_client  restart.sh  storage  tracker</span><br><span class="line"><span class="meta">#</span>编译</span><br><span class="line">[root@root FastDFS]# ./make.sh </span><br><span class="line"><span class="meta">#</span>安装</span><br><span class="line">[root@root FastDFS]# ./make.sh install</span><br></pre></td></tr></table></figure>

<h4 id="4-配置tracker节点"><a href="#4-配置tracker节点" class="headerlink" title="4.  配置tracker节点"></a>4.  配置tracker节点</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root FastDFS]# cd conf/</span><br><span class="line">[root@root conf]# ls</span><br><span class="line">anti-steal.jpg  client.conf  http.conf  mime.types  storage.conf  storage_ids.conf  tracker.conf</span><br><span class="line"><span class="meta">#</span>拷贝所有配置文件到 /etc/fdfs目录下</span><br><span class="line">[root@root conf]# cp * /etc/fdfs/</span><br><span class="line">[root@root conf]# cd /etc/fdfs/</span><br><span class="line">[root@root fdfs]# ls</span><br><span class="line">anti-steal.jpg  client.conf.sample  mime.types    storage.conf.sample  tracker.conf</span><br><span class="line">client.conf     http.conf           storage.conf  storage_ids.conf     tracker.conf.sample</span><br><span class="line"><span class="meta">#</span>修改tracker配置文件修改存储和日志路径</span><br><span class="line">[root@root fdfs]# vim tracker.conf</span><br><span class="line"><span class="meta">#</span> the base path to store data and log files</span><br><span class="line">base_path=/fastdfs/tracker</span><br><span class="line"><span class="meta">#</span>创建存储路径，顺带创建storage和client存储路径</span><br><span class="line">[root@root /]# mkdir /fastdfs/tracker -p</span><br><span class="line">[root@root fastdfs]# mkdir storage</span><br><span class="line">[root@root fastdfs]# mkdir client</span><br><span class="line"><span class="meta">#</span>进入usr/bin文件夹，以/etc/fdfs/tracker.conf配置文件启动tracker</span><br><span class="line">[root@root bin]# /usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf start</span><br><span class="line"><span class="meta">#</span>重启</span><br><span class="line">[root@root bin]# /usr/bin/fdfs_trackerd fdfs_trackerd /etc/fdfs/tracker.conf restart</span><br></pre></td></tr></table></figure>

<h4 id="5-配置storage节点"><a href="#5-配置storage节点" class="headerlink" title="5. 配置storage节点"></a>5. 配置storage节点</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root bin]# cd /etc/fdfs/</span><br><span class="line"><span class="meta">#</span>编辑storage配置文件，修改以下配置</span><br><span class="line">[root@root fdfs]# vim storage.conf</span><br><span class="line">group_name=joey   #组名，可根据实际情况修改，</span><br><span class="line">base_path=/fastdfs/storage #设置storage数据文件和日志目录，需预先创建</span><br><span class="line">store_path0=/fastdfs/storage #存储路径</span><br><span class="line">tracker_server=192.168.116.145:22122 # #tracker 服务器的 IP地址和端口号，如果是单机搭建，IP不要写127.0.0.1，否则启动不成功。</span><br><span class="line"><span class="meta">#</span>启动storage</span><br><span class="line">[root@root bin]# /usr/bin/fdfs_storaged /etc/fdfs/storage.conf</span><br><span class="line"><span class="meta">#</span>重启storage</span><br><span class="line">[root@root bin]# /usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart</span><br></pre></td></tr></table></figure>

<h4 id="6-配置client"><a href="#6-配置client" class="headerlink" title="6. 配置client"></a>6. 配置client</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>编辑client，修改存储路径和tracker_server为本机IP</span><br><span class="line">[root@root fdfs]# vim client.conf</span><br><span class="line"><span class="meta">#</span> the base path to store log files</span><br><span class="line">base_path=/fastdfs/client</span><br><span class="line"><span class="meta">#</span> tracker_server can ocur more than once, and tracker_server format is</span><br><span class="line"><span class="meta">#</span>  "host:port", host can be hostname or ip address</span><br><span class="line">tracker_server=192.168.1.20:22122</span><br></pre></td></tr></table></figure>

<h4 id="7-测试"><a href="#7-测试" class="headerlink" title="7. 测试"></a>7. 测试</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root home]# /usr/bin/fdfs_test /etc/fdfs/client.conf upload /home/guanli.png </span><br><span class="line">This is FastDFS client test program v5.05</span><br><span class="line"></span><br><span class="line">Copyright (C) 2008, Happy Fish / YuQing</span><br><span class="line"></span><br><span class="line">FastDFS may be copied only under the terms of the GNU General</span><br><span class="line">Public License V3, which may be found in the FastDFS source kit.</span><br><span class="line">Please visit the FastDFS Home Page http://www.csource.org/ </span><br><span class="line">for more detail.</span><br><span class="line"></span><br><span class="line">[2019-08-14 15:55:42] DEBUG - base_path=/fastdfs/client, connect_timeout=30, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0</span><br><span class="line"></span><br><span class="line">tracker_query_storage_store_list_without_group: </span><br><span class="line">	server 1. group_name=, ip_addr=192.168.1.20, port=23000</span><br><span class="line"></span><br><span class="line">group_name=joey, ip_addr=192.168.1.20, port=23000</span><br><span class="line">storage_upload_by_filename</span><br><span class="line">group_name=joey, remote_filename=M00/00/00/wKgBFF1Tvn6AL_ulAAhuqKakO_M091.png</span><br><span class="line">source ip address: 192.168.1.20</span><br><span class="line">file timestamp=2019-08-14 15:55:42</span><br><span class="line">file size=552616</span><br><span class="line">file crc32=2795781107</span><br><span class="line">example file url: http://192.168.1.20/joey/M00/00/00/wKgBFF1Tvn6AL_ulAAhuqKakO_M091.png</span><br><span class="line">storage_upload_slave_by_filename</span><br><span class="line">group_name=joey, remote_filename=M00/00/00/wKgBFF1Tvn6AL_ulAAhuqKakO_M091_big.png</span><br><span class="line">source ip address: 192.168.1.20</span><br><span class="line">file timestamp=2019-08-14 15:55:42</span><br><span class="line">file size=552616</span><br><span class="line">file crc32=2795781107</span><br><span class="line">example file url: http://192.168.1.20/joey/M00/00/00/wKgBFF1Tvn6AL_ulAAhuqKakO_M091_big.png</span><br><span class="line"><span class="meta">#</span>返回链接就是成功了，但是还是访问不了，需要安装nginx服务器</span><br></pre></td></tr></table></figure>

<h4 id="8-安装nginx"><a href="#8-安装nginx" class="headerlink" title="8.  安装nginx"></a>8.  安装nginx</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>解压安装fastdfs-nginx-module</span><br><span class="line">[root@root fastDFS]# tar -zxvf fastdfs-nginx-module_v1.16.tar.gz </span><br><span class="line"><span class="meta">#</span> 编辑 Nginx 模块的配置文件</span><br><span class="line"><span class="meta">#</span> 复制配置文件至/etc/fdfs/，编辑config文件删除路径中的local</span><br><span class="line">[root@root src]# cp * /etc/fdfs/</span><br><span class="line">[root@root src]# vim /fastdfs-nginx-module/src/config</span><br><span class="line">ngx_addon_name=ngx_http_fastdfs_module</span><br><span class="line">HTTP_MODULES="$HTTP_MODULES ngx_http_fastdfs_module"</span><br><span class="line">NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/ngx_http_fastdfs_module.c"</span><br><span class="line">CORE_INCS="$CORE_INCS /usr/include/fastdfs /usr/include/fastcommon/"</span><br><span class="line">CORE_LIBS="$CORE_LIBS -L/usr/lib -lfastcommon -lfdfsclient"</span><br><span class="line">CFLAGS="$CFLAGS -D_FILE_OFFSET_BITS=64 -DFDFS_OUTPUT_CHUNK_SIZE='256*1024' -DFDFS_MOD_CONF_FILENAME='\"/etc/fdfs/mod_fastdfs.conf\"'"</span><br><span class="line"><span class="meta">#</span>安装nginx依赖</span><br><span class="line">[root@root fastDFS]# yum install -y pcre pcre-devel</span><br><span class="line">[root@root fastDFS]# yum install -y zlib zlib-devel</span><br><span class="line">[root@root fastDFS]# yum install -y openssl openssl-devel</span><br><span class="line"><span class="meta">#</span> 解压nginx wget http://nginx.org/download/nginx-1.8.0.tar.gz</span><br><span class="line">[root@root fastDFS]# tar -zxvf nginx-1.8.0.tar.gz </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>nginx配置记得修改最后的module路径</span><br><span class="line"><span class="meta">#</span>复制粘贴在nginx目录下执行</span><br><span class="line">[root@root nginx-1.8.0]# ./configure \</span><br><span class="line"><span class="meta">&gt;</span> --prefix=/usr/local/nginx \</span><br><span class="line"><span class="meta">&gt;</span> --pid-path=/var/local/nginx/nginx.pid \</span><br><span class="line"><span class="meta">&gt;</span> --lock-path=/var/lock/nginx/nginx.lock \</span><br><span class="line"><span class="meta">&gt;</span> --error-log-path=/var/log/nginx/error.log \</span><br><span class="line"><span class="meta">&gt;</span> --http-log-path=/var/log/nginx/access.log \</span><br><span class="line"><span class="meta">&gt;</span> --with-http_gzip_static_module \</span><br><span class="line"><span class="meta">&gt;</span> --http-client-body-temp-path=/var/temp/nginx/client \</span><br><span class="line"><span class="meta">&gt;</span> --http-proxy-temp-path=/var/temp/nginx/proxy \</span><br><span class="line"><span class="meta">&gt;</span> --http-fastcgi-temp-path=/var/temp/nginx/fastcgi \</span><br><span class="line"><span class="meta">&gt;</span> --http-uwsgi-temp-path=/var/temp/nginx/uwsgi \</span><br><span class="line"><span class="meta">&gt;</span> --http-scgi-temp-path=/var/temp/nginx/scgi \</span><br><span class="line"><span class="meta">&gt;</span> --add-module=/opt/fastDFS/fastdfs-nginx-module/src</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>编译</span><br><span class="line">[root@root nginx-1.8.0]# make</span><br><span class="line"><span class="meta">#</span>安装</span><br><span class="line">[root@root nginx-1.8.0]# make install</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>查看安装文件</span><br><span class="line">[root@root nginx-1.8.0]# cd /usr/local/</span><br><span class="line">[root@root local]# ls</span><br><span class="line">bin  etc  games  include  lib  lib64  libexec  nginx  sbin  share  src</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>复制粘贴配置文件</span><br><span class="line">[root@root local]# cd /opt/fastDFS/fastdfs-nginx-module/src/</span><br><span class="line">[root@root src]# ls</span><br><span class="line">common.c  common.h  config  mod_fastdfs.conf  ngx_http_fastdfs_module.c</span><br><span class="line">[root@root src]# cp mod_fastdfs.conf /etc/fdfs/</span><br><span class="line">[root@root src]# vim /etc/fdfs/mod_fastdfs.conf</span><br><span class="line"><span class="meta">#</span>修改日志存储路径</span><br><span class="line"><span class="meta">#</span> the base path to store log files</span><br><span class="line">base_path=/fastdfs/tmp</span><br><span class="line"><span class="meta">#</span>修改tracker路径</span><br><span class="line"><span class="meta">#</span> FastDFS tracker_server can ocur more than once, and tracker_server format is</span><br><span class="line"><span class="meta">#</span>  "host:port", host can be hostname or ip address</span><br><span class="line"><span class="meta">#</span> valid only when load_fdfs_parameters_from_tracker is true</span><br><span class="line">tracker_server=192.168.1.20:22122</span><br><span class="line"><span class="meta">#</span> the group name of the local storage server</span><br><span class="line">group_name=joey</span><br><span class="line"><span class="meta">#</span> if the url / uri including the group name</span><br><span class="line"><span class="meta">#</span> set to false when uri like /M00/00/00/xxx</span><br><span class="line"><span class="meta">#</span> set to true when uri like $&#123;group_name&#125;/M00/00/00/xxx, such as group1/M00/xxx</span><br><span class="line"><span class="meta">#</span> default value is false</span><br><span class="line"><span class="meta">#</span> store_path#, based 0, if store_path0 not exists, it's value is base_path</span><br><span class="line"><span class="meta">#</span> the paths must be exist</span><br><span class="line"><span class="meta">#</span> must same as storage.conf</span><br><span class="line">store_path0=/fastdfs/storage</span><br><span class="line"><span class="meta">#</span>store_path1=/home/yuqing/fastdfs1</span><br><span class="line"><span class="meta">#</span>编辑配置文件添加下面这段，注意nginx使用的配置文件是哪个，/usr/local/nginx/conf/nginx.conf</span><br><span class="line">[root@root conf]# vim nginx.conf</span><br><span class="line">        server &#123;</span><br><span class="line">            listen       88;</span><br><span class="line">            server_name  192.168.1.20 ;</span><br><span class="line"></span><br><span class="line">            location / &#123;</span><br><span class="line">                nginx_fastdfs_module;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#</span>检查</span><br><span class="line">[root@root conf]cd /usr/local/nginx/sbin/</span><br><span class="line">[root@root sbin]# ./nginx -t</span><br><span class="line">ngx_http_fastdfs_set pid=33746</span><br><span class="line">nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: [emerg] mkdir() "/var/temp/nginx/client" failed (2: No such file or directory)</span><br><span class="line">nginx: configuration file /usr/local/nginx/conf/nginx.conf test failed</span><br><span class="line"><span class="meta">#</span>[emerg] mkdir() "/var/temp/nginx/client" failed (2: No such file or directory)</span><br><span class="line"><span class="meta">#</span>报错显示没有目录/var/temp/nginx/client</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>去创建目录</span><br><span class="line">[root@root sbin]# mkdir /var/temp/nginx -p</span><br><span class="line"><span class="meta">#</span>再次检查</span><br><span class="line">[root@root sbin]# ./nginx -t</span><br><span class="line">ngx_http_fastdfs_set pid=33766</span><br><span class="line">nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>检查失败，访问失败，去查看防火墙状态：active (running)</span><br><span class="line">[root@root sbin]# sudo systemctl status firewalld</span><br><span class="line">● firewalld.service - firewalld - dynamic firewall daemon</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since 三 2019-08-14 11:34:40 CST; 5h 51min ago</span><br><span class="line">     Docs: man:firewalld(1)</span><br><span class="line"> Main PID: 771 (firewalld)</span><br><span class="line">    Tasks: 2</span><br><span class="line">   CGroup: /system.slice/firewalld.service</span><br><span class="line">           └─771 /usr/bin/python -Es /usr/sbin/firewalld --nofork --nopid</span><br><span class="line"></span><br><span class="line">8月 14 11:34:38 root systemd[1]: Starting firewalld - dynamic firewall daemon...</span><br><span class="line">8月 14 11:34:40 root systemd[1]: Started firewalld - dynamic firewall daemon.</span><br><span class="line"><span class="meta">#</span>暂时关闭防火墙，下次重启会失效或者disable掉</span><br><span class="line">[root@root sbin]# sudo systemctl stop firewalld</span><br></pre></td></tr></table></figure>

<p><img src="https://fangchenyong.oss-cn-hangzhou.aliyuncs.com/img/20190814172907.png" alt="访问nginx成功"></p>
<p><img src="https://fangchenyong.oss-cn-hangzhou.aliyuncs.com/img/20190814173428.png" alt="访问图片失败"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>修改配置</span><br><span class="line">[root@root fdfs]# vim mod_fastdfs.conf </span><br><span class="line"><span class="meta">#</span> store_path#, based 0, if store_path0 not exists, it's value is base_path</span><br><span class="line"><span class="meta">#</span> the paths must be exist</span><br><span class="line"><span class="meta">#</span> must same as storage.conf</span><br><span class="line">store_path0=/fastdfs/storage</span><br><span class="line"><span class="meta">#</span>store_path1=/home/yuqing/fastdfs1</span><br><span class="line"><span class="meta">#</span>重启所有服务</span><br><span class="line">[root@root fdfs]# /usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf restart</span><br><span class="line">waiting for pid [28338] exit ...</span><br><span class="line">starting ...</span><br><span class="line">[root@root fdfs]# /usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart</span><br><span class="line">waiting for pid [28841] exit ...</span><br><span class="line">starting ...</span><br><span class="line">[root@root fdfs]# cd /usr/local/nginx/sbin/</span><br><span class="line">[root@root sbin]# ./nginx -s reload</span><br><span class="line">ngx_http_fastdfs_set pid=34197</span><br></pre></td></tr></table></figure>

<p><img src="https://fangchenyong.oss-cn-hangzhou.aliyuncs.com/img/20190814174007.png" alt="图片访问成功"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fangchenyong.top/2019/08/14/Linux-install_FastDFS+Nginx/" data-id="ckmh9z46x005xroumymxxaguf" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CentOS/">CentOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FastDFS/">FastDFS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-项目-理财产品系统" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/29/项目-理财产品系统/" class="article-date">
  <time datetime="2019-07-29T14:12:23.000Z" itemprop="datePublished">2019-07-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>►<a class="article-category-link" href="/categories/Java/SpringBoot/">SpringBoot</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/29/项目-理财产品系统/">理财产品系统（慕课网）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="理财产品系统（慕课网）"><a href="#理财产品系统（慕课网）" class="headerlink" title="理财产品系统（慕课网）"></a><a href="https://coding.imooc.com/class/211.html" target="_blank" rel="noopener">理财产品系统（慕课网）</a></h1><p>junit、swagger、JSON-RPC、MySql、hazelcast、HTTPS、RSA签名、权限控制、节流限速、访问统计、TYK</p>
<p>快速：</p>
<ol>
<li>开发快</li>
<li>迭代快</li>
</ol>
<p>高效：</p>
<ol>
<li>高并发 </li>
<li>响应快</li>
</ol>
<p>安全：</p>
<ol>
<li>加密</li>
<li>权限</li>
</ol>
<p>模块化开发：</p>
<ol>
<li>Manager</li>
<li>Seller</li>
<li>Entity</li>
<li>Api</li>
<li>Util</li>
<li>Quartz</li>
<li>Swagger</li>
</ol>
<p>数据库设计：</p>
<ul>
<li><p>产品表</p>
<table>
<thead>
<tr>
<th>表名</th>
<th>product</th>
<th>表名中文</th>
<th>产品表</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>No</td>
<td>列名</td>
<td>列名中文</td>
<td>类型</td>
<td>长度</td>
<td>Key</td>
<td>Null</td>
<td>默认值</td>
<td>备注</td>
</tr>
<tr>
<td>1</td>
<td>id</td>
<td>编号</td>
<td>varchar</td>
<td>50</td>
<td>Y</td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>name</td>
<td>名称</td>
<td>varchar</td>
<td>50</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>threshold_amount</td>
<td>起投金额</td>
<td>decimal</td>
<td>15,4</td>
<td></td>
<td>M</td>
<td>0</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>step_amount</td>
<td>投资步长</td>
<td>decimal</td>
<td>15,4</td>
<td></td>
<td>N</td>
<td>0</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>lock_term</td>
<td>锁定期</td>
<td>smallint</td>
<td></td>
<td></td>
<td>N</td>
<td>0</td>
<td>单位天</td>
</tr>
<tr>
<td>6</td>
<td>reward_rate</td>
<td>收益率</td>
<td>decimal</td>
<td>5,4</td>
<td></td>
<td>N</td>
<td></td>
<td>0-100，百分比</td>
</tr>
<tr>
<td>7</td>
<td>status</td>
<td>状态</td>
<td>varchar</td>
<td>20</td>
<td></td>
<td>N</td>
<td></td>
<td>审核中：Audinting，销售中：In_Sell，暂停销售：Locked，已结束：Finished</td>
</tr>
<tr>
<td>8</td>
<td>memo</td>
<td>备注</td>
<td>varchar</td>
<td>200</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>9</td>
<td>create_at</td>
<td>创建时间</td>
<td>datetime</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>10</td>
<td>create_user</td>
<td>创建者ID</td>
<td>varchar</td>
<td>20</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>11</td>
<td>update_at</td>
<td>更新时间</td>
<td>datetime</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>12</td>
<td>update_user</td>
<td>更新者ID</td>
<td>varchar</td>
<td>20</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
<li><p>订单表</p>
<table>
<thead>
<tr>
<th>表名</th>
<th>order_t</th>
<th>表名中文</th>
<th>订单表</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>No</td>
<td>列名</td>
<td>列名中文</td>
<td>类型</td>
<td>长度</td>
<td>Key</td>
<td>Null</td>
<td>默认值</td>
<td>备注</td>
</tr>
<tr>
<td>1</td>
<td>order_id</td>
<td>订单编号</td>
<td>varchar</td>
<td>50</td>
<td>Y</td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>chan_id</td>
<td>渠道编号</td>
<td>varchar</td>
<td>50</td>
<td></td>
<td>N</td>
<td></td>
<td>套壳公司编号</td>
</tr>
<tr>
<td>3</td>
<td>product_id</td>
<td>产品编号</td>
<td>varchar</td>
<td>50</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>chan_user_id</td>
<td>用户编号</td>
<td>varchar</td>
<td>50</td>
<td></td>
<td>N</td>
<td></td>
<td>套壳公司的用户编号</td>
</tr>
<tr>
<td>5</td>
<td>order_type</td>
<td>订单类型</td>
<td>varchar</td>
<td>50</td>
<td></td>
<td>N</td>
<td></td>
<td>申购：Apply，赎回：Redeem</td>
</tr>
<tr>
<td>6</td>
<td>order_status</td>
<td>订单状态</td>
<td>varchar</td>
<td>50</td>
<td></td>
<td>N</td>
<td></td>
<td>初始化：Init，处理中：Process，成功：Success，失败：Fail</td>
</tr>
<tr>
<td>7</td>
<td>outer_order_id</td>
<td>外部订单编号</td>
<td>varchar</td>
<td>50</td>
<td></td>
<td>N</td>
<td></td>
<td>套壳公司的订单编号</td>
</tr>
<tr>
<td>8</td>
<td>amount</td>
<td>订单金额</td>
<td>decimal</td>
<td>15，4</td>
<td></td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>9</td>
<td>memo</td>
<td>备注</td>
<td>varchar</td>
<td>200</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>10</td>
<td>create_at</td>
<td>创建时间</td>
<td>datetime</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>11</td>
<td>update_at</td>
<td>更新时间</td>
<td>datetime</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
<li><p>创建项目添加依赖</p>
<p>SpringBoot    1.5.4 Release</p>
<p>spring-boot-starter-web</p>
<p>Spring-boot-starter-data-jpa</p>
<p>commons-lang3    3.5</p>
<p>mysql-connector-java    5.1.29</p>
<p>spring-boot-starter-test</p>
</li>
<li><p>创建每个模块</p>
<ol>
<li>Manager</li>
<li>Seller</li>
<li>Entity</li>
<li>Api</li>
<li>Util</li>
<li>Quartz</li>
<li>Swagger</li>
</ol>
</li>
<li><p>创建Entity实体类</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fangchenyong.top/2019/07/29/项目-理财产品系统/" data-id="ckmh9z4570015roum1c4bdso8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SpringBoot/">SpringBoot</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ORM-Hibernate-Hibernate主键生成策略" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/26/ORM-Hibernate-Hibernate主键生成策略/" class="article-date">
  <time datetime="2019-07-25T16:00:00.000Z" itemprop="datePublished">2019-07-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ORM/">ORM</a>►<a class="article-category-link" href="/categories/ORM/Hibernate/">Hibernate</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/26/ORM-Hibernate-Hibernate主键生成策略/">Hibernate各种主键生成策略与配置详解（转自[starskyhu])</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Hibernate各种主键生成策略与配置详解（转自-starskyhu"><a href="#Hibernate各种主键生成策略与配置详解（转自-starskyhu" class="headerlink" title="Hibernate各种主键生成策略与配置详解（转自[starskyhu])"></a><a href="https://www.cnblogs.com/hoobey/p/5508992.html" target="_blank" rel="noopener"><strong>Hibernate各种主键生成策略与配置详解（转自[starskyhu])</strong></a></h2><blockquote>
<p>在项目中使用Hibernate+Oracle，在是生成GUID时遇到问题，查询解决后记录</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&gt; <span class="meta">@GenericGenerator</span>(name = <span class="string">"generator"</span>, strategy = <span class="string">"uuid.hex"</span>)</span><br><span class="line">&gt; <span class="meta">@Id</span></span><br><span class="line">&gt; <span class="meta">@GeneratedValue</span>(generator = <span class="string">"generator"</span>)</span><br><span class="line">&gt; <span class="meta">@Column</span>(name = <span class="string">"ID"</span>, unique = <span class="keyword">true</span>, nullable = <span class="keyword">false</span>, length = <span class="number">36</span>)</span><br><span class="line">&gt; <span class="keyword">private</span> String ID;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="1、assigned"><a href="#1、assigned" class="headerlink" title="1、assigned"></a><strong>1、assigned</strong></h3><p>主键由外部程序负责生成，在 save() 之前必须指定一个。Hibernate不负责维护主键生成。与Hibernate和底层数据库都无关，可以跨数据库。在存储对象前，必须要使用主键的setter方法给主键赋值，至于这个值怎么生成，完全由自己决定，这种方法应该尽量避免。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"assigned"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>“ud”是自定义的策略名，人为起的名字，后面均用“ud”表示。</p>
<p><strong>特点：可以跨数据库，人为控制主键生成，应尽量避免。</strong></p>
<h3 id="2、increment"><a href="#2、increment" class="headerlink" title="2、increment"></a><strong>2、increment</strong></h3><p>由Hibernate从数据库中取出主键的最大值（每个session只取1次），以该值为基础，每次增量为1，在内存中生成主键，不依赖于底层的数据库，因此可以跨数据库。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"increment"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Hibernate调用org.hibernate.id.IncrementGenerator类里面的generate()方法，使用select max(idColumnName) from tableName语句获取主键最大值。该方法被声明成了synchronized，所以在一个独立的Java虚拟机内部是没有问题的，然而，在多个JVM同时并发访问数据库select max时就可能取出相同的值，再insert就会发生Dumplicate entry的错误。所以只能有一个Hibernate应用进程访问数据库，否则就可能产生主键冲突，所以不适合多进程并发更新数据库，适合单一进程访问数据库，不能用于群集环境。</p>
<p>官方文档：只有在没有其他进程往同一张表中插入数据时才能使用，在集群下不要使用。</p>
<p><strong>特点：跨数据库，不适合多进程并发更新数据库，适合单一进程访问数据库，不能用于群集环境。</strong></p>
<h3 id="3、hilo"><a href="#3、hilo" class="headerlink" title="3、hilo"></a><strong>3、hilo</strong></h3><p>hilo（高低位方式high low）是hibernate中最常用的一种生成方式，需要一张额外的表保存hi的值。保存hi值的表至少有一条记录（只与第一条记录有关），否则会出现错误。<strong>可以跨数据库。</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"hilo"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"table"</span>&gt;</span>hibernate_hilo<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"column"</span>&gt;</span>next_hi<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max_lo"</span>&gt;</span>100<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"table"</span>&gt;</span>hibernate_hilo<span class="tag">&lt;/<span class="name">param</span>&gt;</span> 指定保存hi值的表名</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"column"</span>&gt;</span>next_hi<span class="tag">&lt;/<span class="name">param</span>&gt;</span> 指定保存hi值的列名</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max_lo"</span>&gt;</span>100<span class="tag">&lt;/<span class="name">param</span>&gt;</span> 指定低位的最大值</span><br></pre></td></tr></table></figure>

<p>也可以省略table和column配置，其默认的表为hibernate_unique_key，列为next_hi</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"hilo"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max_lo"</span>&gt;</span>100<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>hilo生成器生成主键的过程（以hibernate_unique_key表，next_hi列为例）：</p>
<ol>
<li><p>获得hi值：读取并记录数据库的hibernate_unique_key表中next_hi字段的值，数据库中此字段值加1保存。</p>
</li>
<li><p>获得lo值：从0到max_lo循环取值，差值为1，当值为max_lo值时，重新获取hi值，然后lo值继续从0到max_lo循环。</p>
</li>
<li><p>根据公式 hi * (max_lo + 1) + lo计算生成主键值。</p>
</li>
</ol>
<p>注意：当hi值是0的时候，那么第一个值不是0*(max_lo+1)+0=0，而是lo跳过0从1开始，直接是1、2、3……</p>
<p>那max_lo配置多大合适呢？</p>
<p>这要根据具体情况而定，如果系统一般不重启，而且需要用此表建立大量的主键，可以吧max_lo配置大一点，这样可以减少读取数据表的次数，提高效率；反之，如果服务器经常重启，可以吧max_lo配置小一点，可以避免每次重启主键之间的间隔太大，造成主键值主键不连贯。</p>
<p><strong>特点：跨数据库，hilo算法生成的标志只能在一个数据库中保证唯一。</strong></p>
<h3 id="4、seqhilo"><a href="#4、seqhilo" class="headerlink" title="4、seqhilo"></a><strong>4、seqhilo</strong></h3><p>与hilo类似，通过hi/lo算法实现的主键生成机制，只是将hilo中的数据表换成了序列sequence，需要数据库中先创建sequence，适用于支持sequence的数据库，如Oracle。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"seqhilo"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"sequence"</span>&gt;</span>hibernate_seq<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max_lo"</span>&gt;</span>100<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>特点：与hilo类似，只能在支持序列的数据库中使用。</strong></p>
<h3 id="5、sequence"><a href="#5、sequence" class="headerlink" title="5、sequence"></a><strong>5、sequence</strong></h3><p>采用数据库提供的sequence机制生成主键，需要数据库支持sequence。如oralce、DB、SAP DB、PostgerSQL、McKoi中的sequence。MySQL这种不支持sequence的数据库则不行（可以使用identity）。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"sequence"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"sequence"</span>&gt;</span>hibernate_id<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"sequence"</span>&gt;</span>hibernate_id<span class="tag">&lt;/<span class="name">param</span>&gt;</span> 指定sequence的名称**</span><br></pre></td></tr></table></figure>

<p>Hibernate生成主键时，查找sequence并赋给主键值，主键值由数据库生成，Hibernate不负责维护，使用时必须先创建一个sequence，如果不指定sequence名称，则使用Hibernate默认的sequence，名称为hibernate_sequence，前提要在数据库中创建该sequence。</p>
<p><strong>特点：只能在支持序列的数据库中使用，如Oracle。</strong></p>
<h3 id="6、identity"><a href="#6、identity" class="headerlink" title="6、identity"></a><strong>6、identity</strong></h3><p>identity由底层数据库生成标识符。identity是由数据库自己生成的，但这个主键必须设置为自增长，使用identity的前提条件是底层数据库支持自动增长字段类型，如DB2、SQL Server、MySQL、Sybase和HypersonicSQL等，Oracle这类没有自增字段的则不支持。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"identity"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>例：如果使用MySQL数据库，则主键字段必须设置成auto_increment。</p>
<p>id int(11) primary key auto_increment</p>
<p><strong>特点：只能用在支持自动增长的字段数据库中使用，如MySQL。</strong></p>
<h3 id="7、native"><a href="#7、native" class="headerlink" title="7、native"></a><strong>7、native</strong></h3><p>native由hibernate根据使用的数据库自行判断采用identity、hilo、sequence其中一种作为主键生成方式，灵活性很强。如果能支持identity则使用identity，如果支持sequence则使用sequence。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>例如MySQL使用identity，Oracle使用sequence</p>
<p>注意：如果Hibernate自动选择sequence或者hilo，则所有的表的主键都会从Hibernate默认的sequence或hilo表中取。并且，有的数据库对于默认情况主键生成测试的支持，效率并不是很高。</p>
<p>使用sequence或hilo时，可以加入参数，指定sequence名称或hi值表名称等，如</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"sequence"</span>&gt;</span>hibernate_id<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>特点：根据数据库自动选择，项目中如果用到多个数据库时，可以使用这种方式，使用时需要设置表的自增字段或建立序列，建立表等。</strong></p>
<p><strong>8、uuid</strong></p>
<p>UUID：Universally Unique Identifier，是指在一台机器上生成的数字，它保证对在同一时空中的所有机器都是唯一的。按照开放软件基金会(OSF)制定的标准计算，用到了以太网卡地址、纳秒级时间、芯片ID码和许多可能的数字，标准的UUID格式为：</p>
<p><strong>xxxxxxxx-xxxx-xxxx-xxxxxx-xxxxxxxxxx (8-4-4-4-12)</strong></p>
<p>其中每个 <strong>x</strong> 是 0-9 或 a-f 范围内的一个十六进制的数字。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"uuid"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Hibernate在保存对象时，生成一个UUID字符串作为主键，保证了唯一性，但其并无任何业务逻辑意义，只能作为主键，唯一缺点长度较大，32位（Hibernate将UUID中间的“-”删除了）的字符串，占用存储空间大，但是有两个很重要的优点，Hibernate在维护主键时，不用去数据库查询，从而提高效率，而且它是跨数据库的，以后切换数据库极其方便。</p>
<p><strong>特点：uuid长度大，占用空间大，跨数据库，不用访问数据库就生成主键值，所以效率高且能保证唯一性，移植非常方便，推荐使用。</strong></p>
<p><strong>9、guid</strong></p>
<p>GUID：Globally Unique Identifier全球唯一标识符，也称作 UUID，是一个128位长的数字，用16进制表示。算法的核心思想是结合机器的网卡、当地时间、一个随即数来生成GUID。从理论上讲，如果一台机器每秒产生10000000个GUID，则可以保证（概率意义上）3240年不重复。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"guid"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Hibernate在维护主键时，先查询数据库，获得一个uuid字符串，该字符串就是主键值，该值唯一，缺点长度较大，支持数据库有限，优点同uuid，跨数据库，但是仍然需要访问数据库。</p>
<p><strong>注意：长度因数据库不同而不同</strong></p>
<p>MySQL中使用select uuid()语句获得的为36位（包含标准格式的“-”）</p>
<p>Oracle中，使用select rawtohex(sys_guid()) from dual语句获得的为32位（不包含“-”） </p>
<p><strong>特点：需要数据库支持查询uuid，生成时需要查询数据库，效率没有uuid高，推荐使用uuid。</strong></p>
<h3 id="10、foreign"><a href="#10、foreign" class="headerlink" title="10、foreign"></a><strong>10、foreign</strong></h3><p>使用另外一个相关联的对象的主键作为该对象主键。主要用于一对一关系中。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"foreign"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"property"</span>&gt;</span>user<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">one-to-one</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"domain.User"</span> <span class="attr">constrained</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>该例使用domain.User的主键作为本类映射的主键。</p>
<p><strong>特点：很少使用，大多用在一对一关系中。</strong></p>
<h3 id="11、select"><a href="#11、select" class="headerlink" title="11、select"></a><strong>11、select</strong></h3><p>使用触发器生成主键，主要用于早期的数据库主键生成机制，能用到的地方非常少。</p>
<h3 id="12、其他注释方式配置"><a href="#12、其他注释方式配置" class="headerlink" title="12、其他注释方式配置"></a><strong>12、其他注释方式配置</strong></h3><p>注释方式与配置文件底层实现方式相同，只是配置的方式换成了注释方式</p>
<p>自动增长，适用于支持自增字段的数据库</p>
<p><strong>@Id</strong></p>
<p><strong>@GeneratedValue(strategy = GenerationType.IDENTITY)</strong></p>
<p>根据底层数据库自动选择方式，需要底层数据库的设置</p>
<p>如MySQL，会使用自增字段，需要将主键设置成auto_increment。</p>
<p><strong>@Id</strong></p>
<p><strong>@GeneratedValue(strategy = GenerationType.AUTO)</strong></p>
<p>使用表存储生成的主键，可以跨数据库。</p>
<p>每次需要主键值时，查询名为<strong>“hibernate_table”</strong>的表，查找主键列<strong>“gen_pk”</strong>值为<strong>“2”</strong>记录，得到这条记录的<strong>“gen_val”</strong>值，根据这个值，和<strong>allocationSize</strong>的值生成主键值。</p>
<p><strong>@Id</strong></p>
<p><strong>@GeneratedValue(strategy = GenerationType.<em>TABLE</em>, generator = “ud”)</strong></p>
<p><strong>@TableGenerator(name = “ud”,</strong></p>
<p><strong>table = “hibernate_table”,</strong></p>
<p><strong>pkColumnName = “gen_pk”,</strong></p>
<p><strong>pkColumnValue = “2”,</strong></p>
<p><strong>valueColumnName = “gen_val”,</strong></p>
<p><strong>initialValue = 2,</strong></p>
<p><strong>allocationSize = 5)</strong></p>
<p>使用序列存储主键值</p>
<p><strong>@Id</strong></p>
<p><strong>@GeneratedValue(strategy = GenerationType.SEQUENCE, generator = “ud”)</strong></p>
<p><strong>@SequenceGenerator(name = “ud”,</strong></p>
<p><strong>sequenceName = “hibernate_seq”,</strong></p>
<p><strong>allocationSize = 1,</strong></p>
<p><strong>initialValue = 2)</strong></p>
<h3 id="13、小结"><a href="#13、小结" class="headerlink" title="13、小结"></a><strong>13、小结</strong></h3><p><strong>1、为了保证对象标识符的唯一性与不可变性，应该让Hibernate来为主键赋值，而不是程序。</strong></p>
<p><strong>2、正常使用Hibernate维护主键，最好将主键的setter方法设置成private，从而避免人为或程序修改主键，而使用assigned方式，就不能用private，否则无法给主键赋值。</strong></p>
<p><strong>2、Hibernate中唯一一种最简单通用的主键生成器就是uuid。虽然是个32位难读的长字符串，但是它没有跨数据库的问题，将来切换数据库极其简单方便，推荐使用！</strong></p>
<p><strong>3、自动增长字段类型与序列</strong></p>
<table>
<thead>
<tr>
<th><strong>数据库</strong></th>
<th><strong>自动增长字段</strong></th>
<th><strong>序列</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>MySQL</strong></td>
<td><strong>是</strong></td>
<td></td>
</tr>
<tr>
<td><strong>Oracle</strong></td>
<td></td>
<td><strong>是</strong></td>
</tr>
<tr>
<td><strong>DB2</strong></td>
<td><strong>是</strong></td>
<td><strong>是</strong></td>
</tr>
<tr>
<td><strong>MS SQL Server</strong></td>
<td><strong>是</strong></td>
<td></td>
</tr>
<tr>
<td><strong>Sybase</strong></td>
<td><strong>是</strong></td>
<td></td>
</tr>
<tr>
<td><strong>HypersonicSQL</strong></td>
<td><strong>是</strong></td>
<td></td>
</tr>
<tr>
<td><strong>PostgreSQL</strong></td>
<td></td>
<td><strong>是</strong></td>
</tr>
<tr>
<td><strong>SAP DB</strong></td>
<td></td>
<td><strong>是</strong></td>
</tr>
<tr>
<td><strong>HSQLDB</strong></td>
<td><strong>是</strong></td>
<td></td>
</tr>
<tr>
<td><strong>Infomix</strong></td>
<td><strong>是</strong></td>
<td></td>
</tr>
</tbody></table>
<p><strong>4、关于hilo机制注意：</strong></p>
<p><strong>hilo算法生成的标志只能在一个数据库中保证唯一。</strong></p>
<p><strong>当用户为Hibernate自行提供连接，或者Hibernate通过JTA，从应用服务器的数据源获取数据库连接时，无法使用hilo，因为这不能保证hilo单独在新的数据库连接的事务中访问hi值表，这种情况，如果数据库支持序列，可以使用seqhilo。</strong></p>
<p><strong>5、使用identity、native、GenerationType.AUTO等方式生成主键时，只要用到自增字段，数据库表的字段必须设置成自动增加的，否则出错。</strong></p>
<p><strong>6、还有一些方法未列出来，例如uuid.hex，sequence-identity等，这些方法不是很常用，且已被其他方法代替，如uuid.hex，官方文档里建议不使用，而直接使用uuid方法。</strong></p>
<p><strong>7、Hibernate的各版本主键生成策略配置有略微差别，但实现基本相同。如，有的版本默认sequence不指定序列名，则使用名为hibernate_sequence的序列，有的版本则必须指定序列名。</strong></p>
<p><strong>8、还可以自定义主键生成策略，这里暂时不讨论，只讨论官方自带生成策略。</strong> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fangchenyong.top/2019/07/26/ORM-Hibernate-Hibernate主键生成策略/" data-id="ckmh9z4750066roumuxs7vppr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hibernate/">Hibernate</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ORM/">ORM</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/SpringBoot/">SpringBoot</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/SpringBoot/netty/">netty</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/源码/">源码</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/源码/Object/">Object</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/源码/String/">String</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/Jsplumb/">Jsplumb</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/CentOS/">CentOS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/CentOS/ActiveMQ/">ActiveMQ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/CentOS/FastDFS/">FastDFS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/CentOS/FastDFS/nginx/">nginx</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/CentOS/JDK/">JDK</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/CentOS/MongoDB/">MongoDB</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/CentOS/MySql/">MySql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/CentOS/Redis/">Redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/CentOS/Tomcat/">Tomcat</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/CentOS/zigw/">zigw</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/Oracle/">Oracle</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/Oracle/正则表达式/">正则表达式</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Maven/">Maven</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/My-Java-Life/">My Java Life</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mybatis/">Mybatis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ORM/">ORM</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ORM/Hibernate/">Hibernate</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/地图/">地图</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/地图/腾讯地图/">腾讯地图</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/地图/高德地图/">高德地图</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/Oracle/">Oracle</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/SqlServer/">SqlServer</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/">数据结构</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/数组/">数组</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/数组/稀疏数组/">稀疏数组</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/环形队列/">环形队列</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/创建型模式/">创建型模式</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/创建型模式/单例模式/">单例模式</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/设计原则/">设计原则</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试题/">面试题</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/面试题/集合/">集合</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/项目/">项目</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/项目/方兴商城/">方兴商城</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ActiveMQ/">ActiveMQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CentOS/">CentOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FastDFS/">FastDFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hibernate/">Hibernate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDK/">JDK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jsplumb/">Jsplumb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Maven/">Maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/">MongoDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/My-Java-Life/">My Java Life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySql/">MySql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mybatis/">Mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ORM/">ORM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Object/">Object</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Oracle/">Oracle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/">SpringBoot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SqlServer/">SqlServer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/String/">String</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tomcat/">Tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/netty/">netty</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zigw/">zigw</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/二维码/">二维码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/创建型模式/">创建型模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/单例模式/">单例模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/地图/">地图</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/存储过程/">存储过程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数组/">数组</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/正则表达式/">正则表达式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/源码/">源码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/环形队列/">环形队列</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/稀疏数组/">稀疏数组</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/腾讯地图/">腾讯地图</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计原则/">设计原则</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/集合/">集合</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试题/">面试题</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高德地图/">高德地图</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/ActiveMQ/" style="font-size: 10px;">ActiveMQ</a> <a href="/tags/CentOS/" style="font-size: 18.33px;">CentOS</a> <a href="/tags/FastDFS/" style="font-size: 10px;">FastDFS</a> <a href="/tags/Hibernate/" style="font-size: 10px;">Hibernate</a> <a href="/tags/JDK/" style="font-size: 10px;">JDK</a> <a href="/tags/Java/" style="font-size: 16.67px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 13.33px;">JavaScript</a> <a href="/tags/Jsplumb/" style="font-size: 10px;">Jsplumb</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/Maven/" style="font-size: 10px;">Maven</a> <a href="/tags/MongoDB/" style="font-size: 10px;">MongoDB</a> <a href="/tags/My-Java-Life/" style="font-size: 10px;">My Java Life</a> <a href="/tags/MySQL/" style="font-size: 11.67px;">MySQL</a> <a href="/tags/MySql/" style="font-size: 10px;">MySql</a> <a href="/tags/Mybatis/" style="font-size: 10px;">Mybatis</a> <a href="/tags/ORM/" style="font-size: 10px;">ORM</a> <a href="/tags/Object/" style="font-size: 10px;">Object</a> <a href="/tags/Oracle/" style="font-size: 11.67px;">Oracle</a> <a href="/tags/Redis/" style="font-size: 13.33px;">Redis</a> <a href="/tags/Spring/" style="font-size: 10px;">Spring</a> <a href="/tags/SpringBoot/" style="font-size: 11.67px;">SpringBoot</a> <a href="/tags/SqlServer/" style="font-size: 11.67px;">SqlServer</a> <a href="/tags/String/" style="font-size: 10px;">String</a> <a href="/tags/Tomcat/" style="font-size: 10px;">Tomcat</a> <a href="/tags/netty/" style="font-size: 10px;">netty</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/zigw/" style="font-size: 10px;">zigw</a> <a href="/tags/二维码/" style="font-size: 10px;">二维码</a> <a href="/tags/创建型模式/" style="font-size: 10px;">创建型模式</a> <a href="/tags/单例模式/" style="font-size: 10px;">单例模式</a> <a href="/tags/地图/" style="font-size: 11.67px;">地图</a> <a href="/tags/存储过程/" style="font-size: 10px;">存储过程</a> <a href="/tags/数据库/" style="font-size: 15px;">数据库</a> <a href="/tags/数据结构/" style="font-size: 11.67px;">数据结构</a> <a href="/tags/数组/" style="font-size: 10px;">数组</a> <a href="/tags/正则表达式/" style="font-size: 10px;">正则表达式</a> <a href="/tags/源码/" style="font-size: 11.67px;">源码</a> <a href="/tags/环形队列/" style="font-size: 10px;">环形队列</a> <a href="/tags/稀疏数组/" style="font-size: 10px;">稀疏数组</a> <a href="/tags/腾讯地图/" style="font-size: 10px;">腾讯地图</a> <a href="/tags/设计原则/" style="font-size: 10px;">设计原则</a> <a href="/tags/设计模式/" style="font-size: 11.67px;">设计模式</a> <a href="/tags/集合/" style="font-size: 10px;">集合</a> <a href="/tags/面试题/" style="font-size: 10px;">面试题</a> <a href="/tags/高德地图/" style="font-size: 10px;">高德地图</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/20/面试-集合/">面试题-集合框架</a>
          </li>
        
          <li>
            <a href="/2021/03/13/The Road To Bald Man!/">The Road To Bald Man!</a>
          </li>
        
          <li>
            <a href="/2020/07/21/框架-Maven-配置标签详解/">Maven配置标签详解</a>
          </li>
        
          <li>
            <a href="/2020/07/13/设计模式-七大原则/">设计模式-七大设计原则</a>
          </li>
        
          <li>
            <a href="/2020/07/13/设计模式-创建型模式-单例模式/">设计模式-创建型模式-单例模式</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 fangchenyong<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>